var VoxImplant=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/build",t(t.s=30)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i;!function(e){e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO",e[e.TRACE=4]="TRACE"}(i=t.LogLevel||(t.LogLevel={}));var a;!function(e){e[e.SIGNALING=0]="SIGNALING",e[e.RTC=1]="RTC",e[e.USERMEDIA=2]="USERMEDIA",e[e.CALL=3]="CALL",e[e.CALLEXP2P=4]="CALLEXP2P",e[e.CALLEXSERVER=5]="CALLEXSERVER",e[e.CALLMANAGER=6]="CALLMANAGER",e[e.CLIENT=7]="CLIENT",e[e.AUTHENTICATOR=8]="AUTHENTICATOR",e[e.PCFACTORY=9]="PCFACTORY",e[e.UTILS=10]="UTILS",e[e.ORTC=11]="ORTC",e[e.MESSAGING=12]="MESSAGING",e[e.REINVITEQ=13]="REINVITEQ",e[e.HARDWARE=14]="HARDWARE"}(a=t.LogCategory||(t.LogCategory={}));!function(e){e[e.DISCONNECTED="DISCONNECTED"]="DISCONNECTED",e[e.CONNECTING="CONNECTING"]="CONNECTING",e[e.CONNECTED="CONNECTED"]="CONNECTED",e[e.LOGGING_IN="LOGGING_IN"]="LOGGING_IN",e[e.LOGGED_IN="LOGGED_IN"]="LOGGED_IN"}(t.ClientState||(t.ClientState={}));var s=function(){function e(t,n,o){r(this,e),this.category=t,this.label=n,this.provider=o}return o(e,[{key:"log",value:function(e,t){this.provider.writeMessage(this.category,this.label,e,t)}},{key:"error",value:function(e){this.log(i.ERROR,e)}},{key:"warning",value:function(e){this.log(i.WARNING,e)}},{key:"info",value:function(e){this.log(i.INFO,e)}},{key:"trace",value:function(e){this.log(i.TRACE,e)}}]),e}();t.Logger=s;var c=function(){function e(){r(this,e),this._shadowLogging=!1,this.levels={}}return o(e,[{key:"getSLog",value:function(){return this._shadowLog}},{key:"clearSilentLog",value:function(){this._shadowLog=[]}},{key:"setLoggerCallback",value:function(e){this._outerCallback=e}},{key:"setPrettyPrint",value:function(e){this.prettyPrint=e}},{key:"setLogLevel",value:function(e,t){this.levels[a[e]]=t}},{key:"writeMessage",value:function(t,n,r,o){e.tick++;var s="VIWSLR "+e.tick+" "+(new Date).toString()+" "+i[r]+" "+n+": "+o,c=i.NONE;if(void 0!==this.levels[a[t]]&&(c=this.levels[a[t]]),r<=c)if(void 0!==console.debug&&void 0!==console.info&&void 0!==console.error&&void 0!==console.warn)if(this.prettyPrint){"string"!=typeof o&&(o=JSON.stringify(o));var l="%c VIWSLR "+e.tick+" "+(new Date).toUTCString()+" ["+i[r]+"] %c"+n+": %c"+o.replace("\r\n","<br>");r===i.ERROR?console.error(s):r===i.WARNING?console.warn(l,"color:#ccc","color:#2375a2","color:#000"):r===i.INFO?console.info(l,"color:#ccc","color:#2375a2","color:#000"):(i.TRACE,console.log(l,"color:#ccc","color:#2375a2","color:#000"))}else r===i.ERROR?console.error(s):r===i.WARNING?console.warn(s):r===i.INFO?console.info(s):r===i.TRACE?console.debug(s):console.log(s);else console.log(s);this.shadowLogging&&this._shadowLog.push(s),"function"==typeof this._outerCallback&&this._outerCallback({formattedText:s,category:t,label:n,level:r,message:o})}},{key:"createLogger",value:function(e,t){return new s(e,t,this)}},{key:"_traceName",value:function(){return"Logger"}},{key:"shadowLogging",set:function(e){this._shadowLogging||(this._shadowLog=[]),this._shadowLogging=e},get:function(){return this._shadowLogging}}],[{key:"get",value:function(){return void 0===this.inst&&(this.inst=new e,this.inst.prettyPrint=!1),this.inst}},{key:"d_trace",value:function(t){return function(n,r,o){return{value:function(){for(var a="",s=arguments.length,c=Array(s),l=0;l<s;l++)c[l]=arguments[l];try{a=c.map(function(e){return JSON.stringify(e)}).join()}catch(e){a="circular structure"}var u="";return n._traceName&&(u=n._traceName()),e.get().writeMessage(t,u,i.TRACE,r+"("+a+")"),o.value.apply(this,c)}}}}}]),e}();c.tick=0,t.LogManager=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s,c=n(0),l=n(5),u=n(8),d=n(6),g=n(2),f=n(12),p=n(25),v=n(3);!function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.WSCONNECTED=2]="WSCONNECTED",e[e.CONNECTED=3]="CONNECTED",e[e.CLOSING=4]="CLOSING"}(s=t.VoxSignalingState||(t.VoxSignalingState={}));var h=function(){function e(){var t=this;r(this,e),this.ver="3",this.handlers=[],this.rpcHandlers={},this.pingTimer=null,this.pongTimer=null,this.manualDisconnect=!1,this.platform="platform",this.referrer="platform",this.extra="",this.closing=!1,this.writeLog=!1,this._opLog=[],this.token="",this.log=c.LogManager.get().createLogger(c.LogCategory.SIGNALING,"VoxSignaling"),this.currentState=s.IDLE,this.setRPCHandler(f.RemoteEvent.connectionSuccessful,function(e){t.onConnectionSuccessfulRPC(e)}),this.setRPCHandler(f.RemoteEvent.connectionFailed,function(){t.onConnectionFailedRPC()}),this.setRPCHandler(f.RemoteEvent.createConnection,function(e){t.onConnectionSuccessfulRPC(e)})}return o(e,[{key:"addHandler",value:function(e){this.handlers.push(e)}},{key:"close",value:function(){this.closing=!0,this.ws?(this.ws.onclose=null,this.ws.close(),this.onWSClosed(null)):this.log.warning("Try close unused WS in state "+s[this.currentState])}},{key:"cleanup",value:function(){u.PCFactory.get().closeAll(),this.pingTimer&&clearTimeout(this.pingTimer),this.pongTimer&&clearTimeout(this.pongTimer)}},{key:"onConnectionSuccessfulRPC",value:function(e){if(this.currentState!=s.WSCONNECTED)return void this.log.error("Can't handle __connectionSuccessful while in state "+s[this.currentState]);if(e&&(this.token=e),this.currentState=s.CONNECTED,this.handlers.length>0)for(var t=0;t<this.handlers.length;++t)try{this.handlers[t].onSignalingConnected()}catch(e){this.log.warning("Error in onSignalingConnected callback: "+e)}else this.log.warning("No VoxSignaling handler specified")}},{key:"onConnectionFailedRPC",value:function(){if(this.currentState!=s.WSCONNECTED)return void this.log.error("Can't handle __connectionSuccessful while in state "+s[this.currentState]);if(this.ws.onerror=null,this.ws.close(),this.ws=null,this.currentState=s.IDLE,this.handlers.length>0)for(var e=0;e<this.handlers.length;++e)try{this.handlers[e].onMediaConnectionFailed()}catch(e){this.log.warning("Error in onMediaConnectionFailed callback: "+e)}else this.log.warning("No VoxSignaling handler specified")}},{key:"connectTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this,o=arguments[3],i=arguments[4];if(this.manualDisconnect=!1,this.ver=i,this.currentState!=s.IDLE)return void this.log.error("Can't establish connection while in state "+s[this.currentState]);this.currentState=s.CONNECTING;var a=l.default.getWSVendor(o);this.ws=new WebSocket("ws"+(n?"s":"")+"://"+e+"/"+this.platform+"?version="+this.ver+"&client="+a+"&referrer=&extra="+this.extra+"&video="+(t?"true":"false")+"&client_version="+v.Client.getInstance().version),this.ws.onopen=function(e){return r.onWSConnected()},this.ws.onclose=function(e){return r.onWSClosed(e)},this.ws.onerror=function(e){return r.onWSError()},this.ws.onmessage=function(e){return r.onWSData(e.data)}}},{key:"setRPCHandler",value:function(e,t){void 0!==this.rpcHandlers[e]&&this.log.warning("Overwriting RPC handler for function "+e),this.rpcHandlers[e]=t}},{key:"removeRPCHandler",value:function(e){void 0!==this.rpcHandlers[e]||this.closing||this.log.warning("There is no RPC handler for function "+e),delete this.rpcHandlers[e]}},{key:"callRemoteFunction",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(this.currentState!=s.CONNECTED&&this.currentState!=s.WSCONNECTED)return this.closing||this.log.error("Can't make a RPC call in state "+s[this.currentState]),!1;if(void 0!==this.ws){this.writeLog&&this._opLog.push("send:"+JSON.stringify({name:e,params:n}));var o=JSON.stringify({name:e,params:n});return this.ws.send(o),c.LogManager.get().writeMessage(c.LogCategory.SIGNALING,"[wsdataout]",c.LogLevel.INFO,o),!0}}},{key:"onWSData",value:function(e){c.LogManager.get().writeMessage(c.LogCategory.SIGNALING,"[wsdatain]",c.LogLevel.INFO,e),this.writeLog&&this._opLog.push("recv:"+e);var t=void 0;try{t=JSON.parse(e)}catch(t){return void this.log.error("Can't parse JSON data: "+e)}void 0!==t.service?this.onWSMessData(t):this.onWSVoipData(t)}},{key:"onWSMessData",value:function(e){p.MsgSignaling.get().handleWsData(e)}},{key:"onWSVoipData",value:function(e){var t=e.name,n=e.params;if(void 0!==this.rpcHandlers[t])try{this.rpcHandlers[t].apply(null,n)}catch(e){this.log.warning("Error in '"+t+"' handler : "+e)}else this.log.warning("No handler for "+t)}},{key:"disconnect",value:function(){this.closing=!0,this.manualDisconnect=!0,this.onWSClosed(null),this.cleanup()}},{key:"onWSClosed",value:function(e){if(this.currentState!=s.CONNECTED&&this.currentState!=s.CONNECTING&&this.currentState!=s.CLOSING){if(this.closing)return;this.log.warning("onWSClosed in state "+s[this.currentState])}this.ws&&(this.ws.close(),this.ws=void 0);var t=this.currentState;if(this.pingTimer&&clearTimeout(this.pingTimer),this.pongTimer&&clearTimeout(this.pongTimer),this.cleanup(),this.currentState=s.IDLE,this.handlers.length>0)for(var n=0;n<this.handlers.length;++n)if(t!=s.CONNECTING&&t!=s.WSCONNECTED&&t!=s.IDLE||this.manualDisconnect)try{this.handlers[n].onSignalingClosed()}catch(e){this.log.warning("Error in onSignalingClosed callback: "+e)}else try{this.handlers[n].onSignalingConnectionFailed(e.reason)}catch(e){this.log.warning("Error in onSignalingConnectionFailed callback: "+e)}else this.log.warning("No VoxSignaling handler specified")}},{key:"onWSConnected",value:function(){var t=this;this.closing=!1,this.currentState!=s.CONNECTING&&this.log.warning("onWSConnected in state "+s[this.currentState]),this.currentState=s.WSCONNECTED,this.pingTimer=window.setTimeout(function(){return t.doPing()},e.PING_DELAY),this.setRPCHandler(f.RemoteEvent.pong,function(){return t.pongReceived()}),this.setRPCHandler(f.RemoteEvent.increaseGain,function(){t.log.info("Deprecated increaseGain")})}},{key:"onWSError",value:function(){if(this.currentState!=s.CONNECTING&&this.log.warning("onWSError in state "+this.currentState),this.ws.close(),this.ws=void 0,this.pingTimer&&clearTimeout(this.pingTimer),this.pongTimer&&clearTimeout(this.pongTimer),this.cleanup(),this.currentState=s.IDLE,void 0!==this.handlers)for(var e=0;e<this.handlers.length;++e)try{this.handlers[e].onSignalingConnectionFailed("Error connecting to VoxImplant server")}catch(e){this.log.warning("Error in onSignalingConnectionFailed callback: "+e)}else this.log.warning("No VoxSignaling handler specified")}},{key:"doPing",value:function(){var t=this;this.pingTimer=null,this.callRemoteFunction(g.RemoteFunction.ping,[]),this.pongTimer=window.setTimeout(function(){if(d.CallManager.get().numCalls>0)return void t.pongReceived();t.pongTimer=null;for(var e=0;e<t.handlers.length;++e)if(t.currentState==s.CONNECTED)try{t.handlers[e].onSignalingClosed()}catch(e){t.log.warning("Error in onSignalingClosed callback: "+e)}else try{t.handlers[e].onSignalingConnectionFailed("Connection closed")}catch(e){t.log.warning("Error in onSignalingConnectionFailed callback: "+e)}t.ws.close(),t.currentState=s.IDLE},e.PONG_DELAY)}},{key:"pongReceived",value:function(){var t=this;this.pongTimer&&(clearTimeout(this.pongTimer),this.pongTimer=null,this.pingTimer=window.setTimeout(function(){return t.doPing()},e.PING_DELAY))}},{key:"sendRaw",value:function(e){this.writeLog&&this._opLog.push("send:"+JSON.stringify(e));var t=JSON.stringify(e);return this.ws.send(t),c.LogManager.get().writeMessage(c.LogCategory.SIGNALING,"[wsdataout]",c.LogLevel.INFO,t),!0}},{key:"getLog",value:function(){return this._opLog}},{key:"lagacyConnectTo",value:function(e,t,n,r){this.ver="2",this.platform=r,this.referrer=t,this.connectTo(e,!1,!0,!0,"2")}},{key:"_traceName",value:function(){return"VoxSignaling"}}],[{key:"get",value:function(){return void 0===this.inst&&(this.inst=new e),this.inst}}]),e}();h.PING_DELAY=1e4,h.PONG_DELAY=1e4,a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"addHandler",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"close",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"cleanup",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"onConnectionSuccessfulRPC",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"onConnectionFailedRPC",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"connectTo",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"setRPCHandler",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"removeRPCHandler",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"callRemoteFunction",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"disconnect",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"onWSClosed",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"onWSConnected",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"onWSError",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],h.prototype,"sendRaw",null),t.VoxSignaling=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.ping="__ping"]="ping",e[e.login="login"]="login",e[e.loginGenerateOneTimeKey="loginGenerateOneTimeKey"]="loginGenerateOneTimeKey",e[e.loginStage2="loginStage2"]="loginStage2",e[e.setOperatorACDStatus="setOperatorACDStatus"]="setOperatorACDStatus",e[e.setDesiredVideoBandwidth="setDesiredVideoBandwidth"]="setDesiredVideoBandwidth",e[e.rejectCall="rejectCall"]="rejectCall",e[e.disconnectCall="disconnectCall"]="disconnectCall",e[e.sendDTMF="sendDTMF"]="sendDTMF",e[e.sendSIPInfo="sendSIPInfo"]="sendSIPInfo",e[e.hold="hold"]="hold",e[e.unhold="unhold"]="unhold",e[e.acceptCall="acceptCall"]="acceptCall",e[e.createCall="createCall"]="createCall",e[e.transferCall="transferCall"]="transferCall",e[e.muteLocal="__muteLocal"]="muteLocal",e[e.reInvite="ReInvite"]="reInvite",e[e.acceptReInvite="AcceptReInvite"]="acceptReInvite",e[e.rejectReInvite="RejectReInvite"]="rejectReInvite",e[e.confirmPC="__confirmPC"]="confirmPC",e[e.addCandidate="__addCandidate"]="addCandidate",e[e.loginUsingOneTimeKey="loginUsingOneTimeKey"]="loginUsingOneTimeKey",e[e.refreshOauthToken="refreshOauthToken"]="refreshOauthToken",e[e.zPromptFinished="promptFinished"]="zPromptFinished",e[e.zStartPreFlightCheck="__startPreFlightCheck"]="zStartPreFlightCheck",e[e.registerPushToken="registerPushToken"]="registerPushToken",e[e.unregisterPushToken="unregisterPushToken"]="unregisterPushToken",e[e.pushFeedback="pushFeedback"]="pushFeedback"}(t.RemoteFunction||(t.RemoteFunction={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var u=n(18),d=n(22),g=n(1),f=n(4),p=n(10),v=n(5),h=n(0),y=n(8),m=n(6),C=n(20),S=n(15),L=n(2),_=n(12),E=n(16),M=n(23),T=n(44),R=n(45),b=n(27),k=n(13),P=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(e._connected=!1,e.progressToneScript={US:"440@-19,480@-19;*(2/4/1+2)",RU:"425@-19;*(1/3/1)"},e.playingNow=!1,e.serversList=[],e._vol=100,e.micRequired=!1,e.videoConstraints=null,e.progressToneCountry="US",e.progressTone=!0,e.showDebugInfo=!1,e.showWarnings=!1,e.RTCsupported=!1,e._deviceEnumAPI=!1,e._h264first=!1,e._VP8first=!1,e.applyMixins(t,[S.EventDispatcher]),t.instance)throw new Error("Error - use VoxImplant.getInstance()");return t.instance=e,e._promises={},v.default.init(),y.PCFactory.get().requireMedia=!1,e.voxSignaling=g.VoxSignaling.get(),e.voxMediaManager=f.UserMediaManager.get(),e.voxCallManager=m.CallManager.get(),e.mediacache=M.MediaCache.get(),e.renderer=C.Renderer.get(),e.setLogLevelAll(h.LogLevel.NONE),h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"SDK ver.",h.LogLevel.TRACE,e.version),g.VoxSignaling.get().setRPCHandler(_.RemoteEvent.onPCStats,function(t,n){y.PCFactory.get().getPeerConnect(t)&&e.dispatchEvent({name:"NetStatsReceived",stats:n})}),e._defaultSinkId=null,e.loginState=0,e}return i(t,e),a(t,[{key:"applyMixins",value:function(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(n){e.prototype[n]=t.prototype[n]})})}},{key:"deviceEnumAPI",value:function(){var e=this;this.voxMediaManager.getDevices().then(function(){e._deviceEnumAPI=!0,e.dispatchEvent({name:u.Events.SourcesInfoUpdated})}).catch(function(e){this._deviceEnumAPI=!1})}},{key:"playProgressTone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(!e||e&&this.progressTone)&&null!==this.progressToneScript[this.progressToneCountry]&&(this.playingNow||this.playToneScript(this.progressToneScript[this.progressToneCountry]),this.playingNow=!0)}},{key:"stopProgressTone",value:function(){this.playingNow&&(this.stopPlayback(),this.playingNow=!1)}},{key:"onIncomingCall",value:function(e,t,n,r,o){this.dispatchEvent({name:u.Events.IncomingCall,call:m.CallManager.get().calls[e],headers:r,video:o})}},{key:"checkConnection",value:function(){if(!this._connected)throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}},{key:"init",value:function(e){var t=this;return new Promise(function(n,r){if(t._config=void 0!==e?e:{},void 0!==t._config.progressToneCountry&&(t.progressToneCountry=t._config.progressToneCountry),!0!==t._config.progressTone&&(t.progressTone=!1),void 0!==t._config.serverIp&&(t.serverIp=t._config.serverIp),void 0!==t._config.showDebugInfo&&(t.showDebugInfo=t._config.showDebugInfo),!1!==t._config.showWarnings&&(t.showWarnings=!0),"string"==typeof t._config.videoContainerId&&(t.remoteVideoContainerId=t._config.videoContainerId),"string"==typeof t._config.remoteVideoContainerId&&(t.remoteVideoContainerId=t._config.remoteVideoContainerId),"string"==typeof t._config.localVideoContainerId&&(t.localVideoContainerId=t._config.localVideoContainerId),!1!==t._config.micRequired&&(t.micRequired=!0),void 0!==t._config.videoSupport?t.videoSupport=t._config.videoSupport:t.videoSupport=!1,void 0!==t._config.H264first&&(t._h264first=t._config.H264first,m.CallManager.get()._h264first=t._h264first),void 0!==t._config.VP8first&&(t._VP8first=t._config.VP8first),void 0!==t._config.rtcStatsCollectionInterval?m.CallManager.get().rtcStatsCollectionInterval=t._config.rtcStatsCollectionInterval:m.CallManager.get().rtcStatsCollectionInterval=1e4,!t._config.protocolVersion||"2"!==t._config.protocolVersion&&"3"!==t._config.protocolVersion?t._callProtocolVersion="3":(t._callProtocolVersion=t._config.protocolVersion,m.CallManager.get().setProtocolVersion(t._callProtocolVersion)),t._config.callstatsIoParams&&E.CallstatsIo.get(t._config.callstatsIoParams),t._config.prettyPrint&&h.LogManager.get().setPrettyPrint(t._config.prettyPrint),t.showWarnings&&t.setLogLevelAll(h.LogLevel.WARNING),t.showDebugInfo&&t.setLogLevelAll(h.LogLevel.TRACE),h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"[sdkinit]",h.LogLevel.TRACE,t.version),h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"[sdkinit]",h.LogLevel.TRACE,JSON.stringify(t._config)),void 0!==t._config.videoConstraints)if(t.videoConstraints=t._config.videoConstraints,t._config.experiments&&t._config.experiments.hardware){var o=k.default.CameraManager.legacyParamConverter(t._config.videoConstraints);k.default.CameraManager.get().setDefaultCamera(o)}else f.UserMediaManager.get().setConstraints(t.videoConstraints,!1);if(f.UserMediaManager.get().enableAudio(t.micRequired),f.UserMediaManager.get().enableVideo(t.videoSupport),"127.0.0.1"!=window.location.hostname&&"localhost"!=window.location.hostname&&"https:"!=window.location.protocol&&void 0!==console.error&&t.showWarnings&&h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"WARNING:",h.LogLevel.WARNING,"getUserMedia() is deprecated on insecure origins, and support will be removed in the future. You should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details."),t._config.experiments&&t._config.experiments.ignorewebrtc)t.RTCsupported=!0;else if("undefined"!=typeof webkitRTCPeerConnection||"undefined"!=typeof mozRTCPeerConnection||"undefined"!=typeof RTCPeerConnection||"undefined"!=typeof RTCIceGatherer)if("undefined"!=typeof mozRTCPeerConnection)try{new mozRTCPeerConnection({iceServers:[]}),t.RTCsupported=!0}catch(e){}else t.RTCsupported=!0;if(!t.RTCsupported)throw r(new Error("NO_WEBRTC_SUPPORT")),new Error("NO_WEBRTC_SUPPORT");var i;null!=window.location.href.match(/^file\:\/{3}.*$/g)&&void 0!==console.error&&t.showWarnings&&console.error("WebRTC requires application to be loaded from a web server"),t.voxAuth=p.Authenticator.get(),t.voxAuth.setHandler({onLoginSuccessful:function(e,n){t.loginState=2;var r={name:u.Events.AuthResult,displayName:e,result:!0,tokens:n};t._resolvePromise("login",r),t.dispatchEvent(r)},onLoginFailed:function(e){t.loginState=0;var n={name:u.Events.AuthResult,code:e,result:!1};t._rejectPromise("login",n),t.dispatchEvent(n)},onSecondStageInitiated:function(){var e={name:u.Events.AuthResult,code:301,result:!1};t._rejectPromise("login",e),t.dispatchEvent(e)},onOneTimeKeyGenerated:function(e){var n={name:u.Events.AuthResult,key:e,code:302,result:!1};t._resolvePromise("loginkey",n),t.dispatchEvent(n)},onRefreshTokenFailed:function(e){var n={name:u.Events.RefreshTokenResult,code:e,result:!1};t._resolvePromise("token_refresh",n),t.dispatchEvent(n)},onRefreshTokenSuccess:function(e){var n={name:u.Events.RefreshTokenResult,tokens:e,result:!0};t._rejectPromise("token_refresh",n),t.dispatchEvent(n)}}),t.voxSignaling.addHandler(t),i=setInterval(function(){"undefined"!=typeof document&&(clearInterval(i),t.deviceEnumAPI(),t.dispatchEvent({name:u.Events.SDKReady,version:t.version}),n({name:u.Events.SDKReady,version:t.version}))},100)})}},{key:"_resolvePromise",value:function(e,t){var n=this._promises[e];n&&(n.resolve(t),this._promises[e]=void 0)}},{key:"_rejectPromise",value:function(e,t){var n=this._promises[e];n&&(n.reject(t),this._promises[e]=void 0)}},{key:"call",value:function(e,t,n,r){d.Utils.checkCA();var o={H264first:this._h264first,VP8first:this._VP8first};switch(o="string"==typeof e||"number"==typeof e?{number:e,video:t,customData:n,extraHeaders:r}:e,c(o.video)){case"boolean":o.video={sendVideo:o.video,receiveVideo:o.video};break;case"undefined":o.video={sendVideo:!1,receiveVideo:!0}}return this.voxCallManager.call(o)}},{key:"config",value:function(){return this._config}},{key:"connect",value:function(e){var t=this;return void 0!==this._config.experiments&&this._config.experiments.hardware&&(e=!1),void 0===e&&!1===this._config.micRequired&&(e=!1),new Promise(function(n,r){if(t._promises.connect={resolve:n,reject:r},void 0!==t.serverIp){var o=void 0;"object"===c(t.serverIp)?(t.serversList=t.serverIp,o=t.serversList[0]):o=t.serverIp,void 0===t._config.tryingServers&&(t._config.tryingServers=[]),t._config.tryingServers.push(o),h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"connecting",h.LogLevel.TRACE,o+" trying"),t.connectTo(o,null,e)}else{var i=function(t){var n=String(t).indexOf(";"),r=void 0;-1==n?r=t:(this.serversList=t.split(";"),r=this.serversList[0]),void 0===this._config.tryingServers&&(this._config.tryingServers=[]),this._config.tryingServers.push(r),h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"connecting",h.LogLevel.TRACE,r+" trying"),this.connectTo(r,null,e)};d.Utils.getServers(i.bind(t),!1,t)}})}},{key:"connectTo",value:function(e,t,n){var r=this;if(this._connected)throw new Error("ALREADY_CONNECTED_TO_VOXIMPLANT");this.host=e,this.micRequired&&!0!==t?this.voxMediaManager.queryMedia().then(function(e){r.deviceEnumAPI(),r.micRequired&&r.voxSignaling.connectTo(r.host,!0,!0,n,r._callProtocolVersion),r.dispatchEvent({name:u.Events.MicAccessResult,result:!0,stream:e})}).catch(function(e){r.dispatchEvent({name:u.Events.MicAccessResult,result:!1,reason:e})}):this.voxSignaling.connectTo(e,!0,!0,n,this._callProtocolVersion)}},{key:"disconnect",value:function(){this.checkConnection(),this.voxSignaling.disconnect(),this.voxMediaManager.stopLocalStream(),this.voxSignaling.removeRPCHandler(_.RemoteEvent.onCallRemoteFunctionError),this.voxSignaling.removeRPCHandler(_.RemoteEvent.handleError)}},{key:"setOperatorACDStatus",value:function(e){var t=this;return new Promise(function(n,r){d.Utils.checkCA(),t.voxSignaling.callRemoteFunction(L.RemoteFunction.setOperatorACDStatus,e),n()})}},{key:"login",value:function(e,t,n){var r=this;return this.loginState=1,new Promise(function(o,i){if(r._promises.login={resolve:o,reject:i},n=void 0!==n?n:{},n=d.Utils.extend({},n),!r._connected)throw i(new Error("NOT_CONNECTED_TO_VOXIMPLANT")),new Error("NOT_CONNECTED_TO_VOXIMPLANT");r._config.experiments&&r._config.experiments.mediaServer&&(n.mediaServer=r._config.experiments.mediaServer),r.voxAuth.basicLogin(e,t,n)})}},{key:"loginWithCode",value:function(e,t,n){var r=this;return this.loginState=1,new Promise(function(o,i){if(r._promises.login={resolve:o,reject:i},n=void 0!==n?n:{},n=d.Utils.extend({serverPresenceControl:!1},n),!r._connected)throw i(new Error("NOT_CONNECTED_TO_VOXIMPLANT")),new Error("NOT_CONNECTED_TO_VOXIMPLANT");r.voxAuth.loginStage2(e,t,n)})}},{key:"loginWithToken",value:function(e,t,n){var r=this;return this.loginState=1,new Promise(function(o,i){if(r._promises.login={resolve:o,reject:i},n=void 0!==n?n:{},n=d.Utils.extend({serverPresenceControl:!1},n),n.accessToken=t,!r._connected)throw i(new Error("NOT_CONNECTED_TO_VOXIMPLANT")),new Error("NOT_CONNECTED_TO_VOXIMPLANT");r.voxAuth.tokenLogin(e,n)})}},{key:"tokenRefresh",value:function(e,t,n){var r=this;return new Promise(function(o,i){r._promises.token_refresh={resolve:o,reject:i},r.voxAuth.tokenRefresh(e,t,n)})}},{key:"requestOneTimeLoginKey",value:function(e){var t=this;return new Promise(function(n,r){if(t._promises.loginkey={resolve:n,reject:r},!t._connected)throw r(new Error("NOT_CONNECTED_TO_VOXIMPLANT")),new Error("NOT_CONNECTED_TO_VOXIMPLANT");t.voxAuth.generateOneTimeKey(e)})}},{key:"loginWithOneTimeKey",value:function(e,t,n){var r=this;return this.loginState=1,new Promise(function(o,i){if(r._promises.login={resolve:o,reject:i},n=void 0!==n?n:{},n=d.Utils.extend({serverPresenceControl:!1},n),!r._connected)throw i(new Error("NOT_COFNNECTED_TO_VOXIMPLANT")),new Error("NOT_CONNECTED_TO_VOXIMPLANT");r.voxAuth.loginUsingOneTimeKey(e,t,n)})}},{key:"connected",value:function(){return this._connected}},{key:"showLocalVideo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._config.experiments&&this._config.experiments.hardware){var o=document.getElementById(t.getInstance().localVideoContainerId)||document.body,i=document.getElementById("voximplantlocalvideo");e?(null===i?(i=document.createElement("video"),i.id="voximplantlocalvideo",i.autoplay=!0,i.setAttribute("playsinline",null),i.setAttribute("muted",null),o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i)):i.style.display="block",k.default.StreamManager.get().getMirrorStream().then(function(e){v.default.attachMedia(e,i)})):(void 0!==i&&null!==i&&(i.style.display="none"),r&&k.default.StreamManager.get().remMirrorStream()),n&&i&&(i.style.cssText+="transform: rotateY(180deg);-webkit-transform:rotateY(180deg);-moz-transform:rotateY(180deg);")}else this.voxMediaManager.showLocalVideo(e,n,r)}},{key:"setLocalVideoPosition",value:function(e,t){throw new Error("Deprecated: please use CSS to position '#voximplantlocalvideo' element")}},{key:"setLocalVideoSize",value:function(e,t){throw new Error("Deprecated: please use CSS to set size of '#voximplantlocalvideo' element")}},{key:"setVideoSettings",value:function(e,t,n){var r=this;f.UserMediaManager.get().setConstraints(e,!0).then(function(e){null!==document.getElementById("voximplantlocalvideo")&&v.default.attachMedia(r.voxMediaManager.currentStream,document.getElementById("voximplantlocalvideo")),"function"==typeof t&&t(e)}).catch(function(e){"function"==typeof n&&n(e)})}},{key:"setVideoBandwidth",value:function(e){this.checkConnection(),y.PCFactory.get().setBandwidthParams(e),this.voxSignaling.callRemoteFunction(L.RemoteFunction.setDesiredVideoBandwidth,e)}},{key:"playToneScript",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d.Utils.playToneScript(e,t)}},{key:"stopPlayback",value:function(){d.Utils.stopPlayback()&&this.dispatchEvent({name:u.Events.PlaybackFinished})}},{key:"volume",value:function(e){if(void 0===e)return this._vol;e>100&&(e=100),e<0&&(e=0),C.Renderer.get().setPlaybackVolume(e/100),this._vol=e}},{key:"audioSources",value:function(){return this.voxMediaManager.audioSourcesList}},{key:"videoSources",value:function(){return this.voxMediaManager.videoSourcesList}},{key:"audioOutputs",value:function(){return this.voxMediaManager.audioOutputsList}},{key:"useAudioSource",value:function(e,t,n){var r=this;return new Promise(function(o,i){r.voxMediaManager.useAudioInputDevice(e),r.voxMediaManager.enableAudio(!0),r.voxMediaManager.queryMedia().then(function(e){"function"==typeof t&&t(e),o(e),f.UserMediaManager.get().updateLocalVideo(e)}).catch(function(e){"function"==typeof n&&n(e),i(e)})})}},{key:"useVideoSource",value:function(e,t,n){var r=this;return new Promise(function(o,i){r.voxMediaManager.useVideoDevice(e),f.UserMediaManager.get().isVideoEnabled()?r.voxMediaManager.queryMedia().then(function(e){"function"==typeof t&&t(e),f.UserMediaManager.get().updateLocalVideo(e),o(e)}).catch(function(e){"function"==typeof n&&n(e),i(e)}):f.UserMediaManager.get().updateLocalVideo()})}},{key:"useAudioOutput",value:function(e){var t=this;return new Promise(function(n,r){"chrome"!==v.default.getWSVendor(!0)&&r(new Error("Unsupported browser. Only Google Chrome 49 and above.")),t._defaultSinkId=e,n()})}},{key:"attachRecordingDevice",value:function(e,t){var n=this;return this.voxMediaManager.enableAudio(!0),this._config.videoSupport&&this.voxMediaManager.enableVideo(!0),new Promise(function(r,o){return n.voxMediaManager.queryMedia().then(function(t){"function"==typeof e&&e(t),n.dispatchEvent({name:u.Events.MicAccessResult,result:!0,stream:t})}).catch(function(e){"function"==typeof t&&t(e),n.dispatchEvent({name:u.Events.MicAccessResult,result:!1,reason:e})})})}},{key:"detachRecordingDevice",value:function(){f.UserMediaManager.get().stopLocalStream()}},{key:"setCallActive",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(function(n,r){if(d.Utils.checkCA(),e)return e.setActive(t);r("trying to hold unknown call "+e)})}},{key:"sendVideo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.voxMediaManager.sendVideo(e)}},{key:"isRTCsupported",value:function(){if("undefined"!=typeof webkitRTCPeerConnection||"undefined"!=typeof mozRTCPeerConnection||"undefined"!=typeof RTCPeerConnection||"undefined"!=typeof RTCIceGatherer){if("undefined"==typeof mozRTCPeerConnection)return!0;try{return new mozRTCPeerConnection({iceServers:[]}),!0}catch(e){return!1}}}},{key:"transferCall",value:function(e,t){d.Utils.checkCA(),this.voxCallManager.transferCall(e,t)}},{key:"setLogLevel",value:function(e,t){h.LogManager.get().setLogLevel(e,t)}},{key:"setLogLevelAll",value:function(e){this.setLogLevel(h.LogCategory.SIGNALING,e),this.setLogLevel(h.LogCategory.RTC,e),this.setLogLevel(h.LogCategory.ORTC,e),this.setLogLevel(h.LogCategory.USERMEDIA,e),this.setLogLevel(h.LogCategory.CALL,e),this.setLogLevel(h.LogCategory.CALLEXP2P,e),this.setLogLevel(h.LogCategory.CALLEXSERVER,e),this.setLogLevel(h.LogCategory.CALLMANAGER,e),this.setLogLevel(h.LogCategory.CLIENT,e),this.setLogLevel(h.LogCategory.AUTHENTICATOR,e),this.setLogLevel(h.LogCategory.PCFACTORY,e),this.setLogLevel(h.LogCategory.UTILS,e),this.setLogLevel(h.LogCategory.MESSAGING,e),this.setLogLevel(h.LogCategory.REINVITEQ,e),this.setLogLevel(h.LogCategory.HARDWARE,e)}},{key:"onSignalingConnected",value:function(){this._connected=!0;var e={name:u.Events.ConnectionEstablished};this._resolvePromise("connect",e),this.dispatchEvent(e)}},{key:"onSignalingClosed",value:function(){this._connected=!1,this.dispatchEvent({name:u.Events.ConnectionClosed}),this.progressTone&&this.stopProgressTone()}},{key:"onSignalingConnectionFailed",value:function(e){if(this._connected=!1,this.serversList.length>1&&(void 0===this.serverIp||"object"===c(this.serverIp))){h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"connecting",h.LogLevel.TRACE,"Connection to the "+this.serversList[0]+" falled"),this.serversList.splice(0,1);var t=this.serversList[0];void 0===this._config.tryingServers&&(this._config.tryingServers=[]),this._config.tryingServers.push(t),h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"connecting",h.LogLevel.TRACE,t+" trying"),this.connectTo(t,!0)}else{h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"",h.LogLevel.INFO,"We can't connect to the Voximplant cloud. Please, check UDP connection to Voximplant servers: "+this._config.tryingServers.join(", "));var n={name:u.Events.ConnectionFailed,message:e};this._rejectPromise("connect",n),this.dispatchEvent(n)}}},{key:"onMediaConnectionFailed",value:function(){}},{key:"getCall",value:function(e){return m.CallManager.get().calls[e]}},{key:"removeCall",value:function(e){m.CallManager.get().removeCall(e)}},{key:"screenSharingSupported",value:function(){return v.default.screenSharingSupported()}},{key:"addEventListener",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addEventListener",this).call(this,e,n)}},{key:"removeEventListener",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeEventListener",this).call(this,e,n)}},{key:"on",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,e,n)}},{key:"off",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,e,n)}},{key:"sslset",value:function(e){this.voxSignaling.writeLog=e}},{key:"sslget",value:function(){return this.voxSignaling.getLog()}},{key:"getZingayaAPI",value:function(){return new T.ZingayaAPI(this)}},{key:"getMediaCache",value:function(){return M.MediaCache.get()}},{key:"registerForPushNotificatuons",value:function(e){return R.PushService.register(e)}},{key:"unregisterForPushNotificatuons",value:function(e){return R.PushService.unregister(e)}},{key:"handlePushNotification",value:function(e){return R.PushService.incomingPush(e)}},{key:"getGUID",value:function(){return(new b.GUID).toString()}},{key:"setSilentLogging",value:function(e){this.enableSilentLogging(e)}},{key:"enableSilentLogging",value:function(e){h.LogManager.get().shadowLogging=e}},{key:"clearSilentLog",value:function(){h.LogManager.get().clearSilentLog()}},{key:"getSilentLog",value:function(){return h.LogManager.get().getSLog()}},{key:"setLoggerCallback",value:function(e){h.LogManager.get().setLoggerCallback(e)}},{key:"getClientState",value:function(){var e=this.voxSignaling.currentState;return e==g.VoxSignalingState.CONNECTING||e==g.VoxSignalingState.WSCONNECTED?h.ClientState.CONNECTING:e==g.VoxSignalingState.CLOSING||e==g.VoxSignalingState.IDLE?h.ClientState.DISCONNECTED:e==g.VoxSignalingState.CONNECTED?1==this.loginState?h.ClientState.LOGGING_IN:2==this.loginState?h.ClientState.LOGGED_IN:h.ClientState.CONNECTED:void 0}},{key:"setSwfColor",value:function(){h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"NOT SUPPORTED",h.LogLevel.ERROR,"setSwfColor deprecated, and not supported!")}},{key:"_traceName",value:function(){return"Client"}},{key:"version",get:function(){return"4.2.11037"}}],[{key:"getInstance",value:function(){return void 0===t.instance&&(t.instance=new t),t.instance}}]),t}(S.EventDispatcher);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"deviceEnumAPI",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"playProgressTone",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"stopProgressTone",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onIncomingCall",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"checkConnection",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"init",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"call",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"config",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"connect",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"connectTo",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"disconnect",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setOperatorACDStatus",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"login",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"loginWithCode",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"loginWithToken",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"tokenRefresh",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"requestOneTimeLoginKey",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"loginWithOneTimeKey",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"connected",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"showLocalVideo",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setLocalVideoPosition",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setLocalVideoSize",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setVideoSettings",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setVideoBandwidth",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"playToneScript",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"stopPlayback",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"volume",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"audioSources",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"videoSources",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"audioOutputs",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"useAudioSource",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"useVideoSource",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"useAudioOutput",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"attachRecordingDevice",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"detachRecordingDevice",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setCallActive",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"sendVideo",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"isRTCsupported",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"transferCall",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setLogLevel",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setLogLevelAll",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onSignalingConnected",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onSignalingClosed",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onSignalingConnectionFailed",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onMediaConnectionFailed",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"getCall",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"removeCall",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"addEventListener",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"removeEventListener",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"on",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"off",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P,"getInstance",null),t.Client=P},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s,c=n(0),l=n(33),u=n(5),d=n(8),g=n(3);!function(e){e[e.LOCAL=-1]="LOCAL",e[e.ANY=0]="ANY",e[e.REMOTE=1]="REMOTE"}(s=t.MediaDirection||(t.MediaDirection={}));var f=function(){function e(){if(r(this,e),this.audioSourcesList=[],this.videoSourcesList=[],this.audioOutputsList=[],this.videoContainerId="voximplantlocalvideo",this.log=c.LogManager.get().createLogger(c.LogCategory.USERMEDIA,""),this.config=new l.MediaCaptureConfig,this.clearConstraints(),this.enableAudio(!0),this.enableVideo(!0),this.handlers=new Array,this.mediaAccessGranted=!1,this._localVideos=new Array,void 0!==window.AudioContext||void 0!==window.webkitAudioContext){window.AudioContext=window.AudioContext||window.webkitAudioContext;try{this.audioContext=new AudioContext}catch(e){this.audioContext=null}}}return o(e,[{key:"clearConstraints",value:function(){}},{key:"addHandler",value:function(e){this.handlers.push(e)}},{key:"enableAudio",value:function(e){this.config.audioEnabled=e}},{key:"enableVideo",value:function(e){this.config.videoEnabled=e}},{key:"setLocalStream",value:function(e){if(e.getAudioTracks().length>0&&(this.currentAudioTrack=e.getAudioTracks()[0]),e.getVideoTracks().length>0&&(this.currentVideoTrack=e.getVideoTracks()[0]),this._currentStream){for(;this._currentStream.getTracks().length>0;)this._currentStream.removeTrack(this._currentStream.getTracks()[0]);this.currentAudioTrack&&this._currentStream.addTrack(this.currentAudioTrack),this.currentVideoTrack&&this._currentStream.addTrack(this.currentVideoTrack)}else this._currentStream=e;for(var t in d.PCFactory.get().peerConnections)this.attachTo(d.PCFactory.get().peerConnections[t])}},{key:"queryMedia",value:function(){var e=u.default.composeConstraints(this.config);return this.getQueryMedia(e)}},{key:"queryMediaSilent",value:function(){var e=u.default.composeConstraints(this.config);return this.muteAllLocal(),this.getQueryMediaSilent(e)}},{key:"getConstrainWithSendFlag",value:function(e,t){var n=JSON.parse(JSON.stringify(this.config));return null!=e&&(n.audioEnabled=e),null!=t&&(n.videoEnabled=t),u.default.composeConstraints(n)}},{key:"getQueryMedia",value:function(e){var t=this;return new Promise(function(n,r){t.getQueryMediaSilent(e).then(function(e){t.processGrantedMedia(e),n(e)}).catch(function(e){return r(e)})})}},{key:"getQueryMediaSilent",value:function(e){var t=this;return new Promise(function(n,r){u.default.getUserMedia(e).then(function(r){t.validConstraints=e,t.log.info("Media access granted"),n(r)}).catch(function(e){e?t.log.info("Media access rejected: "+e.name):t.log.info("Media access rejected!"),t.validConstraints&&u.default.getUserMedia(t.validConstraints).then(function(e){t.log.info("Regained media access using previous settings"),n(e)}).catch(function(e){r(e),t.log.error("Failed to regain media access with previously valid constraints")}),r(e)})})}},{key:"processGrantedMedia",value:function(e){var t=this;this.stopLocalStream(),this.setLocalStream(e),this.handlers.forEach(function(n){try{n.onMediaAccessGranted(e)}catch(e){t.log.error("Error in callback "+e)}})}},{key:"muteAllLocal",value:function(){this.currentAudioTrack&&(this.currentAudioTrack.stop(),this.currentAudioTrack=null),this.currentVideoTrack&&(this.currentVideoTrack.stop(),this.currentVideoTrack=null)}},{key:"getDevices",value:function(){return 0!==e.get().audioSourcesList.length&&(this.audioSourcesList=[]),0!==e.get().videoSourcesList.length&&(this.videoSourcesList=[]),0!==e.get().audioOutputsList.length&&(this.audioOutputsList=[]),new Promise(function(t,n){navigator.mediaDevices.enumerateDevices().then(function(n){for(var r=0;r!=n.length;++r){var o=[0,0,0],i=n[r];"audio"===i.kind||"audioinput"===i.kind?e.get().audioSourcesList.push({id:i.id||i.deviceId,name:i.label||"Audio recording device "+o[0]++}):"video"===i.kind||"videoinput"===i.kind?e.get().videoSourcesList.push({id:i.id||i.deviceId,name:i.label||"Video recording device "+o[1]++}):"audiooutput"===i.kind&&e.get().audioOutputsList.push({id:i.id||i.deviceId,name:i.label||"Audio playback device "+o[2]++})}t()}).catch(function(e){n(e)})})}},{key:"useVideoDevice",value:function(e){this.config.videoInputId=e}},{key:"useAudioInputDevice",value:function(e){this.config.audioInputId=e}},{key:"attachTo",value:function(e){this._legacySoundControll=!0,e.bindLocalMedia(this._currentStream)}},{key:"attachToSound",value:function(e){this._legacySoundControll=!0,this._currentStream&&this._currentStream.getAudioTracks().length&&e.bindLocalMedia(new MediaStream(this._currentStream.getAudioTracks()))}},{key:"sendVideo",value:function(e){this.currentVideoTrack&&(this.currentVideoTrack.enabled=e)}},{key:"isVideoEnabled",value:function(){return this.config.videoEnabled}},{key:"stopLocalStream",value:function(){if(this._currentStream){this.stopStream(this._currentStream),this._currentStream=null;for(var e in d.PCFactory.get().peerConnections)d.PCFactory.get().peerConnections.hasOwnProperty(e)&&d.PCFactory.get().peerConnections[e].bindLocalMedia(null)}}},{key:"stopStream",value:function(e){e.getTracks().forEach(function(e){e.stop()})}},{key:"setConstraints",value:function(e,t){var n=this;return this.config.videoEnabled=!0,new Promise(function(r,o){n.config.setVideoSettings(e),!0===t&&n.queryMedia().then(function(e){r(e)}).catch(function(e){o(e)})})}},{key:"showLocalVideo",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.currentLocalVideoSets={flag:t,mirror:r,detachCamera:o},void 0!==this.currentStream){var i=document.getElementById(g.Client.getInstance().localVideoContainerId)||document.body,a=document.getElementById(this.videoContainerId);if(t)null===a?(a=document.createElement("video"),a.id=this.videoContainerId,a.autoplay=!0,a.setAttribute("playsinline",null),a.setAttribute("muted",null),i.firstChild?i.insertBefore(a,i.firstChild):i.appendChild(a)):a.style.display="block",u.default.getUserMedia(e.get().getConstrainWithSendFlag(!1,!0)).then(function(e){n._localVideos.push(e),u.default.attachMedia(e,a)});else if(void 0!==a&&null!==a&&(a.style.display="none"),o)for(var s=0;s<this._localVideos.length;s++)this.stopStream(this._localVideos[s]);r&&a&&(a.style.cssText+="transform: rotateY(180deg);-webkit-transform:rotateY(180deg);-moz-transform:rotateY(180deg);")}}},{key:"resetLocalVideo",value:function(){this._localVideos=[],this.showLocalVideo(this.currentLocalVideoSets.flag,this.currentLocalVideoSets.mirror,this.currentLocalVideoSets.detachCamera)}},{key:"updateLocalVideo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=document.getElementById(this.videoContainerId);if(null===e&&null!==t&&"none"!=t.style.display)this.showLocalVideo(!0);else{if(null===t||0==e.getVideoTracks().length)return!1;u.default.attachMedia(e,t)}}},{key:"testLocalStream",value:function(e,t){var n=!1,r=!1,o=!0,i=!1,a=void 0;try{for(var s,c=this._currentStream.getTracks()[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var l=s.value;"audio"===l.kind&&(n=!0),"video"===l.kind&&(r=!0)}}catch(e){i=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw a}}return e===n&&t===r}},{key:"_traceName",value:function(){return"UserMediaManager"}},{key:"currentStream",get:function(){return this._currentStream}},{key:"legacySoundControll",get:function(){return this._legacySoundControll}}],[{key:"get",value:function(){return this.inst||(this.inst=new e),this.inst}},{key:"updateMuteState",value:function(t,n,r){var o=d.PCFactory.get().peerConnections;for(var i in o)if(o.hasOwnProperty(i))switch(n){case s.ANY:this.updateMuteState(t,s.LOCAL,r),this.updateMuteState(t,s.REMOTE,r);break;case s.LOCAL:e.getAudioTracks(o[i].localStream).map(function(e){e.enabled=r});break;case s.REMOTE:return void o[i].remoteStreams.map(function(t){e.getAudioTracks(t).map(function(e){e.enabled=r})});default:return!1}}},{key:"getAudioTracks",value:function(e){if(e){if(e.audioTracks)return e.audioTracks;if(e.getAudioTracks)return e.getAudioTracks()}return null}},{key:"getVideoTracks",value:function(e){if(e){if(e.videoTracks)return e.videoTracks;if(e.getVideoTracks)return e.getVideoTracks()}return null}}]),e}();a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"clearConstraints",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"addHandler",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"enableAudio",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"enableVideo",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"setLocalStream",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"queryMedia",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"queryMediaSilent",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"processGrantedMedia",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"muteAllLocal",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"getDevices",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"useVideoDevice",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"useAudioInputDevice",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"attachTo",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"attachToSound",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"sendVideo",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"stopLocalStream",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"stopStream",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"setConstraints",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"showLocalVideo",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"updateLocalVideo",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f.prototype,"testLocalStream",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f,"updateMuteState",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f,"getAudioTracks",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],f,"getVideoTracks",null),t.UserMediaManager=f},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(0),a=n(31),s=n(39),c=n(40),l=n(42),u=n(17),d=n(43);!function(e){function t(e,t,n){var o=e;return"object"!=(void 0===o?"undefined":r(o))&&(o={}),o[t]={ideal:n},o}function n(e,t,n){switch(S){case C.Firefox:case C.Webkit:case C.Safari:case C.Edge:return new c.WebRTCPC(e,t,n);default:return i.LogManager.get().writeMessage(i.LogCategory.RTC,"Core",i.LogLevel.INFO,"Unsupported browser "+navigator.userAgent),null}}function o(){return S===C.Firefox||S===C.Webkit}function g(e){return navigator.mediaDevices.getUserMedia(e)}function f(e,t){return new u.SignalingDTMFSender(t)}function p(){return new Promise(function(e){e(!1)})}function v(e){var n=!1,r=!1;return e.audioEnabled&&(n=!0,e.audioInputId&&(n=t(n,"deviceId",e.audioInputId))),e.videoEnabled&&(r=!0,e.videoSettings&&(r=e.videoSettings),e.videoInputId&&(r=t(r,"deviceId",e.videoInputId))),{peerIdentity:null,audio:n,video:r}}function h(){if(!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]))return"voxmobile";switch(S||y(),S){case C.Firefox:return"firefox";case C.Webkit:return"chrome";case C.Safari:return"safari";case C.Edge:return"voxmobile";default:return""}}function y(){navigator.mozGetUserMedia?S=C.Firefox:navigator.webkitGetUserMedia?S=C.Webkit:navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?S=C.Edge:navigator.getUserMedia&&(S=C.Safari)}function m(){switch(S||y(),S&&i.LogManager.get().writeMessage(i.LogCategory.RTC,"Core",i.LogLevel.INFO,"Detected browser "+C[S]),e.getUserMedia=g,e.getDTMFSender=f,e.screenSharingSupported=p,S){case C.Firefox:e.attachMedia=a.FF.attachStream,e.detachMedia=a.FF.detachStream,e.getScreenMedia=a.FF.getScreenMedia,e.getRTCStats=a.FF.getRTCStats,e.getUserMedia=a.FF.getUserMedia,e.screenSharingSupported=a.FF.screenSharingSupported,e.getDTMFSender=a.FF.getDTMFSender;break;case C.Webkit:e.attachMedia=s.Webkit.attachStream,e.detachMedia=s.Webkit.detachStream,e.getScreenMedia=s.Webkit.getScreenMedia,e.getRTCStats=s.Webkit.getRTCStats,e.getUserMedia=s.Webkit.getUserMedia,e.screenSharingSupported=s.Webkit.screenSharingSupported,e.getDTMFSender=s.Webkit.getDTMFSender;break;case C.Safari:e.attachMedia=d.Safari.attachStream,e.detachMedia=d.Safari.detachStream,e.getScreenMedia=d.Safari.getScreenMedia,e.getRTCStats=d.Safari.getRTCStats,e.getUserMedia=a.FF.getUserMedia,e.getDTMFSender=d.Safari.getDTMFSender;break;case C.Edge:e.attachMedia=l.Edge.attachStream,e.detachMedia=l.Edge.detachStream,e.getScreenMedia=l.Edge.getScreenMedia,e.getRTCStats=l.Edge.getRTCStats;break;default:i.LogManager.get().writeMessage(i.LogCategory.RTC,"Core",i.LogLevel.INFO,"Unsupported browser "+navigator.userAgent)}e.composeConstraints=v}var C=void 0;!function(e){e[e.Firefox=1]="Firefox",e[e.Webkit=2]="Webkit",e[e.Edge=3]="Edge",e[e.Safari=4]="Safari"}(C||(C={}));var S=void 0;e.peerConnectionFactory=n,e.isScreenSharingSupported=o,e.getWSVendor=h,e.init=m}(o||(o={})),t.default=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(14),c=n(9),l=n(1),u=n(22),d=n(10),g=n(11),f=n(0),p=n(8),v=n(3),h=n(19),y=n(35),m=n(36),C=n(2),S=n(12),L=n(37),_=n(16),E=n(38),M=n(21),T=function(){function e(){var t=this;r(this,e),this.protocolVersion="3",this._h264first=!1,this._calls={},this.voxSignaling=l.VoxSignaling.get(),this.log=f.LogManager.get().createLogger(f.LogCategory.SIGNALING,"CallManager"),this.voxSignaling.addHandler(this),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleIncomingConnection,function(e,n,r,o,i){t.handleIncomingConnection(e,n,r,o,i)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleConnectionConnected,function(e,n,r){t.handleConnectionConnected(e,n,r)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleConnectionDisconnected,function(e,n,r){t.handleConnectionDisconnected(e,n,r)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleRingOut,function(e){t.handleRingOut(e)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.stopRinging,function(e){t.stopRinging(e)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleConnectionFailed,function(e,n,r,o){t.handleConnectionFailed(e,n,r,o)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleSIPInfo,function(e,n,r,o,i){t.handleSIPInfo(e,n,r,o,i)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleSipEvent,function(e){t.handleSipEvent(e)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleTransferStarted,function(e){t.handleTransferStarted(e)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleTransferComplete,function(e){t.handleTransferComplete(e)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleTransferFailed,function(e){t.handleTransferFailed(e)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleReInvite,function(e,n,r){t.handleInReinvite(e,n,r)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleAcceptReinvite,function(e,n,r){t.handleReinvite(e,n,r)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.handleRejectReinvite,function(e,n,r){t.handleRejectReinvite(e,n,r)}),this.voxSignaling.setRPCHandler(S.RemoteEvent.startEarlyMedia,function(e,n,r){t.startEarlyMedia(e,n,r)})}return o(e,[{key:"call",value:function(t){var n=this,r={number:null,video:{sendVideo:!1,receiveVideo:!1},customData:null,extraHeaders:{},wiredLocal:!0,wiredRemote:!0,H264first:this._h264first,VP8first:!1,forceActive:!1,extraParams:{}},o=u.Utils.mixObjectToLeft(r,t);o=e.addCustomDataToHeaders(o);var i=u.Utils.generateUUID();if(this._calls[i])throw this.log.error("Call "+i+" already exists"),new Error("Internal error");var a=this.getCallInstance(i,d.Authenticator.get().displayName,!1,o);_.CallstatsIo.isModuleEnabled()&&(o.extraHeaders[g.Constants.CALLSTATSIOID_HEADER]=i),o.VP8first&&(a.rearangeCodecs=E.CodecSorterHelpers.VP8Sorter),o.H264first&&(a.rearangeCodecs=E.CodecSorterHelpers.H264Sorter);var s=!1;return a.settings.active=!0,Object.keys(this._calls).length>1&&!o.forceActive&&(a.setActiveForce(!1),s=!0),void 0===o.extraHeaders[g.Constants.DIRECT_CALL_HEADER]&&"2"==this.protocolVersion?this.voxSignaling.callRemoteFunction(C.RemoteFunction.createCall,-1,o.number,o.video,i,null,null,o.extraHeaders,o.extraParams):p.PCFactory.get().setupDirectPC(i,h.PeerConnectionMode.P2P,t.video,s).then(function(e){a.peerConnection=p.PCFactory.get().peerConnections[i];var t={tracks:a.peerConnection.getTrackKind()};n.voxSignaling.callRemoteFunction(C.RemoteFunction.createCall,-1,o.number,!0,i,null,null,o.extraHeaders,"",e.sdp,t)}),a.sendVideo(o.video.sendVideo),a}},{key:"handleIncomingConnection",value:function(e,t,n,r,o){var i=this;if(this._calls[e])throw this.log.error("Call "+e+" already exists"),new Error("Internal error");var a=M.SDPMuggle.detectDirections(o),s=a.some(function(e){return"video"===e.type&&("sendonly"===e.direction||"sendrecv"===e.direction)}),c={number:t,extraHeaders:r,video:s,wiredLocal:!0,wiredRemote:!0,forceActive:!1},l=this.getCallInstance(e,n,!0,c);this._h264first&&(l.rearangeCodecs=E.CodecSorterHelpers.H264Sorter);var u=!1;l.settings.active=!0,Object.keys(this._calls).length>1&&(l.setActiveForce(!1),u=!0),void 0===c.extraHeaders[g.Constants.DIRECT_CALL_HEADER]&&"2"==this.protocolVersion?(l.peerConnection=p.PCFactory.get().getPeerConnect(e),v.Client.getInstance().onIncomingCall(e,t,n,r,this.isSDPHasVideo(o))):p.PCFactory.get().incomeDirectPC(e,{receiveVideo:!0,sendVideo:!0},o,u).then(function(a){l.peerConnection=a,v.Client.getInstance().onIncomingCall(e,t,n,r,i.isSDPHasVideo(o))})}},{key:"getCallInstance",value:function(e,t,n,r){var o=void 0;return o="3"==this.protocolVersion?new L.CallExMedia(e,t,n,r):void 0!==r.extraHeaders[g.Constants.DIRECT_CALL_HEADER]?new m.CallExP2P(e,t,n,r):new y.CallExServer(e,t,n,r),this._calls[e]=o,o}},{key:"isSDPHasVideo",value:function(e){var t=e.indexOf("m=video");if(-1===t)return!1;var n=e.indexOf("a=sendrecv",t),r=e.indexOf("a=sendonly",t),o=e.indexOf("m=",t);return-1!==n&&(n<o||-1===o)||-1!==r&&(r<o||-1===o)}},{key:"findCall",value:function(e,t){var n=this._calls[e];return""===e&&(n=this._calls[Object.keys(this._calls)[0]]),void 0===n?(this.log.warning("Received "+t+" for unknown call "+e),null):n}},{key:"handleRingOut",value:function(e){var t=this.findCall(e,"handleRingOut");void 0!==t&&(v.Client.getInstance().playProgressTone(!0),t.onRingOut(),t.canStartSendingCandidates())}},{key:"handleConnectionConnected",value:function(e,t,n){var r=this.findCall(e,"handleConnectionConnected");if(r.signalingConnected=!0,r.canStartSendingCandidates(),void 0!==r&&(r.onConnected(t,n),void 0!==n&&n.length>0)){var o=n.indexOf("m=video");if(-1!==o){var i=n.indexOf("a=sendrecv",o),a=n.indexOf("a=sendonly",o),s=n.indexOf("a=recvonly",o),c=n.indexOf("a=inactive",o);-1===i&&-1===a&&-1===s&&-1===c&&(n+="a=inactive\r\n")}r.peerConnection.processRemoteAnswer(t,n)}}},{key:"startEarlyMedia",value:function(e,t,n){var r=this.findCall(e,"startEarlyMedia");r.settings.hasEarlyMedia=!0,void 0!==n&&r.peerConnection.processRemoteAnswer(t,n),v.Client.getInstance().stopProgressTone()}},{key:"handleConnectionDisconnected",value:function(e,t,n){var r=this.findCall(e,"handleConnectionDisconnected");r&&(v.Client.getInstance().stopProgressTone(),r.onDisconnected(t,n),delete this._calls[e])}},{key:"handleSIPInfo",value:function(e,t,n,r,o){var i=this.findCall(e,"handleSIPInfo");void 0!==i&&i.onInfo(i,t,n,r,o)}},{key:"stopRinging",value:function(e){var t=this.findCall(e,"stopRinging");t.canStartSendingCandidates(),void 0!==t&&(v.Client.getInstance().stopProgressTone(),t.onStopRinging())}},{key:"handleSipEvent",value:function(e){}},{key:"handleTransferStarted",value:function(e){}},{key:"handleTransferComplete",value:function(e){var t=this.findCall(e,"handleTransferComplete");void 0!==t&&t.onTransferComplete()}},{key:"handleTransferFailed",value:function(e){var t=this.findCall(e,"handleTransferFailed");void 0!==t&&t.onTransferFailed()}},{key:"handleReinvite",value:function(e,t,n){var r=this.findCall(e,"handleReinvite");if(void 0!==r){var o=this.isSDPHasVideo(n);r.peerConnection.handleReinvite(t,n,o)}}},{key:"handleRejectReinvite",value:function(e,t,n){var r=this.findCall(e,"handleReinvite");void 0!==r&&r.dispatchEvent({code:20,call:r})}},{key:"handleInReinvite",value:function(e,t,n){var r=this.findCall(e,"handleReinvite");void 0!==r&&(r.runIncomingReInvite(t,n),r.dispatchEvent({name:c.CallEvents.PendingUpdate,result:!0,call:r}))}},{key:"handleConnectionFailed",value:function(e,t,n,r){var o=this.findCall(e,"handleConnectionFailed");void 0!==o&&(delete this._calls[e],v.Client.getInstance().stopProgressTone(),o.onFailed(t,n,r))}},{key:"onSignalingConnected",value:function(){}},{key:"onSignalingClosed",value:function(){for(var e in this._calls)this._calls.hasOwnProperty(e)&&(this._calls[e].hangup(),this._calls[e].onFailed(409,"Connection Closed",{}))}},{key:"onSignalingConnectionFailed",value:function(e){}},{key:"onMediaConnectionFailed",value:function(){}},{key:"recalculateNumCalls",value:function(){this._numCalls=0;for(var e in this._calls)this._calls.hasOwnProperty(e)&&this._numCalls++}},{key:"transferCall",value:function(e,t){for(var n=[e,t],r=0;r<n.length;r++){var o=this._calls[n[r].id()];if(!o)return void this.log.error("trying to transfer unknown call "+o.id());if(o.stateValue!=s.CallState.CONNECTED)return void this.log.error("trying to transfer call "+o.id()+" in state "+o.state())}this.voxSignaling.callRemoteFunction(C.RemoteFunction.transferCall,e.id(),t.id())}},{key:"removeCall",value:function(e){delete this._calls[e]}},{key:"setProtocolVersion",value:function(e){this.protocolVersion=e}},{key:"_traceName",value:function(){return"CallManager"}},{key:"numCalls",get:function(){return this._numCalls}},{key:"calls",get:function(){return this._calls}}],[{key:"get",value:function(){return void 0===this.inst&&(this.inst=new e),this.inst}},{key:"addCustomDataToHeaders",value:function(e){return void 0!==e.customData&&(void 0===e.extraHeaders&&(e.extraHeaders={}),e.extraHeaders["VI-CallData"]=e.customData),e}},{key:"cleanHeaders",value:function(e){var t={};for(var n in e)"X-"!=n.substring(0,2)&&n!=g.Constants.CALL_DATA_HEADER||(t[n]=e[n]);return t}}]),e}();a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"call",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"handleIncomingConnection",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"findCall",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"handleRingOut",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"handleConnectionConnected",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"handleConnectionDisconnected",null),a([f.LogManager.d_trace(f.LogCategory.CALLEXSERVER)],T.prototype,"handleSIPInfo",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"stopRinging",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"handleSipEvent",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"handleTransferStarted",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"handleTransferComplete",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"handleTransferFailed",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"handleReinvite",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"handleRejectReinvite",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"handleInReinvite",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"handleConnectionFailed",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"onSignalingConnected",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"onSignalingClosed",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"onSignalingConnectionFailed",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T.prototype,"removeCall",null),a([f.LogManager.d_trace(f.LogCategory.CALLMANAGER)],T,"addCustomDataToHeaders",null),t.CallManager=T},function(e,t,n){"use strict";function r(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function o(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return o.apply(this,arguments);var i=function(e){r(n(e))};return this._eventMap=this._eventMap||{},this._eventMap[r]=i,o.apply(this,[e,i])};var i=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return i.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],i.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}var i=!0,a=!0;e.exports={extractVersion:r,wrapPeerConnectionEvent:o,disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(a=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){a&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,n={};if(n.browser=null,n.version=null,void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=r(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)n.browser="chrome",n.version=r(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=r(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=r(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n}}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(19),c=n(1),l=n(4),u=n(0),d=n(6),g=n(14),f=n(5),p=n(2),v=n(12),h=n(3),y=n(13),m=n(21),C=function(){function e(){var t=this;r(this,e),this.iceConfig=null,this._peerConnections={},this.waitingPeerConnections={},this.log=u.LogManager.get().createLogger(u.LogCategory.RTC,"PCFactory"),this._requireMedia=!0,c.VoxSignaling.get().setRPCHandler(v.RemoteEvent.createPC,function(e,n){t.rpcHandlerCreatePC(e,n)}),c.VoxSignaling.get().setRPCHandler(v.RemoteEvent.destroyPC,function(e){t.rpcHandlerDestroyPC(e)}),c.VoxSignaling.get().addHandler(this)}return o(e,[{key:"rpcHandlerCreatePC",value:function(t,n){if(n=m.SDPMuggle.addSetupAttribute(n),l.UserMediaManager.get().currentStream||!this._requireMedia)return c.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.muteLocal,t,!1),this.createPC(t,n,s.PeerConnectionMode.CLIENT_SERVER_V1,e.sdpOffersVideo(n));this.waitingPeerConnections[t]=n}},{key:"rpcHandlerDestroyPC",value:function(e){this._peerConnections[e]&&(this._peerConnections[e].close(),delete this._peerConnections[e]),delete this.waitingPeerConnections[e]}},{key:"createPC",value:function(e,t,n,r){var o=this,i=f.default.peerConnectionFactory(e,n,r);l.UserMediaManager.get().attachTo(i),this._peerConnections[e]=i;var a=d.CallManager.get().calls[e];return t&&i.processRemoteOffer(t).then(function(t){void 0===a||a.checkCallMode(g.CallMode.SERVER)?c.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.confirmPC,e,t):c.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.acceptCall,[e,d.CallManager.cleanHeaders(a.headers()),t]),"__default"!==e&&void 0!==d.CallManager.get().calls[e]&&(d.CallManager.get().calls[e].peerConnection=i)}).catch(function(e){o.log.error("Error during PC creation: "+e)}),i}},{key:"setupDirectPC",value:function(e,t,n,r){var o=this,i=f.default.peerConnectionFactory(e,t,n);i.setHoldKey(r);var a=h.Client.getInstance().config();if(a.experiments&&a.experiments.hardware){var s=y.default.StreamManager.get(),c=d.CallManager.get().calls[e];return s.getCallStream(c).then(function(t){return i.bindLocalMedia(t),o._peerConnections[e]=i,i.getLocalOffer()})}if(n.sendVideo){var u=l.UserMediaManager.get().getConstrainWithSendFlag(!0,n.sendVideo);return i.setVideoEnabled(n),l.UserMediaManager.get().getQueryMediaSilent(u).then(function(t){return i.bindLocalMedia(t),o._peerConnections[e]=i,i.getLocalOffer()})}return l.UserMediaManager.get().attachToSound(i),this._peerConnections[e]=i,i.getLocalOffer()}},{key:"incomeDirectPC",value:function(e,t,n,r){var o=this,i=f.default.peerConnectionFactory(e,s.PeerConnectionMode.P2P,t);return i.setHoldKey(r),i._setRemoteDescription(n).then(function(){return o._peerConnections[e]=i,i})}},{key:"getPeerConnect",value:function(e){return this._peerConnections[e]}},{key:"onMediaAccessRejected",value:function(){}},{key:"onMediaAccessGranted",value:function(t){for(var n in this.waitingPeerConnections)this.createPC(n,this.waitingPeerConnections[n],s.PeerConnectionMode.CLIENT_SERVER_V1,e.sdpOffersVideo(this.waitingPeerConnections[n]));this.waitingPeerConnections={}}},{key:"onSignalingConnected",value:function(){}},{key:"onSignalingClosed",value:function(){this.log.info("Closing all peer connections because signaling connection has closed"),this.waitingPeerConnections={};for(var e in this._peerConnections)this._peerConnections[e].close();this._peerConnections={}}},{key:"onSignalingConnectionFailed",value:function(e){}},{key:"onMediaConnectionFailed",value:function(){}},{key:"closeAll",value:function(){for(var e in this._peerConnections)this._peerConnections[e].close();this._peerConnections={}}},{key:"setBandwidthParams",value:function(e){this._bandwidthParams=e}},{key:"addBandwidthParams",value:function(e){return this._bandwidthParams&&(e.sdp=e.sdp.replace(/(a=mid:video.*\r\n)/g,"$1b=AS:"+this._bandwidthParams+"\r\n")),e}},{key:"_traceName",value:function(){return"PCFactory"}},{key:"requireMedia",get:function(){return this._requireMedia},set:function(e){this._requireMedia=e}},{key:"peerConnections",get:function(){return this._peerConnections}}],[{key:"get",value:function(){return null===this.inst&&(this.inst=new e),this.inst}},{key:"sdpOffersVideo",value:function(e){return{receiveVideo:-1!==e.indexOf("m=video"),sendVideo:!0}}}]),e}();C.inst=null,a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"rpcHandlerCreatePC",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"rpcHandlerDestroyPC",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"createPC",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"setupDirectPC",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"incomeDirectPC",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"getPeerConnect",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"onMediaAccessRejected",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"onMediaAccessGranted",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"onSignalingConnected",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"onSignalingClosed",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"onSignalingConnectionFailed",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"onMediaConnectionFailed",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"closeAll",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"setBandwidthParams",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"addBandwidthParams",null),a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C,"sdpOffersVideo",null),t.PCFactory=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.Connected="Connected"]="Connected",e[e.Disconnected="Disconnected"]="Disconnected",e[e.Failed="Failed"]="Failed",e[e.ProgressToneStart="ProgressToneStart"]="ProgressToneStart",e[e.ProgressToneStop="ProgressToneStop"]="ProgressToneStop",e[e.MessageReceived="onSendMessage"]="MessageReceived",e[e.InfoReceived="InfoReceived"]="InfoReceived",e[e.TransferComplete="TransferComplete"]="TransferComplete",e[e.TransferFailed="TransferFailed"]="TransferFailed",e[e.ICETimeout="ICETimeout"]="ICETimeout",e[e.RTCStatsReceived="RTCStatsReceived"]="RTCStatsReceived",e[e.MediaElementCreated="MediaElementCreated"]="MediaElementCreated",e[e.MediaElementRemoved="MediaElementRemoved"]="MediaElementRemoved",e[e.ICECompleted="ICECompleted"]="ICECompleted",e[e.Updated="Updated"]="Updated",e[e.PendingUpdate="PendingUpdate"]="PendingUpdate",e[e.UpdateFailed="UpdateFailed"]="UpdateFailed",e[e.LocalVideoStreamAdded="LocalVideoStreamAdded"]="LocalVideoStreamAdded",e[e.EndPointCreated="EndPointCreated"]="EndPointCreated",e[e.EndPointRemoved="EndPointRemoved"]="EndPointRemoved"}(t.CallEvents||(t.CallEvents={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s,c=n(1),l=n(0),u=n(8),d=n(2),g=n(12),f=n(16);!function(e){e[e.IDLE=0]="IDLE",e[e.IN_PROGRESS=1]="IN_PROGRESS"}(s=t.AuthenticatorState||(t.AuthenticatorState={}));var p=function(){function e(){var t=this;r(this,e),this.FAIL_CODE_SECOND_STAGE=301,this.FAIL_CODE_ONE_TIME_KEY=302,this._displayName=null,this._username=null,this._authorized=!1,this.signaling=c.VoxSignaling.get(),this.currentState=s.IDLE,this.log=l.LogManager.get().createLogger(l.LogCategory.SIGNALING,"Authenticator"),this.signaling.setRPCHandler(g.RemoteEvent.loginFailed,function(e,n){t.onLoginFailed(e,n)}),this.signaling.setRPCHandler(g.RemoteEvent.loginSuccessful,function(e,n){t.onLoginSuccesful(e,n)}),this.signaling.setRPCHandler(g.RemoteEvent.refreshOauthTokenFailed,function(e){t.handler.onRefreshTokenFailed(e)}),this.signaling.setRPCHandler(g.RemoteEvent.refreshOauthTokenSuccessful,function(e){t.handler.onRefreshTokenSuccess(e.OAuth)}),this.signaling.addHandler(this)}return o(e,[{key:"setHandler",value:function(e){this.handler=e}},{key:"onLoginFailed",value:function(e,t){switch(this.currentState=s.IDLE,e){case this.FAIL_CODE_ONE_TIME_KEY:this.handler.onOneTimeKeyGenerated(t);break;case this.FAIL_CODE_SECOND_STAGE:this.handler.onSecondStageInitiated();break;default:this.handler.onLoginFailed(e)}}},{key:"onLoginSuccesful",value:function(e,t){this.currentState=s.IDLE,this._authorized=!0,t&&(u.PCFactory.get().iceConfig=t.iceConfig),this._displayName=e,f.CallstatsIo.get().init({userName:this._username,aliasName:this._displayName}),this.handler.onLoginSuccessful(e,t.OAuth)}},{key:"basicLogin",value:function(e,t,n){if(this.currentState!=s.IDLE)return void this.log.error("Login operation already in progress");this._username=e,this.currentState=s.IN_PROGRESS,this.signaling.callRemoteFunction(d.RemoteFunction.login,e,t,n)}},{key:"tokenLogin",value:function(e,t){if(this.currentState!=s.IDLE)return void this.log.error("Login operation already in progress");this._username=e,this.currentState=s.IN_PROGRESS,this.signaling.callRemoteFunction(d.RemoteFunction.login,e,"",t)}},{key:"tokenRefresh",value:function(e,t,n){n?this.signaling.callRemoteFunction(d.RemoteFunction.refreshOauthToken,e,{refreshToken:t,deviceToken:n}):this.signaling.callRemoteFunction(d.RemoteFunction.refreshOauthToken,e,t)}},{key:"loginUsingOneTimeKey",value:function(e,t,n){if(this.currentState!=s.IDLE)return void this.log.error("Login operation already in progress");this._username=e,this.currentState=s.IN_PROGRESS,this.signaling.callRemoteFunction(d.RemoteFunction.loginUsingOneTimeKey,e,t,n)}},{key:"loginStage2",value:function(e,t,n){if(this.currentState!=s.IDLE)return void this.log.error("Login operation already in progress");this._username=e,this.currentState=s.IN_PROGRESS,this.signaling.callRemoteFunction(d.RemoteFunction.loginStage2,e,t,n)}},{key:"generateOneTimeKey",value:function(e){if(this.currentState!=s.IDLE)return void this.log.error("Login operation already in progress");this.currentState=s.IN_PROGRESS,this.signaling.callRemoteFunction(d.RemoteFunction.loginGenerateOneTimeKey,e)}},{key:"username",value:function(){return this._username}},{key:"authorized",value:function(){return this._authorized}},{key:"onSignalingConnected",value:function(){}},{key:"onSignalingConnectionFailed",value:function(e){}},{key:"onSignalingClosed",value:function(){this._authorized=!1,this._displayName=null,this._username=null}},{key:"onMediaConnectionFailed",value:function(){}},{key:"ziAuthorized",value:function(e){this._authorized=e}},{key:"_traceName",value:function(){return"Authenticator"}},{key:"displayName",get:function(){return this._displayName}}],[{key:"get",value:function(){return void 0===this.inst&&(this.inst=new e),this.inst}}]),e}();a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"setHandler",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"onLoginFailed",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"onLoginSuccesful",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"basicLogin",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"tokenLogin",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"tokenRefresh",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"loginUsingOneTimeKey",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"loginStage2",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"generateOneTimeKey",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"username",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"authorized",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"onSignalingConnected",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"onSignalingConnectionFailed",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"onSignalingClosed",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],p.prototype,"onMediaConnectionFailed",null),t.Authenticator=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(){r(this,e)};o.DIRECT_CALL_HEADER="X-DirectCall",o.VIAMEDIA_CALL_HEADER="X-ViaMedia",o.CALLSTATSIOID_HEADER="X-CallstatsIOID",o.CALL_DATA_HEADER="VI-CallData",o.ZINGAYA_IM_MIME_TYPE="application/zingaya-im",o.P2P_SPD_FRAG_MIME_TYPE="voximplant/sdpfrag",o.VI_HOLD_EMUL="vi/holdemul",o.VI_SPD_OFFER_MIME_TYPE="vi/sdpoffer",o.VI_SPD_ANSWER_MIME_TYPE="vi/sdpanswer",o.VI_CONF_PARTICIPANT_INFO_ADDED="vi/conf-info-added",o.VI_CONF_PARTICIPANT_INFO_REMOVED="vi/conf-info-removed",o.VI_CONF_PARTICIPANT_INFO_UPDATED="vi/conf-info-updated",t.Constants=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.loginFailed="loginFailed"]="loginFailed",e[e.loginSuccessful="loginSuccessful"]="loginSuccessful",e[e.handleError="handleError"]="handleError",e[e.onPCStats="__onPCStats"]="onPCStats",e[e.handleIncomingConnection="handleIncomingConnection"]="handleIncomingConnection",e[e.handleConnectionConnected="handleConnectionConnected"]="handleConnectionConnected",e[e.handleConnectionDisconnected="handleConnectionDisconnected"]="handleConnectionDisconnected",e[e.handleRingOut="handleRingOut"]="handleRingOut",e[e.startEarlyMedia="startEarlyMedia"]="startEarlyMedia",e[e.stopRinging="stopRinging"]="stopRinging",e[e.handleConnectionFailed="handleConnectionFailed"]="handleConnectionFailed",e[e.handleSIPInfo="handleSIPInfo"]="handleSIPInfo",e[e.handleSipEvent="handleSipEvent"]="handleSipEvent",e[e.handleTransferStarted="handleTransferStarted"]="handleTransferStarted",e[e.handleTransferComplete="handleTransferComplete"]="handleTransferComplete",e[e.handleTransferFailed="handleTransferFailed"]="handleTransferFailed",e[e.handleReInvite="handleReInvite"]="handleReInvite",e[e.handleAcceptReinvite="handleAcceptReinvite"]="handleAcceptReinvite",e[e.handleRejectReinvite="handleRejectReinvite"]="handleRejectReinvite",e[e.createPC="__createPC"]="createPC",e[e.destroyPC="__destroyPC"]="destroyPC",e[e.connectionSuccessful="__connectionSuccessful"]="connectionSuccessful",e[e.connectionFailed="__connectionFailed"]="connectionFailed",e[e.createConnection="__createConnection"]="createConnection",e[e.pong="__pong"]="pong",e[e.increaseGain="increaseGain"]="increaseGain",e[e.handlePreFlightCheckResult="handlePreFlightCheckResult"]="handlePreFlightCheckResult",e[e.handleVoicemail="handleVoicemail"]="handleVoicemail",e[e.onCallRemoteFunctionError="onCallRemoteFunctionError"]="onCallRemoteFunctionError",e[e.refreshOauthTokenFailed="refreshOauthTokenFailed"]="refreshOauthTokenFailed",e[e.refreshOauthTokenSuccessful="refreshOauthTokenSuccessful"]="refreshOauthTokenSuccessful"}(t.RemoteEvent||(t.RemoteEvent={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":s(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var l,u=n(0),d=n(15);!function(e){var t=void 0;!function(e){e[e.MirrorUpdated="MirrorUpdated"]="MirrorUpdated"}(t=e.StreamEvents||(e.StreamEvents={}));var n=void 0;!function(e){e[e.VIDEO_QUALITY_HIGH="video_quality_high"]="VIDEO_QUALITY_HIGH",e[e.VIDEO_QUALITY_LOW="video_quality_low"]="VIDEO_QUALITY_LOW",e[e.VIDEO_QUALITY_MEDIUM="video_quality_medium"]="VIDEO_QUALITY_MEDIUM",e[e.VIDEO_QUALITY_QQVGA="video_quality_qqvga"]="VIDEO_QUALITY_QQVGA",e[e.VIDEO_QUALITY_QCIF="video_quality_qcif"]="VIDEO_QUALITY_QCIF",e[e.VIDEO_QUALITY_QVGA="video_quality_qvga"]="VIDEO_QUALITY_QVGA",e[e.VIDEO_QUALITY_CIF="video_quality_cif"]="VIDEO_QUALITY_CIF",e[e.VIDEO_QUALITY_nHD="video_quality_nhd"]="VIDEO_QUALITY_nHD",e[e.VIDEO_QUALITY_VGA="video_quality_vga"]="VIDEO_QUALITY_VGA",e[e.VIDEO_QUALITY_SVGA="video_quality_svga"]="VIDEO_QUALITY_SVGA",e[e.VIDEO_QUALITY_HD="video_quality_hd"]="VIDEO_QUALITY_HD",e[e.VIDEO_QUALITY_UXGA="video_quality_uxga"]="VIDEO_QUALITY_UXGA",e[e.VIDEO_QUALITY_FHD="video_quality_fhd"]="VIDEO_QUALITY_FHD",e[e.VIDEO_QUALITY_UHD="video_quality_uhd"]="VIDEO_QUALITY_UHD"}(n=e.VideoQuality||(e.VideoQuality={}));var s=function(e){function n(){r(this,n);var e=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));if(void 0!==n.instance)throw new Error("Error - use StreamManager.get()");return e._callStreams={},e}return i(n,e),a(n,[{key:"onMirrorEnded",value:function(){var e=this;this.remMirrorStream(),this.getMirrorStream().then(function(n){e.dispatchEvent({name:t.MirrorUpdated,stream:n})})}},{key:"getMirrorStream",value:function(){var e=this;return new Promise(function(t,n){if(void 0===e._mirrorStream)return navigator.mediaDevices.getUserMedia({video:g.get().getCallConstraints("__local__")}).then(function(n){e._mirrorStream=n,e._mirrorStream.getTracks().forEach(function(t){t.onended=e.onMirrorEnded,t.onmute=e.onMirrorEnded}),t(n)},n);t(e._mirrorStream)})}},{key:"remMirrorStream",value:function(){void 0!==this._mirrorStream&&(this._mirrorStream.getTracks().forEach(function(e){e.onended=void 0,e.onmute=void 0,e.stop()}),this._mirrorStream=void 0)}},{key:"onEchoEnded",value:function(){var e=this;this.getEchoStream(),this.getEchoStream().then(function(n){e.dispatchEvent({name:t.MirrorUpdated,stream:n})})}},{key:"getEchoStream",value:function(){var e=this;return new Promise(function(t,n){if(void 0===e._echoStream)return navigator.mediaDevices.getUserMedia({audio:l.get().getCallConstraints("__local__")}).then(function(n){e._echoStream=n,e._echoStream.getTracks().forEach(function(t){t.onended=e.onEchoEnded,t.onmute=e.onEchoEnded}),t(n)},n);t(e._echoStream)})}},{key:"remEchoStream",value:function(){void 0!==this._echoStream&&(this._echoStream.getTracks().forEach(function(e){e.onended=void 0,e.onmute=void 0,e.stop()}),this._echoStream=void 0)}},{key:"getCallStream",value:function(e){var t=this;return new Promise(function(n,r){return t._callStreams[e.id()]?t._callStreams[e.id()]:navigator.mediaDevices.getUserMedia(t._composeConstraints(e)).then(function(r){t._callStreams[e.id()]=r,r.getTracks().forEach(function(e){e.onended=t.omCallEnded,e.onmute=t.omCallEnded}),n(r)},r)})}},{key:"omCallEnded",value:function(){}},{key:"_updateCallStream",value:function(e){return this.remCallStream(e),this.getCallStream(e)}},{key:"remCallStream",value:function(e){this._callStreams[e.id()]&&(this._callStreams[e.id()].getTracks().forEach(function(e){e.onended=void 0,e.onmute=void 0,e.stop()}),this._callStreams[e.id()]=void 0)}},{key:"clear",value:function(){this._mirrorStream.getTracks().forEach(function(e){e.onended=void 0,e.onmute=void 0,e.stop()}),this._mirrorStream=void 0;for(var e in this._callStreams)if(this._callStreams.hasOwnProperty(e)){var t=this._callStreams[e];t.getTracks().forEach(function(e){e.onended=void 0,e.onmute=void 0,e.stop()})}this._callStreams={}}},{key:"_composeConstraints",value:function(e){var t={};return e.settings.videoDirections.sendVideo?t.video=g.get().getCallConstraints(e.id()):t.video=!1,e.settings.audioDirections.sendAudio?t.audio=l.get().getCallConstraints(e.id()):t.audio=!1,t}},{key:"_traceName",value:function(){return"StreamManager"}}],[{key:"get",value:function(){return void 0===n.instance&&(n.instance=new n),n.instance}}]),n}(d.EventDispatcher);c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],s.prototype,"onMirrorEnded",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],s.prototype,"getMirrorStream",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],s.prototype,"remMirrorStream",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],s.prototype,"onEchoEnded",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],s.prototype,"getEchoStream",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],s.prototype,"remEchoStream",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],s.prototype,"getCallStream",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],s.prototype,"omCallEnded",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],s.prototype,"_updateCallStream",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],s.prototype,"remCallStream",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],s.prototype,"clear",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],s.prototype,"_composeConstraints",null),e.StreamManager=s;var l=function(){function e(){if(r(this,e),void 0!==e.instance)throw new Error("Error - use StreamManager.get()");this._supportedConstraints=navigator.mediaDevices.getSupportedConstraints(),this._defaultParams={},this._lastAudioInputDevices=[],this._lastAudioOutputDevices=[],this._callParams={}}return a(e,[{key:"getInputDevices",value:function(){var e=this;return navigator.mediaDevices.enumerateDevices().then(function(t){return e._lastAudioInputDevices=t.map(function(e){if("audio"===e.kind||"audioinput"===e.kind)return{id:e.deviceId,name:e.label,group:e.groupId}}),e._lastAudioInputDevices})}},{key:"getCameraDevices",value:function(){var e=this;return navigator.mediaDevices.enumerateDevices().then(function(t){return e._lastAudioOutputDevices=t.map(function(e){if("audiooutput"===e.kind)return{id:e.deviceId,name:e.label,group:e.groupId}}),e._lastAudioOutputDevices})}},{key:"setDefaultAudio",value:function(e){this._defaultParams=e}},{key:"setAudio",value:function(e,t){this._callParams[e.id()]=t}},{key:"getCallConstraints",value:function(e){return this._callParams[e]?this._getAudioConstraints(this._callParams[e]):(this._callParams[e]=this._defaultParams,this._getAudioConstraints(this._defaultParams))}},{key:"_getAudioConstraints",value:function(e){var t="ideal";e.strict&&(t="exact");var n={};return e.inputId&&(this._lastAudioInputDevices.some(function(t){return t.id===e.inputId})?(n.deviceId={},n.deviceId[t]=e.inputId):u.LogManager.get().writeMessage(u.LogCategory.USERMEDIA,"Warning:",u.LogLevel.WARNING,"There is no audio input device with id "+e.inputId)),e.echoCancellation&&this._supportedConstraints.echoCancellation&&(n.echoCancellation=e.echoCancellation),e.noiseSuppression&&this._supportedConstraints.noiseSuppression&&(n.noiseSuppression=e.echoCancellation),n}},{key:"_traceName",value:function(){return"AudioDeviceManager"}}],[{key:"get",value:function(){return void 0===e.instance&&(e.instance=new e),e.instance}}]),e}();c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],l.prototype,"getInputDevices",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],l.prototype,"getCameraDevices",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],l.prototype,"setDefaultAudio",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],l.prototype,"setAudio",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],l.prototype,"getCallConstraints",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],l.prototype,"_getAudioConstraints",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],l,"get",null),e.AudioDeviceManager=l;var g=function(){function e(){if(r(this,e),void 0!==e.instance)throw new Error("Error - use StreamManager.get()");this._supportedConstraints=navigator.mediaDevices.getSupportedConstraints(),this._callParams={},this._lastCameraDevices=[],this._defaultParams={}}return a(e,[{key:"setDefaultCamera",value:function(e){var t=this._validateCameraParams(e);this._defaultParams=t}},{key:"setCamera",value:function(e,t){var n=this._validateCameraParams(t);this._callParams[e.id()]=n}},{key:"getCallConstraints",value:function(e){return this._callParams[e]?this._getVideoConstraints(this._callParams[e]):(this._callParams[e]=this._defaultParams,this._getVideoConstraints(this._defaultParams))}},{key:"getOutputDevices",value:function(){var e=this;return navigator.mediaDevices.enumerateDevices().then(function(t){return e._lastCameraDevices=t.map(function(e){if("video"===e.kind||"videoinput"===e.kind)return{id:e.deviceId,name:e.label,group:e.groupId}}),e._lastCameraDevices})}},{key:"_getVideoConstraints",value:function(e){var t={};return e.cameraId?this._lastCameraDevices.some(function(t){return t.id===e.cameraId})?(t.deviceId={},t.deviceId.ideal=e.cameraId):u.LogManager.get().writeMessage(u.LogCategory.USERMEDIA,"Warning:",u.LogLevel.WARNING,"There is no video device with id "+e.cameraId):void 0!==e.facingMode&&(!1===e.facingMode?t.facingMode="environment":t.facingMode="user"),e.frameHeight&&(t.height={},e.strict?(t.height.min=e.frameHeight,t.height.max=e.frameHeight):t.height.ideal=e.frameHeight),e.frameWidth&&(t.width={},e.strict?(t.width.min=e.frameWidth,t.width.max=e.frameWidth):t.width.ideal=e.frameWidth),e.frameRate&&e.frameRate>0&&this._supportedConstraints.frameRate&&(t.frameRate=e.frameRate+""),t}},{key:"_validateCameraParams",value:function(e){if(e.videoQuality)switch((e.frameHeight||e.frameWidth)&&u.LogManager.get().writeMessage(u.LogCategory.USERMEDIA,"Warning:",u.LogLevel.WARNING,'"videoQuality" parameter detected. The "frameHeight" and the "frameWidth" params will be ignored'),e.videoQuality){case n.VIDEO_QUALITY_HIGH:e.frameWidth=1280,e.frameHeight=720;break;case n.VIDEO_QUALITY_MEDIUM:e.frameWidth=640,e.frameHeight=480;break;case n.VIDEO_QUALITY_LOW:e.frameWidth=320,e.frameHeight=240;break;case n.VIDEO_QUALITY_QQVGA:e.frameWidth=160,e.frameHeight=120;break;case n.VIDEO_QUALITY_QCIF:e.frameWidth=176,e.frameHeight=144;break;case n.VIDEO_QUALITY_QVGA:e.frameWidth=320,e.frameHeight=240;break;case n.VIDEO_QUALITY_CIF:e.frameWidth=352,e.frameHeight=288;break;case n.VIDEO_QUALITY_nHD:e.frameWidth=640,e.frameHeight=360;break;case n.VIDEO_QUALITY_VGA:e.frameWidth=640,e.frameHeight=480;break;case n.VIDEO_QUALITY_SVGA:e.frameWidth=800,e.frameHeight=600;break;case n.VIDEO_QUALITY_HD:e.frameWidth=1280,e.frameHeight=720;break;case n.VIDEO_QUALITY_UXGA:e.frameWidth=1600,e.frameHeight=1200;break;case n.VIDEO_QUALITY_FHD:e.frameWidth=1920,e.frameHeight=1080;break;case n.VIDEO_QUALITY_UHD:e.frameWidth=3840,e.frameHeight=2160;break;default:e.frameWidth=320,e.frameHeight=240}return e}},{key:"_traceName",value:function(){return"CameraManager"}}],[{key:"get",value:function(){return void 0===e.instance&&(e.instance=new e),e.instance}},{key:"legacyParamConverter",value:function(e){var t={videoQuality:n.VIDEO_QUALITY_MEDIUM};return e.width&&("string"==typeof e.width||"number"==typeof e.width?(delete t.videoQuality,t.frameWidth=e.width):"string"==typeof e.width.exact||"number"==typeof e.width.exact?(delete t.videoQuality,t.frameWidth=e.width.exact,t.strict=!0):"string"==typeof e.width.min||"number"==typeof e.width.min?(delete t.videoQuality,t.frameWidth=e.width.min):"string"==typeof e.width.max||"number"==typeof e.width.max?(delete t.videoQuality,t.frameWidth=e.width.max):"string"!=typeof e.width.ideal&&"number"!=typeof e.width.ideal||(delete t.videoQuality,t.frameWidth=e.width.ideal)),e.height&&("string"==typeof e.height||"number"==typeof e.height?(delete t.videoQuality,t.frameHeight=e.height):"string"==typeof e.height.exact||"number"==typeof e.height.exact?(delete t.videoQuality,t.frameHeight=e.height.exact,t.strict=!0):"string"==typeof e.height.min||"number"==typeof e.height.min?(delete t.videoQuality,t.frameHeight=e.height.min):"string"==typeof e.height.max||"number"==typeof e.height.max?(delete t.videoQuality,t.frameHeight=e.height.max):"string"!=typeof e.height.ideal&&"number"!=typeof e.height.ideal||(delete t.videoQuality,t.frameHeight=e.height.ideal)),t}}]),e}();c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],g.prototype,"setDefaultCamera",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],g.prototype,"setCamera",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],g.prototype,"getCallConstraints",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],g.prototype,"getOutputDevices",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],g.prototype,"_getVideoConstraints",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],g.prototype,"_validateCameraParams",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],g,"get",null),c([u.LogManager.d_trace(u.LogCategory.HARDWARE)],g,"legacyParamConverter",null),e.CameraManager=g}(l=t.Hardware||(t.Hardware={})),t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var u,d=n(9),g=n(1),f=n(11),p=n(0),v=n(4),h=n(8),y=n(6),m=n(5),C=n(2),S=n(34),L=n(3),_=n(15);!function(e){e[e.ALERTING="ALERTING"]="ALERTING",e[e.PROGRESSING="PROGRESSING"]="PROGRESSING",e[e.CONNECTED="CONNECTED"]="CONNECTED",e[e.UPDATING="UPDATING"]="UPDATING",e[e.ENDED="ENDED"]="ENDED"}(u=t.CallState||(t.CallState={}));var E;!function(e){e[e.P2P=0]="P2P",e[e.SERVER=1]="SERVER"}(E=t.CallMode||(t.CallMode={}));var M=function(e){function t(e,n,i,a){r(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));s.remoteMuteState=!0,s.signalingConnected=!1,s.settings=a,s.settings.id=e,s.settings.displayName=n,s.settings.mode=E.P2P,s.settings.active=!0,s.settings.usedSinkId=null,s.settings.incoming=i,s.settings.state=i?u.ALERTING:u.PROGRESSING;var c=L.Client.getInstance().config();return c.experiments&&c.experiments.hardware?s.settings.audioDirections={sendAudio:!0}:s.settings.audioDirections={sendAudio:!1},s.settings.videoDirections="boolean"==typeof a.video?{sendVideo:a.video,receiveVideo:!0}:a.video,s.settings.hasEarlyMedia=!1,s.log=p.LogManager.get().createLogger(p.LogCategory.CALL,"Call "+e),s._callManager=y.CallManager.get(),s.on(d.CallEvents.Connected,function(){s.startTime=Date.now()}),s}return i(t,e),a(t,[{key:"id",value:function(){return this.settings.id}},{key:"number",value:function(){return this.settings.number}},{key:"displayName",value:function(){return this.settings.displayName}},{key:"headers",value:function(){return this.settings.extraHeaders}},{key:"active",value:function(){return this.settings.active}},{key:"state",value:function(){return u[this.settings.state]}},{key:"answer",value:function(e,t,n){if(void 0!==e&&(void 0!==t&&"object"===(void 0===t?"undefined":c(t))||(t={}),t[f.Constants.CALL_DATA_HEADER]=e),void 0!==n&&(n={sendVideo:L.Client.getInstance().config().videoSupport,receiveVideo:L.Client.getInstance().config().videoSupport}),this.settings.state!=u.ALERTING)throw new Error("WRONG_CALL_STATE");void 0!==n&&this._peerConnection.setVideoFlags(n)}},{key:"decline",value:function(e){if(this.settings.state!=u.ALERTING)throw new Error("WRONG_CALL_STATE");g.VoxSignaling.get().callRemoteFunction(C.RemoteFunction.rejectCall,this.settings.id,!1,y.CallManager.cleanHeaders(e))}},{key:"reject",value:function(e){if(this.settings.state!=u.ALERTING)throw new Error("WRONG_CALL_STATE");g.VoxSignaling.get().callRemoteFunction(C.RemoteFunction.rejectCall,this.settings.id,!0,y.CallManager.cleanHeaders(e))}},{key:"hangup",value:function(e){if(this.settings.state==u.CONNECTED||this.settings.state==u.UPDATING||this.settings.state==u.PROGRESSING)g.VoxSignaling.get().callRemoteFunction(C.RemoteFunction.disconnectCall,this.settings.id,y.CallManager.cleanHeaders(e));else{if(this.settings.state!=u.ALERTING)throw new Error("WRONG_CALL_STATE");g.VoxSignaling.get().callRemoteFunction(C.RemoteFunction.rejectCall,this.settings.id,!0,y.CallManager.cleanHeaders(e))}}},{key:"sendTone",value:function(e){this.settings.active&&this._peerConnection.sendDTMF(e)}},{key:"mutePlayback",value:function(){this.remoteMuteState=!1,v.UserMediaManager.updateMuteState(this.settings.id,v.MediaDirection.REMOTE,!1)}},{key:"unmutePlayback",value:function(){this.remoteMuteState=!0,v.UserMediaManager.updateMuteState(this.settings.id,v.MediaDirection.REMOTE,!0)}},{key:"restoreRMute",value:function(){this.settings.active&&v.UserMediaManager.updateMuteState(this.settings.id,v.MediaDirection.REMOTE,this.remoteMuteState)}},{key:"muteMicrophone",value:function(){this.peerConnection.muteMicrophone(!0)}},{key:"unmuteMicrophone",value:function(){this.peerConnection.muteMicrophone(!1)}},{key:"showRemoteVideo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];void 0===e&&(e=!0),this.peerConnection.videoRenderer&&(this.peerConnection.videoRenderer.style.display=e?"block":"none")}},{key:"setRemoteVideoPosition",value:function(e,t){throw new Error("Deprecated: please use CSS to position '#voximplantcontainer' element")}},{key:"setRemoteVideoSize",value:function(e,t){throw new Error("Deprecated: please use CSS to set size of '#voximplantcontainer' element")}},{key:"sendInfo",value:function(e,t,n){var r,o,i=e.indexOf("/");-1==i?(r="application",o=e):(r=e.substring(0,i),o=e.substring(i+1)),g.VoxSignaling.get().callRemoteFunction(C.RemoteFunction.sendSIPInfo,this.settings.id,r,o,t,y.CallManager.cleanHeaders(n))}},{key:"sendMessage",value:function(e){this.sendInfo(f.Constants.ZINGAYA_IM_MIME_TYPE,e,{})}},{key:"setVideoSettings",value:function(e,t,n){v.UserMediaManager.get().setConstraints(e,!0).then(function(e){"function"==typeof t&&t(e)}).catch(function(e){"function"==typeof n&&n(e)})}},{key:"getVideoElementId",value:function(){if(this.peerConnection&&this.settings.wiredRemote){var e=this.peerConnection.videoRenderer;return null!=e?e.id:null}return null}},{key:"addEventListener",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addEventListener",this).call(this,e,n)}},{key:"on",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,e,n)}},{key:"removeEventListener",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeEventListener",this).call(this,e,n)}},{key:"off",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,e,n)}},{key:"dispatchEvent",value:function(e){e.name!==d.CallEvents.Updated&&e.name!==d.CallEvents.UpdateFailed||(this.settings.state=u.CONNECTED),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispatchEvent",this).call(this,e)}},{key:"checkState",value:function(e,t){if(e)if("string"!=typeof e){for(var n=!1,r=e,o=0;o<r.length;o++)r[o]==this.settings.state&&(n=!0);if(!n)return this.log.warning("Received "+t+" in invalid state "+this.settings.state),!1}else if(this.settings.state!=e)return this.log.warning("Received "+t+" in invalid state "+this.settings.state),!1;return!0}},{key:"onConnected",value:function(e,t){if(this.signalingConnected)return!!this.checkState([u.PROGRESSING,u.ALERTING],"onConnected")&&(this.settings.state=u.CONNECTED,this.dispatchEvent({name:"Connected",call:this,headers:e}),!0)}},{key:"onDisconnected",value:function(e,t){return!!this.checkState([u.CONNECTED,u.ALERTING,u.PROGRESSING,u.UPDATING],"onDisconnected")&&(this.settings.state=u.ENDED,this.dispatchEvent({name:"Disconnected",call:this,headers:e,params:t}),S.ReusableRenderer.get().freeRendersByCallId(this.settings.id),!0)}},{key:"onFailed",value:function(e,t,n){return this.dispatchEvent({name:"Failed",call:this,headers:n,code:e,reason:t}),this.settings.state=u.ENDED,S.ReusableRenderer.get().freeRendersByCallId(this.settings.id),!0}},{key:"onStopRinging",value:function(){return!!this.checkState([u.PROGRESSING,u.CONNECTED],"onStopRinging")&&(this.dispatchEvent({name:"ProgressToneStop",call:this}),!0)}},{key:"onRingOut",value:function(){return!!this.checkState(u.PROGRESSING,"onRingOut")&&(this.dispatchEvent({name:"ProgressToneStart",call:this}),!0)}},{key:"onTransferComplete",value:function(){return!!this.checkState(u.CONNECTED,"onTransferComplete")&&(this.dispatchEvent({name:"TransferComplete",call:this}),!0)}},{key:"onTransferFailed",value:function(){return!!this.checkState(u.CONNECTED,"onTransferFailed")&&(this.dispatchEvent({name:"TransferFailed",call:this}),!0)}},{key:"onInfo",value:function(e,t,n,r,o){if(e.stateValue==u.CONNECTED||e.stateValue==u.PROGRESSING||e.stateValue==u.ALERTING||e.stateValue==u.UPDATING){var i=t+"/"+n;if(i==f.Constants.ZINGAYA_IM_MIME_TYPE)this.dispatchEvent({name:"onSendMessage",call:this,text:r});else if(i==f.Constants.P2P_SPD_FRAG_MIME_TYPE){var a=JSON.parse(r);for(var s in a)void 0!==e&&void 0!==e.peerConnection?e.peerConnection.addRemoteCandidate(a[s][1],a[s][0]):this.log.warning("Candidate skipped. Connection not created yet.")}else i==f.Constants.VI_SPD_OFFER_MIME_TYPE?e.peerConnection.processRemoteOffer(r):i==f.Constants.VI_SPD_ANSWER_MIME_TYPE?e.peerConnection.processRemoteAnswer({},r):this.dispatchEvent({name:"InfoReceived",call:this,body:r,headers:o,mimeType:i});return!0}this.log.warning("received handleSIPInfo for call: "+e.id()+" in invalid state: "+e.state())}},{key:"setActive",value:function(e){var t=this;return new Promise(function(n,r){return e===t.settings.active?void n({name:d.CallEvents.Updated,result:!1,call:t}):"firefox"===m.default.getWSVendor()?(t.sendInfo(f.Constants.VI_HOLD_EMUL,JSON.stringify({hold:!e})),void n({name:d.CallEvents.Updated,call:t,result:!0})):void(t.settings.state==u.CONNECTED?(t.settings.state=u.UPDATING,t.settings.active=e,e?g.VoxSignaling.get().callRemoteFunction(C.RemoteFunction.unhold,t.settings.id):g.VoxSignaling.get().callRemoteFunction(C.RemoteFunction.hold,t.settings.id),n({name:d.CallEvents.Updated,result:!0,call:t})):r({name:d.CallEvents.UpdateFailed,code:11,call:t}))})}},{key:"checkCallMode",value:function(e){return this.settings.mode==e}},{key:"canStartSendingCandidates",value:function(){void 0===this._peerConnection&&(this._peerConnection=h.PCFactory.get().peerConnections[this.settings.id]),this._peerConnection.canStartSendingCandidates()}},{key:"notifyICETimeout",value:function(){this.dispatchEvent({name:"ICETimeout",call:this})}},{key:"sendVideo",value:function(e){var t=this,n=L.Client.getInstance().config();if(!n.experiments||!n.experiments.reinvite)return this.settings.videoDirections.sendVideo===e?new Promise(function(e,t){e()}):this.sendMedia(null,e);if(!this.peerConnection)return new Promise(function(e,n){e({call:t,name:d.CallEvents[d.CallEvents.Updated],result:!0})});var r=this.settings.videoDirections.sendVideo;return this.settings.videoDirections.sendVideo=e,this.peerConnection.hasLocalVideo()?e||r?(this.peerConnection.enableVideo(e),new Promise(function(e,n){e({call:t,name:d.CallEvents[d.CallEvents.Updated],result:!0})})):this.sendMedia(null,e):e?this.sendMedia(null,e):void 0}},{key:"receiveVideo",value:function(){var e=this;return this.settings.state=u.UPDATING,new Promise(function(t,n){if(!0===e.settings.videoDirections.receiveVideo)return void n();e.settings.videoDirections.receiveVideo=!0,e._peerConnection.hdnFRS().then(t,n)})}},{key:"sendMedia",value:function(e,t){var n=this;return this.settings.state=u.UPDATING,void 0!==e&&null!==e||(e=this.settings.audioDirections.sendAudio),void 0!==t&&null!==t||(t=this.settings.videoDirections.sendVideo),this.peerConnection.sendMedia(e,t).then(function(r){return void 0!==t&&null!==t&&(n.settings.videoDirections.sendVideo=t),void 0!==e&&null!==e&&(n.settings.audioDirections.sendAudio=e),r})}},{key:"sendAudio",value:function(e){var t=this,n=L.Client.getInstance().config();return n.experiments&&n.experiments.reinvite?(this.settings.audioDirections.sendAudio=e,this.peerConnection.hasLocalAudio()?(this.peerConnection.muteMicrophone(!e),new Promise(function(e,n){e({call:t,name:d.CallEvents[d.CallEvents.Updated],result:!0})})):e?this.sendMedia(null,e):void 0):(this.settings.state=u.UPDATING,this.sendMedia(e,null))}},{key:"getLocalStream",value:function(){var e=this;return this.settings.wiredLocal?new Promise(function(t,n){e.peerConnection?t(e.peerConnection.localStream):n(new Error("We have no PC for this call yet"))}):v.UserMediaManager.get().queryMedia()}},{key:"setLocalStream",value:function(e){return new Promise(function(e,t){t(new Error("Not implemented"))})}},{key:"shareScreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.settings.state=u.UPDATING,this.peerConnection.shareScreen(e)}},{key:"stopSharingScreen",value:function(){return this.settings.state=u.UPDATING,this.peerConnection.stopSharingScreen()}},{key:"addLocalStream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.settings.state=u.UPDATING,this.peerConnection.addMediaStream(e,t)}},{key:"wireRemoteStream",value:function(){var e=this;return new Promise(function(t,n){e.peerConnection?void 0!==e.peerConnection.remoteStreams[0]?e.peerConnection.wireRemoteStream(!0).then(function(){e.settings.wiredRemote=!0,t()}).catch(n):n(new Error("We have no remote MediaStream for this call yet")):n(new Error("We have no PC for this call yet"))})}},{key:"getRemoteAudioStreams",value:function(){var e=this;return new Promise(function(t,n){e.peerConnection?(e.peerConnection.remoteStreams.forEach(function(e){if(e.getAudioTracks().length)return void t(new MediaStream(e.getAudioTracks()))}),n(new Error("We have no remote MediaStream for this call yet"))):n(new Error("We have no PC for this call yet"))})}},{key:"getRemoteVideoStreams",value:function(){var e=this;return new Promise(function(t,n){e.peerConnection?void 0!==e.peerConnection.remoteStreams[0]&&0!=e.peerConnection.remoteStreams[0].getVideoTracks().length?t(new MediaStream(e.peerConnection.remoteStreams[0].getVideoTracks())):n(new Error("We have no remote MediaStream for this call yet")):n(new Error("We have no PC for this call yet"))})}},{key:"getRemoteWiredState",value:function(){return this.settings.wiredRemote}},{key:"getLocalWiredState",value:function(){return this.settings.wiredLocal}},{key:"useAudioOutput",value:function(e){return this.peerConnection.updateRenderersSink(e)}},{key:"getAudioElementId",value:function(){return(this._peerConnection.remoteStreams.length=0)?null:(this._peerConnection.remoteStreams[0].getAudioTracks().length=0)?null:this._peerConnection.remoteStreams[0].getAudioTracks()[0].id}},{key:"getDirections",value:function(){if(void 0!==this.peerConnection)return this.peerConnection.getDirections()}},{key:"getStreamActivity",value:function(){return{}}},{key:"hdnFRS",value:function(){this.peerConnection._hdnFRS()}},{key:"hdnFRSPrep",value:function(){var e=this;void 0!==this.peerConnection?this.peerConnection._hdnFRSPrep():setTimeout(function(){e.hdnFRSPrep()},1e3)}},{key:"runIncomingReInvite",value:function(e,t){var n=this;if(this.settings.state===u.UPDATING)g.VoxSignaling.get().callRemoteFunction(C.RemoteFunction.rejectReInvite,this.settings.id,{});else{this.settings.state=u.UPDATING;var r=y.CallManager.get().isSDPHasVideo(t);this.peerConnection.handleReinvite(e,t,r).then(function(){n.peerConnection.restoreMute()})}}},{key:"setActiveForce",value:function(e){this.settings.active=e}},{key:"_traceName",value:function(){return"Call"}},{key:"getCallDuration",value:function(){return Date.now()-this.startTime}},{key:"stateValue",get:function(){return this.settings.state}},{key:"promise",get:function(){return this._promise}},{key:"peerConnection",set:function(e){this._peerConnection=e},get:function(){return this._peerConnection}}]),t}(_.EventDispatcher);l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"id",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"number",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"displayName",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"headers",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"active",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"state",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"answer",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"decline",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"reject",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"hangup",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"sendTone",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"mutePlayback",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"unmutePlayback",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"restoreRMute",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"muteMicrophone",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"unmuteMicrophone",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"showRemoteVideo",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"setRemoteVideoPosition",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"setRemoteVideoSize",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"sendInfo",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"sendMessage",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"setVideoSettings",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"getVideoElementId",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"addEventListener",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"on",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"removeEventListener",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"off",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"dispatchEvent",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"checkState",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onConnected",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onDisconnected",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onFailed",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onStopRinging",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onRingOut",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onTransferComplete",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onTransferFailed",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onInfo",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"setActive",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"checkCallMode",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"canStartSendingCandidates",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"notifyICETimeout",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"sendVideo",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"receiveVideo",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"sendAudio",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"getLocalStream",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"setLocalStream",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"addLocalStream",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"wireRemoteStream",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"getRemoteAudioStreams",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"getRemoteVideoStreams",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"getRemoteWiredState",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"getLocalWiredState",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"useAudioOutput",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"getAudioElementId",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"getStreamActivity",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"hdnFRS",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"hdnFRSPrep",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"runIncomingReInvite",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"setActiveForce",null),t.Call=M},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=function(){function e(){r(this,e),this.eventListeners={}}return o(e,[{key:"addEventListener",value:function(e,t){void 0===this.eventListeners[e]&&(this.eventListeners[e]=[]),this.eventListeners[e].push(t)}},{key:"dispatchEvent",value:function(e){var t=e.name;if(void 0!==this.eventListeners[t])for(var n=0;n<this.eventListeners[t].length;n++)"function"==typeof this.eventListeners[t][n]&&this.eventListeners[t][n](e);void 0!==this.eventListeners[t]&&0!=this.eventListeners[t].length||i.LogManager.get().writeMessage(i.LogCategory.UTILS,"",i.LogLevel.INFO,"The "+e.name+" event dispatched, but no handler registered for this event type.")}},{key:"removeEventListener",value:function(e,t){if(void 0!==this.eventListeners[e])if("function"==typeof t){for(var n=0;n<this.eventListeners[e].length;n++)if(this.eventListeners[e][n]==t){this.eventListeners[e].splice(n,1);break}}else this.eventListeners[e]=[]}},{key:"on",value:function(e,t){this.addEventListener(e,t)}},{key:"off",value:function(e,t){this.removeEventListener(e,t)}}]),e}();t.EventDispatcher=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);!function(e){e[e.multiplex="multiplex"]="multiplex",e[e.audio="audio"]="audio",e[e.video="video"]="video",e[e.screen="screen"]="screen",e[e.data="data"]="data",e[e.unbundled="unbundled"]="unbundled"}(t.CallstatsIoFabricUsage||(t.CallstatsIoFabricUsage={}));!function(e){e[e.fabricHold="fabricHold"]="fabricHold",e[e.fabricResume="fabricResume"]="fabricResume",e[e.audioMute="audioMute"]="audioMute",e[e.audioUnmute="audioUnmute"]="audioUnmute",e[e.videoPause="videoPause"]="videoPause",e[e.videoResume="videoResume"]="videoResume",e[e.fabricTerminated="fabricTerminated"]="fabricTerminated",e[e.screenShareStart="screenShareStart"]="screenShareStart",e[e.screenShareStop="screenShareStop"]="screenShareStop",e[e.dominantSpeaker="dominantSpeaker"]="dominantSpeaker",e[e.activeDeviceList="activeDeviceList"]="activeDeviceList"}(t.CallstatsIoFabricEvent||(t.CallstatsIoFabricEvent={}));!function(e){e[e.getUserMedia="getUserMedia"]="getUserMedia",e[e.createOffer="createOffer"]="createOffer",e[e.createAnswer="createAnswer"]="createAnswer",e[e.setLocalDescription="setLocalDescription"]="setLocalDescription",e[e.setRemoteDescription="setRemoteDescription"]="setRemoteDescription",e[e.addIceCandidate="addIceCandidate"]="addIceCandidate",e[e.iceConnectionFailure="iceConnectionFailure"]="iceConnectionFailure",e[e.signalingError="signalingError"]="signalingError",e[e.applicationLog="applicationLog"]="applicationLog"}(t.CallstatsioWrtcFuncNames||(t.CallstatsioWrtcFuncNames={}));var a=function(){function e(t){r(this,e),this._params=t,this.inited=!1,this.pendingFabric=[];var n=window;void 0!==n.callstats&&(this.callstats=new n.callstats(null,n.io))}return o(e,[{key:"init",value:function(t){var n=this;return!!e.moduleEnabled&&(i.LogManager.get().writeMessage(i.LogCategory.UTILS,"[CallstatsIo]",i.LogLevel.INFO," Callstats.io SDK initialization start"),this.callstats.initialize(this._params.AppID,this._params.AppSecret,t,function(){i.LogManager.get().writeMessage(i.LogCategory.UTILS,"[CallstatsIo]",i.LogLevel.INFO," Callstats.io SDK initialization successful"),n.inited=!0,n.pendingFabric.map(function(e){n.callstats.addNewFabric(e.pc,e.remoteUser,e.fabricUsage,e.callID)})},function(){},this.packParams()),!0)}},{key:"packParams",value:function(){var e={};return this._params.disableBeforeUnloadHandler&&(e.disableBeforeUnloadHandler=this._params.disableBeforeUnloadHandler),this._params.applicationVersion&&(e.applicationVersion=this._params.applicationVersion),e}},{key:"addNewFabric",value:function(t,n,r,o){if(!e.moduleEnabled)return!1;this.inited?(i.LogManager.get().writeMessage(i.LogCategory.UTILS,"[CallstatsIo]",i.LogLevel.INFO," Callstats.io addNewFabric"),this.callstats.addNewFabric(t,n,r,o)):this.pendingFabric.push({pc:t,remoteUser:n,fabricUsage:r,callID:o})}},{key:"sendFabricEvent",value:function(t,n,r){if(!e.moduleEnabled)return!1;this.callstats.sendFabricEvent(t,n,r)}},{key:"reportError",value:function(t,n,r,o,i,a){if(!e.moduleEnabled)return!1;this.callstats.reportError(t,n,r,o,i,a)}},{key:"_traceName",value:function(){return"CallstatsIo"}}],[{key:"isModuleEnabled",value:function(){return e.moduleEnabled}},{key:"get",value:function(t){return void 0!==window.callstats&&(e.moduleEnabled=!0),void 0===e.instance&&(e.instance=new e(t)),void 0!==t&&(e.instance._params=t),e.instance}}]),e}();a.moduleEnabled=!1,t.CallstatsIo=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(2),s=function(){function e(t){r(this,e),this._id=t}return o(e,[{key:"insertDTMF",value:function(e,t,n){var r=this;e.split("").forEach(function(e){return r.sendKey(e)})}},{key:"sendKey",value:function(e){var t=void 0;((t="*"==e?10:"#"==e?11:parseInt(e))>=0||t<=11)&&i.VoxSignaling.get().callRemoteFunction(a.RemoteFunction.sendDTMF,this._id,t)}},{key:"_traceName",value:function(){return"SignalingDTMFSender"}}]),e}();t.SignalingDTMFSender=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.SDKReady="SDKReady"]="SDKReady",e[e.ConnectionEstablished="ConnectionEstablished"]="ConnectionEstablished",e[e.ConnectionFailed="ConnectionFailed"]="ConnectionFailed",e[e.ConnectionClosed="ConnectionClosed"]="ConnectionClosed",e[e.AuthResult="AuthResult"]="AuthResult",e[e.RefreshTokenResult="RefreshTokenResult"]="RefreshTokenResult",e[e.PlaybackFinished="PlaybackFinished"]="PlaybackFinished",e[e.MicAccessResult="MicAccessResult"]="MicAccessResult",e[e.IncomingCall="IncomingCall"]="IncomingCall",e[e.SourcesInfoUpdated="SourcesInfoUpdated"]="SourcesInfoUpdated",e[e.NetStatsReceived="NetStatsReceived"]="NetStatsReceived"}(t.Events||(t.Events={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s,c=n(0),l=n(1),u=n(20),d=n(6),g=n(11),f=n(2),p=n(24),v=n(5),h=n(4),y=n(3),m=n(13);!function(e){e[e.IDLE=0]="IDLE",e[e.REMOTEOFFER=1]="REMOTEOFFER",e[e.LOCALOFFER=2]="LOCALOFFER",e[e.ESTABLISHING=3]="ESTABLISHING",e[e.ESTABLISHED=4]="ESTABLISHED",e[e.CLOSED=5]="CLOSED"}(s=t.PeerConnectionState||(t.PeerConnectionState={}));var C;!function(e){e[e.CLIENT_SERVER_V1=0]="CLIENT_SERVER_V1",e[e.P2P=1]="P2P"}(C=t.PeerConnectionMode||(t.PeerConnectionMode={}));var S=function(){function e(t,n,o){r(this,e),this.id=t,this.mode=n,this.videoEnabled=o,this.SEND_CANDIDATE_DELAY=1e3,this.mediaRepository=[],this.candidateList=[],this.localCandidateTimer=-1,this.onHold=!1,this.muteMicState=!1,this.log=c.LogManager.get().createLogger(c.LogCategory.RTC,"PeerConnection "+t),this.state=s.IDLE,this.log.info("Created PC"),this.renderers=[],this.pendingCandidates=[],"_default"!==t&&d.CallManager.get().calls[t]&&(this.reInviteQ=new p.ReInviteQ(d.CallManager.get().calls[t],this._canReInvite))}return o(e,[{key:"getId",value:function(){return this.id}},{key:"setState",value:function(e){this.log.info("Transmitting from "+s[this.state]+" to "+s[e]),this.state=e}},{key:"getState",value:function(){return this.state}},{key:"processRemoteAnswer",value:function(e,t){return this.log.info("Called processRemoteAnswer"),this.state=s.ESTABLISHING,this._processRemoteAnswer(e,t)}},{key:"getLocalOffer",value:function(){return this.state===s.IDLE||this.state===s.ESTABLISHED||s.LOCALOFFER?(this.log.info("Called getLocalOffer"),this.state=s.LOCALOFFER,this._getLocalOffer()):(this.log.error("Called getLocalOffer in state "+s[this.state]),new Promise(function(e,t){t("Invalid state")}))}},{key:"getLocalAnswer",value:function(){return this._getLocalAnswer()}},{key:"processRemoteOffer",value:function(e){return this.state===s.IDLE||this.state===s.ESTABLISHED?(this.log.info("Called processRemoteOffer"),this.state=s.ESTABLISHING,this._processRemoteOffer(e)):(this.log.error("Called processRemoteOffer in state "+s[this.state]),new Promise(function(e,t){t("Invalid state")}))}},{key:"close",value:function(){this.log.info("Called close"),this._stopSharing(),this._close(),this.renderers.forEach(function(e){return u.Renderer.get().releaseElement(e)}),this.mediaRepository.forEach(function(e){e.stop()}),this.mediaRepository=[]}},{key:"addRemoteCandidate",value:function(e,t){return this.log.info("Called addRemoteCandidate"),this._addRemoteCandidate(e,t)}},{key:"sendLocalCandidateToPeer",value:function(e,t){var n=this;switch(this._call=d.CallManager.get().calls[this.id],this.mode){case C.P2P:this.candidateList.push([t,e]),this.localCandidateTimer<=0&&(this.localCandidateTimer=window.setTimeout(function(){window.clearTimeout(n.localCandidateTimer),n.localCandidateTimer=-1,d.CallManager.get().calls[n.id]&&d.CallManager.get().calls[n.id].sendInfo(g.Constants.P2P_SPD_FRAG_MIME_TYPE,JSON.stringify(n.candidateList),{}),n.candidateList=[]},200));break;case C.CLIENT_SERVER_V1:l.VoxSignaling.get().callRemoteFunction(f.RemoteFunction.addCandidate,this.id,e,t)}}},{key:"bindLocalMedia",value:function(e){var t=this;if(void 0!==this._localStream&&this._unbindLocalMegia(),void 0!==e&&null!==e){var n=new MediaStream(e.getTracks().map(function(e){var n=e;return void 0!==e.clone&&(n=e.clone()),t.mediaRepository.push(n),n}));this._localStream=n,this._call&&n.getAudioTracks().length>0&&(this._call.settings.audioDirections.sendAudio=!0),this._bindLocalMedia()}}},{key:"handleReinvite",value:function(e,t,n){return this._handleReinvite(e,t,n)}},{key:"addCandidateToSend",value:function(e,t){this.pendingCandidates.push([t,e]),this.canSendCandidates&&this.startCandidateSendTimer()}},{key:"startCandidateSendTimer",value:function(){var e=this;null!==this.candidateSendTimer&&void 0!==this.candidateSendTimer||(this.candidateSendTimer=setTimeout(function(){e.candidateSendTimer=null,e.pendingCandidates.length>0&&d.CallManager.get().calls[e.id]&&d.CallManager.get().calls[e.id].sendInfo(g.Constants.P2P_SPD_FRAG_MIME_TYPE,JSON.stringify(e.pendingCandidates),{}),e.pendingCandidates=[]},this.SEND_CANDIDATE_DELAY))}},{key:"canStartSendingCandidates",value:function(){this.canSendCandidates=!0,this.startCandidateSendTimer()}},{key:"sendDTMF",value:function(e){this._sendDTMF(e,500,50)}},{key:"setVideoEnabled",value:function(e){var t=this.videoEnabled.receiveVideo;this.videoEnabled=e,t!=e.receiveVideo&&this._hold(this.onHold)}},{key:"setVideoFlags",value:function(e){this.videoEnabled=e}},{key:"updateRenderersSink",value:function(e){var t=this;return new Promise(function(n,r){if("chrome"!==v.default.getWSVendor(!0))return void r(new Error("Unsupported browser. Only Google Chrome 49 and above."));t.sinkId=e;var o=[],i=!0,a=!1,s=void 0;try{for(var c,l=t.renderers[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var u=c.value;o.push(u.setSinkId(e))}}catch(e){a=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw s}}Promise.all(o).then(function(){n()},r)})}},{key:"getDirections",value:function(){return this._getDirections()}},{key:"setHoldKey",value:function(e){this.onHold=e}},{key:"getTrackKind",value:function(){return this._getTrackKind()}},{key:"shareScreen",value:function(e){var t=this;return v.default.isScreenSharingSupported?new Promise(function(n,r){if(t.onHold)return void r({result:!1,call:t._call});t.onHold&&r(),t.reInviteQ.add({fx:function(){v.default.getScreenMedia().then(function(n){t._addMediaStream(n,e),n.getTracks().forEach(function(e){return t.mediaRepository.push(e)})}).catch(r)},reject:r,resolve:function(e){t.restoreMute(),n(e)}})}):new Promise(function(e,n){if(t.onHold)return void n({result:!1,call:t._call});c.LogManager.get().writeMessage(c.LogCategory.CALL,"SCREEN SHARING",c.LogLevel.WARNING,"Sorry, this browser does not support screen sharing."),n(new Error("Sorry, this browser does not support screen sharing."))})}},{key:"sendMedia",value:function(e,t){var n=this;return new Promise(function(r,o){if(n.onHold)return void o({result:!1,call:n._call});n.reInviteQ.add({fx:function(){var r=y.Client.getInstance().config();if(r.experiments&&r.experiments.hardware)m.default.StreamManager.get()._updateCallStream(n._call).then(function(e){n.bindLocalMedia(e)});else{var o=h.UserMediaManager.get().getConstrainWithSendFlag(e,t);n.setVideoEnabled({receiveVideo:n.videoEnabled.receiveVideo,sendVideo:t}),h.UserMediaManager.get().getQueryMediaSilent(o).then(function(e){n.bindLocalMedia(e)})}},reject:o,resolve:function(e){n.restoreMute(),r(e)}})})}},{key:"stopSharingScreen",value:function(){var e=this;return v.default.isScreenSharingSupported?new Promise(function(t,n){if(e.onHold)return void n({result:!1,call:e._call});e.onHold&&n(),e.reInviteQ.add({fx:function(){e._stopSharing()},reject:n,resolve:function(n){e.restoreMute(),t(n)}})}):new Promise(function(t,n){if(e.onHold)return void n({result:!1,call:e._call});c.LogManager.get().writeMessage(c.LogCategory.CALL,"SCREEN SHARING",c.LogLevel.WARNING,"Sorry, this browser does not support screen sharing."),n(new Error("Sorry, this browser does not support screen sharing."))})}},{key:"hold",value:function(e){var t=this;return new Promise(function(n,r){t.reInviteQ.add({fx:function(){t._hold(e)},reject:r,resolve:function(e){t.restoreMute(),n(e)}})})}},{key:"hdnFRS",value:function(){var e=this;return new Promise(function(t,n){if(e.onHold)return void n({result:!1,call:e._call});e.reInviteQ.add({fx:function(){e._hdnFRS()},reject:n,resolve:function(n){e.restoreMute(),t(n)}})})}},{key:"addMediaStream",value:function(e,t){var n=this;return new Promise(function(r,o){if(n.onHold)return void o({result:!1,call:n._call});n.reInviteQ.add({fx:function(){n._addMediaStream(e,t)},reject:o,resolve:function(e){n.restoreMute(),r(e)}})})}},{key:"muteMicrophone",value:function(e){var t=this;this.muteMicState!==e&&(this.muteMicState=e,this.localStream.getAudioTracks().forEach(function(e){e.enabled=!t.muteMicState}))}},{key:"restoreMute",value:function(){var e=this;if(this._call.settings.active){var t=this;setTimeout(function(){e._call.restoreRMute(),e.localStream&&e.localStream.getAudioTracks().forEach(function(e){e.enabled=!t.muteMicState})},300)}}},{key:"_traceName",value:function(){return"PeerConnection"}},{key:"localStream",get:function(){return this._localStream}},{key:"remoteStreams",get:function(){return this._remoteStreams}},{key:"videoRenderer",get:function(){var e=null;return this.renderers.forEach(function(t){"video"===t.tagName.toLowerCase()&&(e=t)}),e}},{key:"audioRenderer",get:function(){return this.renderers.forEach(function(e){if("audio"===e.tagName.toLowerCase())return e}),null}}]),e}();a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"setState",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"getState",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"processRemoteAnswer",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"getLocalOffer",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"getLocalAnswer",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"processRemoteOffer",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"close",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"addRemoteCandidate",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"sendLocalCandidateToPeer",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"bindLocalMedia",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"handleReinvite",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"addCandidateToSend",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"startCandidateSendTimer",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"canStartSendingCandidates",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"sendDTMF",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"setVideoEnabled",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"setVideoFlags",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"updateRenderersSink",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"setHoldKey",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"getTrackKind",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"shareScreen",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"sendMedia",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"stopSharingScreen",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"hold",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"hdnFRS",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"addMediaStream",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"muteMicrophone",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],S.prototype,"restoreMute",null),t.PeerConnection=S},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),c=n(0),l=function(){function e(){r(this,e),this.videoElements=new Array,this.audioElements=new Array,this.log=c.LogManager.get().createLogger(c.LogCategory.RTC,"Renderer")}return o(e,[{key:"getElement",value:function(e,t,n){var r=n||this._defaultContainer||document.body;if(document.getElementById(e)){var o=document.getElementById(e);r&&o.parentElement.removeChild(o)}var i=void 0;return i=document.createElement(t?"video":"audio"),i.autoplay=!0,i.setAttribute("playsinline",null),t?(this.videoElements.push(i),i.width=400,i.height=300):this.audioElements.push(i),i.id=e,r&&r.appendChild(i),i}},{key:"getElementId",value:function(e,t){}},{key:"renderStream",value:function(e,t){var n=this.getElement(e.id,e.getVideoTracks().length>0,t);return s.default.attachMedia(e,n),n}},{key:"setPlaybackVolume",value:function(e){for(var t in this.audioElements)this.audioElements.hasOwnProperty(t)&&(this.audioElements[t].volume=e);for(var n in this.videoElements)this.videoElements.hasOwnProperty(n)&&(this.videoElements[n].volume=e)}},{key:"releaseElement",value:function(e){e&&(e.id="",void 0!==e.parentElement&&null!==e.parentElement?e.parentElement&&e.parentElement.removeChild(e):e.parentNode&&e.parentNode&&e.parentNode.removeChild(e),s.default.detachMedia(e))}},{key:"_traceName",value:function(){return"Renderer"}},{key:"defaultContainer",get:function(){return this._defaultContainer},set:function(e){this._defaultContainer=e}}],[{key:"get",value:function(){return this.inst||(this.inst=new e),this.inst}}]),e}();a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],l.prototype,"getElement",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],l.prototype,"getElementId",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],l.prototype,"renderStream",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],l.prototype,"setPlaybackVolume",null),a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],l.prototype,"releaseElement",null),t.Renderer=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=function(){function e(){r(this,e)}return o(e,[{key:"_traceName",value:function(){return"SDPMuggle"}}],[{key:"detectDirections",value:function(t){var n=[],r=t.split(/(\r\n|\r|\n)/).filter(e.validLine),o="";return r.forEach(function(e){if(0===e.indexOf("m=")){var t=e.substr(2);o=t.split(" ")[0]}""===o||"a=sendrecv"!==e&&"a=sendonly"!==e&&"a=recvonly"!==e&&"a=inactive"!==e||(n.push({type:o,direction:e.substr(2)}),o="")}),n}},{key:"removeTelephoneEvents",value:function(t){if(-1!==t.sdp.indexOf("a=rtpmap:127 telephone-event/8000")){for(var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),r=-1,o=0;o<n.length;o++){if(-1!==n[o].indexOf("m=audio")){var i=n[o];"string"==typeof i&&(n[o]=i.replace(" 127",""))}-1!==n[o].indexOf("a=rtpmap:127 telephone-event/8000")&&(r=o)}n.splice(r,1),t.sdp=n.join("\r\n")+"\r\n"}return t}},{key:"removeDoubleOpus",value:function(t){if(-1!==t.sdp.indexOf("a=rtpmap:109 opus")&&-1!==t.sdp.indexOf("a=rtpmap:111 opus")){for(var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),r=-1,o=0;o<n.length;o++){if(-1!==n[o].indexOf("m=audio")){var i=n[o];"string"==typeof i&&(n[o]=i.replace(" 109",""))}-1!==n[o].indexOf("a=rtpmap:109 opus")&&(r=o)}n.splice(r,1),t.sdp=n.join("\r\n")+"\r\n"}return t}},{key:"removeTIAS",value:function(t){if(-1!==t.sdp.indexOf("b=TIAS")){var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),r=[];n.forEach(function(e,t){-1!==e.indexOf("b=TIAS")&&r.unshift(t)}),r.forEach(function(e){return n.splice(e,1)}),t={type:t.type,sdp:n.join("\r\n")+"\r\n"}}return t}},{key:"fixVideoRecieve",value:function(t,n){if(-1!==t.sdp.indexOf("m=video")&&!n){var r=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),o=null;r=r.map(function(e,t){return null===o?-1!==e.indexOf("m=video")&&(o=t):"a=sendrecv"===e?e="a=sendonly":"a=recvonly"===e&&(e="a=inactive"),e}),t.sdp=r.join("\r\n")+"\r\n"}return t}},{key:"addSetupAttribute",value:function(e){return-1==e.indexOf("a=setup:")&&(e+="a=setup:actpass\r\n"),e}}]),e}();c.validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/),a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"removeTelephoneEvents",null),a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"removeDoubleOpus",null),a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"removeTIAS",null),a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"fixVideoRecieve",null),t.SDPMuggle=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=n(3),l=n(10),u=n(4),d=function(){function e(){r(this,e)}return o(e,[{key:"_traceName",value:function(){return"Logger"}}],[{key:"extend",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r={},o=function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])};o(arguments[0]);for(var i=1;i<arguments.length;i++){o(arguments[i])}return r}},{key:"stringifyExtraHeaders",value:function(e){return e="[object Object]"==Object.prototype.toString.call(e)?JSON.stringify(e):null}},{key:"cadScript",value:function(e){return e.split(";").map(function(e){if(0!==e.length){var t=e.match(/\([0-9\/\.,\*\+]*\)$/),n=e.substring(0,t.index),r=t.pop();if(t.length)throw new Error("cadence script should be of the form `%f(%f/%f[,%f/%f])`");if(n="*"===n?1/0:parseFloat(n),isNaN(n))throw new Error("cadence length should be of the form `%f`");return r=r.slice(1,r.length-1).split(",").map(function(e){try{var t=e.split("/");if(t.length>3)throw new Error;return t=t.map(function(e,t){if(2===t)return e.split("+").map(function(e){var t=parseInt(e,10);if(isNaN(t))throw new Error;return t-1});var n;if("*"==e&&(n=1/0),n=n||parseFloat(e),isNaN(n))throw new Error;return n}),{on:t[0],off:t[1],frequencies:t[2]}}catch(e){throw new Error("cadence segments should be of the form `%f/%f[%d[+%d]]`")}}),{duration:n,sections:r}}})}},{key:"freqScript",value:function(e){return e.split(",").map(function(e){try{var t=e.split("@"),n=parseInt(t.shift()),r=parseFloat(t.shift());if(t.length)throw Error();return{frequency:n,decibels:r}}catch(e){throw new Error("freqScript pairs are expected to be of the form `%d@%f[,%d@%f]`")}})}},{key:"toneScript",value:function(e){var t=e.split(";");return{frequencies:this.freqScript(t.shift()),cadences:this.cadScript(t.join(";"))}}},{key:"playToneScript",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0!==window.AudioContext||void 0!==window.webkitAudioContext){var n=u.UserMediaManager.get().audioContext;if(null===n)return;var r=this.toneScript(e),o=[],i=0,a=function(e){for(var t=0;t<n.sampleRate*e;t++)o.push(0)},s=function(e,t){for(var i=0;i<n.sampleRate*t;i++){for(var a=0,s=0;s<e.length;s++)a+=Math.pow(10,r.frequencies[e[s]].decibels/20)*Math.sin((o.length+i)*(3.14159265359/n.sampleRate)*r.frequencies[e[s]].frequency),i<10&&(a*=i/10),i>n.sampleRate*t-10&&(a*=(n.sampleRate*t-i)/10);o.push(a)}},c=function(e,t){if(t!=1/0)var n=t;else n=t=20;if(0!==e.off&&e.off!=1/0)for(;n>0;){s(e.frequencies,e.on),n-=e.on,a(e.off),n-=e.off;n=parseInt(String(10*n))/10}else s(e.frequencies,t)};this.source=n.createBufferSource();for(var l=0;l<r.cadences.length;l++)r.cadences[l].duration==1/0&&(this.source.loop=!0),function(e){e.duration!=1/0?i+=e.duration:i+=20;for(var t=0;t<e.sections.length;t++)c(e.sections[t],e.duration)}(r.cadences[l]);this.source.connect(n.destination);for(var d=n.createBuffer(1,i*n.sampleRate,n.sampleRate),g=d.getChannelData(0),f=0;f<i*n.sampleRate;f++)g[f]=o[f];o=null,this.source.buffer=d,!0===t&&(this.source.loop=!0),this.source.start(0)}}},{key:"stopPlayback",value:function(){return void 0!==this.source&&null!==this.source&&(this.source.stop(0),this.source=null,!0)}},{key:"sendRequest",value:function(e,t,n,r){var o=!1,i=function(){for(var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],n=0;n<t.length;n++){try{e=t[n](),0===n&&(o=!0)}catch(e){continue}break}return e}();if(i){var a=r?"POST":"GET";if(o)i.onerror=function(){n(i)},i.ontimeout=function(){n(i)},i.onload=function(){t(i)},i.open(a,e),i.timeout=5e3,i.send();else{if(i.open(a,e,!0),r&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==i.readyState)return 200!=i.status&&304!=i.status?void n(i):void t(i)},4==i.readyState)return;i.send(r)}}}},{key:"getServers",value:function(e){function t(t){null!==t?e(t):!0!==n?this.getServers(e,!0,r):r.dispatchEvent({name:"ConnectionFailed",message:"VoxImplant Cloud is unavailable"})}var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments[2],o="https:"==document.location.protocol?"https://":"http://",i=o+"balancer.voximplant.com/getNearestHost";this.sendRequest(i,function(e){t(e.responseText)},function(e){t(null)})}},{key:"generateUUID",value:function(){var e=this._gri,t=this._ha;return t(e(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12)}},{key:"_gri",value:function(e){return e<0?NaN:e<=30?0|Math.random()*(1<<e):e<=53?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<e-30))*(1<<30):NaN}},{key:"_ha",value:function(e,t){for(var n=e.toString(16),r=t-n.length,o="0";r>0;r>>>=1,o+=o)1&r&&(n=o+n);return n}},{key:"filterXSS",value:function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),e=t.innerHTML}},{key:"checkCA",value:function(){if(!c.Client.getInstance().connected())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(!l.Authenticator.get().authorized())throw new Error("NOT_AUTHORIZED")}},{key:"canRTC",value:function(e){}},{key:"mixObjectToLeft",value:function(e,t){for(var n in e)void 0!==t[n]&&(e[n]=t[n]);return e}},{key:"makeRandomString",value:function(e){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/",n="",r=0;r<e;r++)n+=t.charAt(Math.floor(Math.random()*t.length));return n}}]),e}();d.source=null,a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"extend",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"stringifyExtraHeaders",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"cadScript",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"freqScript",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"toneScript",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"playToneScript",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"stopPlayback",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"sendRequest",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"getServers",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"generateUUID",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"_gri",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"_ha",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"filterXSS",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"checkCA",null),t.Utils=d},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),a=function(){function e(){r(this,e),this.audioCache={},this.videoCache={}}return o(e,null,[{key:"get",value:function(){return this.inst||(this.inst=new e),this.inst}}]),o(e,[{key:"clear",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this.videoCache[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){r.value.stop()}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}var i=!0,a=!1,s=void 0;try{for(var c,l=this.audioCache[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){c.value.stop()}}catch(e){a=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw s}}}},{key:"getTrack",value:function(e,t){var n=this;return new Promise(function(r,o){switch(""==e&&(e="def"),t){case"audio":r(n.audioCache[e]);break;case"video":r(n.videoCache[e]);break;default:r()}})}},{key:"setTrack",value:function(t,n,r){switch(""==t&&(t="def"),n){case"audio":this.audioCache[t]=r;break;case"video":this.videoCache[t]=r;break;default:return}r.onmute=function(t){e.get().removeTrackByTrack(t.target)}}},{key:"removeTrackByTrack",value:function(e){switch(e.kind){case"audio":this._removeTrackFromCache(this.audioCache,e);break;case"video":this._removeTrackFromCache(this.videoCache,e);break;default:return}i.UserMediaManager.get().resetLocalVideo()}},{key:"_removeTrackFromCache",value:function(e,t){for(var n in e)e.hasOwnProperty(n)&&e[n].id===t.id&&delete e[n];t.stop()}},{key:"getAudioCache",value:function(){return this.audioCache}},{key:"getVideoCache",value:function(){return this.videoCache}},{key:"_traceName",value:function(){return"MediaCache"}}]),e}();t.MediaCache=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(9),c=n(0),l=function(){function e(t,n){var o=this;r(this,e),this._pcStatus=n,this._q=[],t.on(s.CallEvents.Updated,function(t){if(c.LogManager.get().writeMessage(c.LogCategory.REINVITEQ,"CallEvent",c.LogLevel.TRACE,"Updated with result "+t.result),e._currentReinvite){var n=e._currentReinvite;t.result?n.resolve(t):n.reject(t),e._currentReinvite=void 0}o.runNext()}),t.on(s.CallEvents.PendingUpdate,function(t){c.LogManager.get().writeMessage(c.LogCategory.REINVITEQ,"CallEvent",c.LogLevel.TRACE,"IncomingUpdate. Local RI=="+i(e._currentReinvite)),e._currentReinvite&&(e._currentReinvite.reject(),e._currentReinvite=void 0)}),t.on(s.CallEvents.UpdateFailed,function(t){c.LogManager.get().writeMessage(c.LogCategory.REINVITEQ,"CallEvent",c.LogLevel.TRACE,"UpdateFailed"),e._currentReinvite&&(e._currentReinvite.reject(),e._currentReinvite=void 0)})}return o(e,[{key:"runNext",value:function(){void 0===e._currentReinvite&&this._q.length>0&&this._pcStatus()&&(e._currentReinvite=this._q.splice(0,1)[0],e._currentReinvite.fx())}},{key:"add",value:function(e){this._q.push(e),this.runNext()}},{key:"clear",value:function(){this._q.forEach(function(e){e.reject()})}},{key:"_traceName",value:function(){return"ReInviteQ"}}]),e}();a([c.LogManager.d_trace(c.LogCategory.REINVITEQ)],l.prototype,"runNext",null),a([c.LogManager.d_trace(c.LogCategory.REINVITEQ)],l.prototype,"add",null),a([c.LogManager.d_trace(c.LogCategory.REINVITEQ)],l.prototype,"clear",null),t.ReInviteQ=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":s(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),u=n(26),d=n(1),g=n(15),f=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(t.instance)throw new Error("Error - use Client.getMessagingInstance()");return e.eventListeners=[],e.query=[],setInterval(function(){e.updateQuery()},220),e}return i(t,e),a(t,[{key:"handleWsData",value:function(e){if(-1==["onCreateConversation","onEditConversation","onRemoveConversation","onJoinConversation","onLeaveConversation","onGetConversation","onSendMessage","onEditMessage","onRemoveMessage","onTyping","onRetransmitEvents","onEditUser","onGetUser","isRead","isDelivered","onError","onSubscribe","onUnSubscribe","onSetStatus"].indexOf(e.event))throw new Error("Unknown messaging event "+e.event+" with payload "+JSON.stringify(e.payload));this.dispatchEvent(e.event,e)}},{key:"sendPayload",value:function(e,t){var n={service:u.MsgService.Chat,event:e,payload:t};return this.query.push(n),!0}},{key:"updateQuery",value:function(){if(this.query.length){var e=this.query.splice(0,1);d.VoxSignaling.get().sendRaw(e[0])}}},{key:"dispatchEvent",value:function(e,t){if(void 0!==this.eventListeners[e])for(var n=0;n<this.eventListeners[e].length;n++)"function"==typeof this.eventListeners[e][n]&&this.eventListeners[e][n](t.payload)}},{key:"_traceName",value:function(){return"MsgSignaling"}}],[{key:"get",value:function(){return t.instance=t.instance||new t,t.instance}}]),t}(g.EventDispatcher);c([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"handleWsData",null),c([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"sendPayload",null),t.MsgSignaling=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.Chat="chat"]="Chat"}(t.MsgService||(t.MsgService={}));!function(e){e[e.createConversation="createConversation"]="createConversation",e[e.editConversation="editConversation"]="editConversation",e[e.removeConversation="removeConversation"]="removeConversation",e[e.joinConversation="joinConversation"]="joinConversation",e[e.leaveConversation="leaveConversation"]="leaveConversation",e[e.getConversation="getConversation"]="getConversation",e[e.getConversations="getConversations"]="getConversations",e[e.sendMessage="sendMessage"]="sendMessage",e[e.editMessage="editMessage"]="editMessage",e[e.removeMessage="removeMessage"]="removeMessage",e[e.typingMessage="typingMessage"]="typingMessage",e[e.editUser="editUser"]="editUser",e[e.getUser="getUser"]="getUser",e[e.getUsers="getUsers"]="getUsers",e[e.retransmitEvents="retransmitEvents"]="retransmitEvents",e[e.isRead="isRead"]="isRead",e[e.isDelivered="isDelivered"]="isDelivered",e[e.addParticipants="addParticipants"]="addParticipants",e[e.editParticipants="editParticipants"]="editParticipants",e[e.removeParticipants="removeParticipants"]="removeParticipants",e[e.addModerators="addModerators"]="addModerators",e[e.removeModerators="removeModerators"]="removeModerators",e[e.subscribe="subscribe"]="subscribe",e[e.unsubscribe="unsubscribe"]="unsubscribe",e[e.setStatus="setStatus"]="setStatus"}(t.MsgAction||(t.MsgAction={}));!function(e){e[e.onCreateConversation="onCreateConversation"]="onCreateConversation",e[e.onEditConversation="onEditConversation"]="onEditConversation",e[e.onRemoveConversation="onRemoveConversation"]="onRemoveConversation",e[e.onJoinConversation="onJoinConversation"]="onJoinConversation",e[e.onLeaveConversation="onLeaveConversation"]="onLeaveConversation",e[e.onGetConversation="onGetConversation"]="onGetConversation",e[e.onSendMessage="onSendMessage"]="onSendMessage",e[e.onEditMessage="onEditMessage"]="onEditMessage",e[e.onRemoveMessage="onRemoveMessage"]="onRemoveMessage",e[e.onTyping="onTyping"]="onTyping",e[e.onRetransmitEvents="onRetransmitEvents"]="onRetransmitEvents",e[e.onEditUser="onEditUser"]="onEditUser",e[e.onGetUser="onGetUser"]="onGetUser",e[e.onError="onError"]="onError",e[e.isRead="isRead"]="isRead",e[e.isDelivered="isDelivered"]="isDelivered",e[e.onsubscribe="onsubscribe"]="onsubscribe",e[e.onUnSubscribe="onUnSubscribe"]="onUnSubscribe",e[e.onSetStatus="onSetStatus"]="onSetStatus"}(t.MsgEvent||(t.MsgEvent={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t){r(this,e),this.str=t||e.getNewGUIDString()}return o(e,[{key:"toString",value:function(){return this.str}},{key:"_traceName",value:function(){return"GUID"}}],[{key:"getNewGUIDString",value:function(){var e=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})}}]),e}();t.GUID=i},function(e,t,n){"use strict";var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},r.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),o=0;o<r.length;o++)t=r[o].trim().split("="),n[t[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return n=n.concat(r.splitLines(t)),{usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e),o=n[0].split(" "),i=3;i<o.length;i++){var a=o[i],s=r.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=r.parseRtpMap(s),l=r.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=l.length?r.parseFmtp(l[0]):{},c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var o=0;return t.codecs.forEach(function(e){e.maxptime>o&&(o=e.maxptime)}),o>0&&(n+="a=maxptime:"+o+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],o=r.parseRtpParameters(e),i=-1!==o.fecMechanisms.indexOf("RED"),a=-1!==o.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,l=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});l.length>0&&l[0].length>1&&l[0][0]===c&&(t=l[0][1]),o.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};n.push(r),i&&(r=JSON.parse(JSON.stringify(r)),r.fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var u=r.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=u})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var o=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=o.length>0,t.compound=0===o.length;var i=r.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substr(7).split(" "),{stream:t[0],track:t[1]};var o=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return o.length>0?(t=o[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t){var n=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||r.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,o){var i=r.writeRtpDescription(e.kind,t);if(i+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",e.direction?i+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var a="msid:"+o.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+a,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),i},r.getDirection=function(e,t){for(var n=r.splitLines(e),o=0;o<n.length;o++)switch(n[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[o].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e),n=t[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0],n=t.substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},e.exports=r},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(25),c=n(27),l=n(0),u=n(10),d=n(26);!function(e){var t=function(){function e(t,n,o,i,a){r(this,e),this._distinct=n,this._publicJoin=o,this._participants=t,this._customData=i,this._moderators=a}return o(e,[{key:"_getPayload",value:function(){if(void 0===this._uuid)throw Error("You must create UUID with createUUID() function!");var e={uuid:this._uuid,participants:this._prepareParticipants(this._participants)};return void 0!==this._title?e.title=this._title:e.title="",void 0!==this._moderators?e.moderators=this._moderators:e.moderators=[],void 0!==this._lastRead&&(e.last_readed=this._lastRead),void 0!==this._distinct?e.distinct=this._distinct:e.distinct=!1,void 0!==this._publicJoin?e.enable_public_join=this._publicJoin:e.enable_public_join=!1,void 0!==this._customData?e.custom_data=this._customData:e.custom_data={},void 0!==this._createdAt&&(e.created_at=this._createdAt),void 0!==this._createdAt&&(e.uber_conversation=this._uberConversation),e}},{key:"_getSimplePayload",value:function(){if(void 0===this._uuid)throw Error("You must create UUID with createUUID() function!");return{uuid:this._uuid,title:void 0!==this._title?this._title:"",distinct:void 0!==this._distinct&&this._distinct,enable_public_join:void 0!==this._publicJoin&&this._publicJoin,custom_data:void 0!==this._customData?this._customData:{}}}},{key:"_prepareParticipants",value:function(e){var t=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;if(void 0!==c.userId){var l={user_id:n.extractUserName(c.userId)};l.can_write=void 0===c.canWrite||c.canWrite,l.can_manage_participants=void 0!==c.canManageParticipants&&c.canManageParticipants,t.push(l)}}}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return t}},{key:"_createUUID",value:function(){if(void 0!==this._uuid)throw Error("UUID already created!");this._uuid=(new c.GUID).toString()}},{key:"toCache",value:function(){return{uuid:this._uuid,seq:this._lastSeq,lastUpdate:this._lastUpdate,moderators:this._moderators,title:this._title,createdAt:this._createdAt,lastRead:this._lastRead,distinct:this._distinct,publicJoin:this._publicJoin,participants:this._participants,customData:this._customData}}},{key:"sendMessage",value:function(e,t){var n=new i(e,t);return n.sendTo(this),n}},{key:"typing",value:function(){var e=this;return!this._debounceLock&&(setTimeout(function(){e._debounceLock=!1},1e4),this._debounceLock=!0,s.MsgSignaling.get().sendPayload(d.MsgAction.typingMessage,{conversation:this._uuid}),!0)}},{key:"markAsRead",value:function(e){s.MsgSignaling.get().sendPayload(d.MsgAction.isRead,{conversation:this._uuid,seq:e}),this._lastRead=e}},{key:"markAsDelivered",value:function(e){s.MsgSignaling.get().sendPayload(d.MsgAction.isDelivered,{conversation:this._uuid,seq:e})}},{key:"remove",value:function(){n.get().removeConversation(this._uuid)}},{key:"update",value:function(){n.get().editConversation(this)}},{key:"setTitle",value:function(e){this._title=e,n.get().editConversation(this)}},{key:"setPublicJoin",value:function(e){this._publicJoin=e,n.get().editConversation(this)}},{key:"setDistinct",value:function(e){this._distinct=e,n.get().editConversation(this)}},{key:"setCustomData",value:function(e){this._customData=e,n.get().editConversation(this)}},{key:"addParticipants",value:function(e){var t=this;return new Promise(function(n,r){0==e.length&&r(),s.MsgSignaling.get().sendPayload(d.MsgAction.addParticipants,{uuid:t._uuid,participants:t._prepareParticipants(e)}),g.getInstance()._registerPromise(f.EditConversation,n,r)})}},{key:"editParticipants",value:function(e){var t=this;return new Promise(function(n,r){0==e.length&&r(),s.MsgSignaling.get().sendPayload(d.MsgAction.editParticipants,{uuid:t._uuid,participants:t._prepareParticipants(e)}),g.getInstance()._registerPromise(f.EditConversation,n,r)})}},{key:"removeParticipants",value:function(e){var t=this;return new Promise(function(n,r){0==e.length&&r(),s.MsgSignaling.get().sendPayload(d.MsgAction.removeParticipants,{uuid:t._uuid,participants:e.map(function(e){if(void 0!==e.userId)return e.userId})}),g.getInstance()._registerPromise(f.EditConversation,n,r)})}},{key:"addModerators",value:function(e){var t=this;return new Promise(function(n,r){0==e.length&&r(),s.MsgSignaling.get().sendPayload(d.MsgAction.addModerators,{uuid:t._uuid,moderators:e}),g.getInstance()._registerPromise(f.EditConversation,n,r)})}},{key:"removeModerators",value:function(e){var t=this;return new Promise(function(n,r){0==e.length&&r(),s.MsgSignaling.get().sendPayload(d.MsgAction.removeModerators,{uuid:t._uuid,moderators:e}),g.getInstance()._registerPromise(f.EditConversation,n,r)})}},{key:"retransmitEvents",value:function(e,t){e|=0,t|=0,s.MsgSignaling.get().sendPayload(d.MsgAction.retransmitEvents,{uuid:this._uuid,eventsFrom:e,eventsTo:t})}},{key:"updateSeq",value:function(e){e>this._lastSeq&&(this._lastSeq=e),this._lastUpdate=Date.now()/1e3|0}},{key:"_traceName",value:function(){return"Conversation"}},{key:"lastRead",get:function(){return this._lastRead}},{key:"uberConversation",get:function(){return this._uberConversation}},{key:"uuid",get:function(){return this._uuid}},{key:"title",set:function(e){this._title=e},get:function(){return this._title}},{key:"distinct",set:function(e){this._distinct=e},get:function(){return this._distinct}},{key:"publicJoin",set:function(e){this._publicJoin=e},get:function(){return this._publicJoin}},{key:"customData",set:function(e){this._customData=e},get:function(){return this._customData}},{key:"moderators",get:function(){return this._moderators}},{key:"createdAt",get:function(){return this._createdAt}},{key:"participants",get:function(){return this._participants}},{key:"lastSeq",get:function(){return this._lastSeq}},{key:"lastUpdate",get:function(){return this._lastUpdate}}],[{key:"_createFromBus",value:function(t,n){var r=new e([]);return r._lastSeq=n,r._uuid=t.uuid,r._title=t.title,r._moderators=t.moderators,r._createdAt=t.created_at,r._lastRead=t.last_read,r._distinct=t.distinct,r._publicJoin=t.public_join,r._uberConversation=t.uber_conversation,t.participants&&(r._participants=t.participants.map(function(e){return{userId:e.user_id,canWrite:e.can_write,canManageParticipants:e.can_manage_participants}})),t.custom_data&&(r._customData=t.custom_data),r._lastUpdate=t.last_update,r}},{key:"createFromCache",value:function(t){var n=new e([]);return n._uuid=t.uuid,n._lastSeq=t.seq,n._lastUpdate=t.lastUpdate,n._title=t.title,n._moderators=t.moderators,n._createdAt=t.createdAt,n._lastRead=t.lastRead,n._distinct=t.distinct,n._publicJoin=t.publicJoin,n._participants=t.participants,n._customData=t.customData,n._uberConversation=t.uberConversation,n}}]),e}();a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"_getPayload",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"_getSimplePayload",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"_prepareParticipants",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"_createUUID",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"toCache",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"markAsRead",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"markAsDelivered",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"remove",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"update",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"addParticipants",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"editParticipants",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"removeParticipants",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"addModerators",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"removeModerators",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"retransmitEvents",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"updateSeq",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t,"_createFromBus",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t,"createFromCache",null),e.Conversation=t;var n=function(){function e(){var n=this;if(r(this,e),e.instance)throw new Error("Error - use ConversationManager.get()");this.signalling=s.MsgSignaling.get(),this.awaitingConversations={},this.signalling.addEventListener(d.MsgEvent.onEditConversation,function(e){n.resolveEvent(e,f.EditConversation)}),this.signalling.addEventListener(d.MsgEvent.onGetConversation,function(e){n.resolveEvent(e,f.GetConversation)}),this.signalling.addEventListener(d.MsgEvent.onRemoveConversation,function(e){n.resolveEvent(e,f.RemoveConversation)}),this.signalling.addEventListener(d.MsgEvent.onCreateConversation,function(e){n.resolveEvent(e,f.CreateConversation)}),this.signalling.addEventListener(d.MsgEvent.onSendMessage,function(e){n.resolveMessageEvent(e,f.SendMessage)}),this.signalling.addEventListener(d.MsgEvent.onEditMessage,function(e){n.resolveMessageEvent(e,f.EditMessage)}),this.signalling.addEventListener(d.MsgEvent.onRemoveMessage,function(e){n.resolveMessageEvent(e,f.RemoveMessage)}),this.signalling.addEventListener(d.MsgEvent.isRead,function(e){var t=e.object;g.getInstance()._dispatchEvent(f.Read,{conversation:t.conversation,timestamp:new Date(1e3*t.timestamp),userId:e.user_id,seq:t.seq,onIncomingEvent:e.on_incoming_event,name:f[f.Read]})}),this.signalling.addEventListener(d.MsgEvent.isDelivered,function(e){var t=e.object;g.getInstance()._dispatchEvent(f.Delivered,{conversation:t.conversation,timestamp:new Date(1e3*t.timestamp),userId:e.user_id,seq:t.seq,onIncomingEvent:e.on_incoming_event,name:f[f.Delivered]})}),this.signalling.addEventListener(d.MsgEvent.onTyping,function(e){g.getInstance()._dispatchEvent(f.Typing,{name:f[f.Typing],conversation:e.object.conversation,userId:e.user_id,onIncomingEvent:e.on_incoming_event})}),this.signalling.addEventListener(d.MsgEvent.onRetransmitEvents,function(e){g.getInstance()._dispatchEvent(f.RetransmitEvents,{events:e.object.map(function(e){if(e.event)return-1==e.event.indexOf("Message")?{name:e.event,conversation:t._createFromBus(e.payload.object,e.payload.seq),userId:e.payload.user_id,seq:e.payload.seq,onIncomingEvent:e.payload.on_incoming_event}:{name:e.event,message:i._createFromBus(e.payload.object,e.payload.seq),userId:e.payload.user_id,seq:e.payload.seq,onIncomingEvent:e.payload.on_incoming_event}}),userId:e.user_id,seq:e.seq,from:e.from,to:e.to,onIncomingEvent:e.on_incoming_event})}),this._converasationList=[]}return o(e,[{key:"resolveEvent",value:function(e,n){if(f[n]===f[f.RemoveConversation]){var r=e.object;return void g.getInstance()._dispatchEvent(n,{name:f[n],uuid:r.uuid,userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event})}var o=t._createFromBus(e.object,e.seq);this.registerConversation(o),void 0!==o&&o.updateSeq(e.seq),g.getInstance()._dispatchEvent(n,{name:f[n],conversation:o,userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event}),n===f.GetConversation&&void 0!==this.awaitingConversations[o.uuid]&&(this.awaitingConversations[o.uuid](o),delete this.awaitingConversations[o.uuid])}},{key:"resolveMessageEvent",value:function(e,t){var n=i._createFromBus(e.object,e.seq);void 0!==this._converasationList[n.conversation]&&this._converasationList[n.conversation].updateSeq(e.seq),g.getInstance()._dispatchEvent(t,{name:f[t],message:n,userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event})}},{key:"createConversation",value:function(e,n,r,o,i,a){var s=new t(e,r,o,i,a);s.title=n,s._createUUID(),this.signalling.sendPayload(d.MsgAction.createConversation,s._getPayload())}},{key:"registerConversation",value:function(e){this._converasationList.filter(function(t){return t.uuid!==e.uuid}),this._converasationList.push(e)}},{key:"removeConversation",value:function(e){this.signalling.sendPayload(d.MsgAction.removeConversation,{uuid:e})}},{key:"editConversation",value:function(e){this.signalling.sendPayload(d.MsgAction.editConversation,e._getSimplePayload())}},{key:"getConversation",value:function(e){this.signalling.sendPayload(d.MsgAction.getConversation,{uuid:e})}},{key:"getConversationByUUID",value:function(e){var t=this;return new Promise(function(n,r){var o=!0,i=!1,a=void 0;try{for(var s,c=t._converasationList[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var l=s.value;if(l.uuid===e)return g.getInstance()._dispatchEvent(f.GetConversation,{conversation:l}),void n(l)}}catch(e){i=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw a}}t.awaitingConversations[e]=n})}},{key:"getConversations",value:function(e){this.signalling.sendPayload(d.MsgAction.getConversations,{uuids:e})}},{key:"_traceName",value:function(){return"ConversationManager"}}],[{key:"get",value:function(){return e.instance=e.instance||new e,e.instance}},{key:"extractUserName",value:function(e){var t=e.split("@");return t[1]=t[1].split(".").splice(0,2).join("."),t.join("@")}},{key:"deserialize",value:function(e){return t.createFromCache(e)}},{key:"serialize",value:function(e){return e.toCache()}}]),e}();a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"resolveEvent",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"resolveMessageEvent",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"createConversation",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"registerConversation",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"removeConversation",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"editConversation",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"getConversation",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"getConversationByUUID",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"getConversations",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n,"get",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n,"extractUserName",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n,"deserialize",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n,"serialize",null);var i=function(){function e(t,n){r(this,e),this._text=t,this._payload=n,this._uuid=(new c.GUID).toString()}return o(e,[{key:"sendTo",value:function(e){this._conversation=e.uuid,s.MsgSignaling.get().sendPayload(d.MsgAction.sendMessage,this.getPayload())}},{key:"getPayload",value:function(){var e={uuid:this._uuid,text:this._text,conversation:this._conversation};return void 0!==this._payload?e.payload=this._payload:e.payload=[],e}},{key:"update",value:function(){s.MsgSignaling.get().sendPayload(d.MsgAction.editMessage,this.getPayload())}},{key:"remove",value:function(){s.MsgSignaling.get().sendPayload(d.MsgAction.removeMessage,{uuid:this._uuid,conversation:this.conversation})}},{key:"toCache",value:function(){return{seq:this._seq,uuid:this._uuid,text:this._text,payload:this._payload,conversation:this._conversation,sender:this._sender}}},{key:"_traceName",value:function(){return"Message"}},{key:"uuid",get:function(){return this._uuid}},{key:"conversation",get:function(){return this._conversation}},{key:"text",get:function(){return this._text},set:function(e){this._text=e}},{key:"payload",get:function(){return this._payload},set:function(e){this._payload=e}},{key:"seq",get:function(){return this._seq}},{key:"sender",get:function(){return this._sender}}],[{key:"_createFromBus",value:function(t,n){var r=new e(t.text,t.payload);return r._uuid=t.uuid,r._conversation=t.conversation,r._sender=t.sender,r._seq=n,r}},{key:"createFromCache",value:function(t){var n=new e(t.text,t.payload);return n._uuid=t.uuid,n._conversation=t.conversation,n._sender=t.sender,n._seq=t.seq,n}}]),e}();a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i.prototype,"sendTo",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i.prototype,"getPayload",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i.prototype,"update",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i.prototype,"remove",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i.prototype,"toCache",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i,"_createFromBus",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i,"createFromCache",null),e.Message=i;var g=function(){function e(){var t=this;if(r(this,e),e.instance)throw new Error("Error - use Client.getIM()");this.eventListeners={},this.signalling=s.MsgSignaling.get(),this.cm=n.get(),this.signalling.addEventListener(d.MsgEvent.onError,function(e){t._dispatchEvent(f.Error,e)}),n.get(),this.signalling.addEventListener(d.MsgEvent.onEditUser,function(e){var n=e.object,r={user:{customData:n.custom_data,privateCustomData:n.private_custom_data,userId:n.user_id},userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event};t._dispatchEvent(f.EditUser,r)}),this.signalling.addEventListener(d.MsgEvent.onGetUser,function(e){var n=e.object,r={user:{conversationsList:n.conversations_list,leaveConversationList:n.leave_conversation_list,customData:n.custom_data,privateCustomData:n.private_custom_data,userId:n.user_id},userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event};t._dispatchEvent(f.GetUser,r)}),this.signalling.addEventListener(d.MsgEvent.onsubscribe,function(e){t._dispatchEvent(f.Subscribe,{users:e.users})}),this.signalling.addEventListener(d.MsgEvent.onUnSubscribe,function(e){t._dispatchEvent(f.Unsubscribe,{users:e.users})}),this.signalling.addEventListener(d.MsgEvent.onSetStatus,function(e){t._dispatchEvent(f.SetStatus,{user:{userId:e.object.user_id,online:e.object.online,timestamp:e.object.timestamp},userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event})}),this.awaitPromiseList=[]}return o(e,[{key:"createConversation",value:function(e,t,n,r,o,i){this.cm.createConversation(e,t,n,r,o,i)}},{key:"getConversation",value:function(e){this.cm.getConversation(e)}},{key:"getConversations",value:function(e){return e.length>30?void l.LogManager.get().writeMessage(l.LogCategory.MESSAGING,"Rate limit",l.LogLevel.ERROR,"you can get maximum 30 conversation in one getConversations"):this.cm.getConversations(e)}},{key:"getRawConversations",value:function(e){return this.cm.getConversations(e)}},{key:"removeConversation",value:function(e){this.cm.removeConversation(e)}},{key:"joinConversation",value:function(e){this.signalling.sendPayload(d.MsgAction.joinConversation,{uuid:e})}},{key:"leaveConversation",value:function(e){this.signalling.sendPayload(d.MsgAction.leaveConversation,{uuid:e})}},{key:"getUser",value:function(e){this.signalling.sendPayload(d.MsgAction.getUser,{user_id:e})}},{key:"getMe",value:function(){return n.extractUserName(u.Authenticator.get().username())}},{key:"editUser",value:function(e,t){var r={user_id:n.extractUserName(u.Authenticator.get().username())};e&&(r.custom_data=e),t&&(r.private_custom_data=t),this.signalling.sendPayload(d.MsgAction.editUser,r)}},{key:"getUsers",value:function(e){this.signalling.sendPayload(d.MsgAction.getUsers,{users:e})}},{key:"addEventListener",value:function(e,t){void 0===this.eventListeners[e]&&(this.eventListeners[e]=[]),this.eventListeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this.eventListeners[e])if("function"==typeof t){for(var n=0;n<this.eventListeners[e].length;n++)if(this.eventListeners[e][n]===t){this.eventListeners[e].splice(n,1);break}}else this.eventListeners[e]=[]}},{key:"_dispatchEvent",value:function(e,t){if(t.name=f[e],void 0!==this.eventListeners[e]&&this.eventListeners[e].forEach(function(e){"function"==typeof e&&e(t)}),void 0!==this.awaitPromiseList[e]&&0!=this.awaitPromiseList[e].length){var n=this.awaitPromiseList[e].splice(0,1);n.resolve(t),window.clearTimeout(n.expire)}}},{key:"on",value:function(e,t){this.addEventListener(e,t)}},{key:"off",value:function(e,t){this.removeEventListener(e,t)}},{key:"_registerPromise",value:function(e,t,n){void 0===this.awaitPromiseList[e]&&(this.awaitPromiseList[e]=[]),this.awaitPromiseList[e].push({resolve:t,reject:n,expire:setTimeout(function(){n()},2e4)})}},{key:"createConversationFromCache",value:function(e){return void 0===e?null:t.createFromCache(e)}},{key:"createMessageFromCache",value:function(e){return void 0===e?null:i.createFromCache(e)}},{key:"subscribe",value:function(e){this.signalling.sendPayload(d.MsgAction.subscribe,{users:e})}},{key:"unsubscribe",value:function(e){this.signalling.sendPayload(d.MsgAction.unsubscribe,{users:e})}},{key:"setPresence",value:function(e){this.setStatus(e)}},{key:"setStatus",value:function(e){this.signalling.sendPayload(d.MsgAction.setStatus,{online:e})}},{key:"_traceName",value:function(){return"Messenger"}}],[{key:"getInstance",value:function(){return e.instance=e.instance||new e,e.instance}}]),e}();a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"createConversation",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"getConversation",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"getConversations",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"getRawConversations",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"removeConversation",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"joinConversation",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"leaveConversation",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"getUser",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"getMe",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"editUser",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"getUsers",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"addEventListener",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"removeEventListener",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"_dispatchEvent",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"on",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"off",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"_registerPromise",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"createConversationFromCache",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"createMessageFromCache",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"subscribe",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"unsubscribe",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"setPresence",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"setStatus",null),a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g,"getInstance",null),e.Messenger=g;var f=void 0;!function(e){e.CreateConversation="CreateConversation",e.EditConversation="EditConversation",e.RemoveConversation="RemoveConversation",e.GetConversation="GetConversation",e.SendMessage="SendMessage",e.EditMessage="EditMessage",e.RemoveMessage="RemoveMessage",e.Typing="Typing",e.EditUser="EditUser",e.GetUser="GetUser",e.Error="Error",e.RetransmitEvents="RetransmitEvents",e.Read="Read",e.Delivered="Delivered",e.Subscribe="Subscribe",e.Unsubscribe="Unsubscribe",e.SetStatus="SetStatus"}(f=e.MessengerEvents||(e.MessengerEvents={}));!function(e){e[e.createConversation="createConversation"]="createConversation",e[e.editConversation="editConversation"]="editConversation",e[e.removeConversation="removeConversation"]="removeConversation",e[e.joinConversation="joinConversation"]="joinConversation",e[e.leaveConversation="leaveConversation"]="leaveConversation",e[e.getConversation="getConversation"]="getConversation",e[e.getConversations="getConversations"]="getConversations",e[e.sendMessage="sendMessage"]="sendMessage",e[e.editMessage="editMessage"]="editMessage",e[e.removeMessage="removeMessage"]="removeMessage",e[e.typingMessage="typingMessage"]="typingMessage",e[e.editUser="editUser"]="editUser",e[e.getUser="getUser"]="getUser",e[e.getUsers="getUsers"]="getUsers",e[e.retransmitEvents="retransmitEvents"]="retransmitEvents",e[e.isRead="isRead"]="isRead",e[e.isDelivered="isDelivered"]="isDelivered",e[e.addParticipants="addParticipants"]="addParticipants",e[e.editParticipants="editParticipants"]="editParticipants",e[e.removeParticipants="removeParticipants"]="removeParticipants",e[e.addModerators="addModerators"]="addModerators",e[e.removeModerators="removeModerators"]="removeModerators",e[e.subscribe="subscribe"]="subscribe",e[e.unsubscribe="unsubscribe"]="unsubscribe",e[e.setStatus="setStatus"]="setStatus"}(e.MessengerAction||(e.MessengerAction={}));!function(e){e[e.Error_1="1"]="Error_1",e[e.Error_2="2"]="Error_2",e[e.Error_3="3"]="Error_3",e[e.Error_4="4"]="Error_4",e[e.Error_5="5"]="Error_5",e[e.Error_6="6"]="Error_6",e[e.Error_7="7"]="Error_7",e[e.Error_8="8"]="Error_8",e[e.Error_9="9"]="Error_9",e[e.Error_10="10"]="Error_10",e[e.Error_11="11"]="Error_11",e[e.Error_12="12"]="Error_12",e[e.Error_13="13"]="Error_13",e[e.Error_14="14"]="Error_14",e[e.Error_15="15"]="Error_15",e[e.Error_16="16"]="Error_16",e[e.Error_17="17"]="Error_17",e[e.Error_18="18"]="Error_18",e[e.Error_19="19"]="Error_19",e[e.Error_21="21"]="Error_21",e[e.Error_22="22"]="Error_22",e[e.Error_23="23"]="Error_23",e[e.Error_24="24"]="Error_24",e[e.Error_30="30"]="Error_30",e[e.Error_500="500"]="Error_500",e[e.Error_777="777"]="Error_777"}(e.MessengerError||(e.MessengerError={}))}(t.Messaging||(t.Messaging={}))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function o(){return a.Client.getInstance()}function i(){if(!s.Authenticator.get().authorized())throw new Error("NOT_AUTHORIZED");return c.Messaging.Messenger.getInstance()}Object.defineProperty(t,"__esModule",{value:!0});var a=n(3);n(46);var s=n(10),c=n(29),l=n(18);t.Events=l.Events;var u=n(9);t.CallEvents=u.CallEvents;var d=n(58);t.EndPoint=d.EndPoint,r(n(29));var g=n(59);t.OperatorACDStatuses=g.OperatorACDStatuses;var f=n(0);t.LogCategory=f.LogCategory,t.LogLevel=f.LogLevel,r(n(13)),t.getInstance=o,t.version=a.Client.getInstance().version,t.getMessenger=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(32),a=n(23),s=n(17),c=n(0),l=function(){function e(){r(this,e)}return o(e,[{key:"_traceName",value:function(){return"FF"}}],[{key:"attachStream",value:function(e,t){void 0===t.srcObject?t.mozSrcObject=e:t.srcObject=e,t.load(),t.play()}},{key:"detachStream",value:function(e){void 0===e.srcObject?e.mozSrcObject=null:e.srcObject=null,e.load(),e.src=""}},{key:"screenSharingSupported",value:function(){return new Promise(function(e,t){if("https:"!=window.location.protocol)return void e(!1);e(!0)})}},{key:"getScreenMedia",value:function(){var e={audio:!1,video:{mediaSource:"window"}};return c.LogManager.get().writeMessage(c.LogCategory.USERMEDIA,"[constraints]",c.LogLevel.TRACE,JSON.stringify(e)),navigator.mediaDevices.getUserMedia(e)}},{key:"getRTCStats",value:function(e){return new Promise(function(t,n){e.getStats(null).then(function(e){var n=[];e.forEach(function(e){"inboundrtp"!=e.type&&"outboundrtp"!=e.type||n.push(e)}),t(n)}).catch(n)})}},{key:"getUserMedia",value:function(e){return new Promise(function(t,n){var r=new MediaStream,o=a.MediaCache.get(),s=[];new Promise(function(t,n){var r=[];if(void 0!==e.audio&&!1!==e.audio){var a=i.Md5.hashStr(JSON.stringify(e.audio));o.getTrack(a,"audio").then(function(n){if(void 0!==n&&"ended"!==n.readyState)r.push(n),t(r);else{var i=JSON.parse(JSON.stringify(e));i.video=!1,c.LogManager.get().writeMessage(c.LogCategory.USERMEDIA,"[constraints]",c.LogLevel.TRACE,JSON.stringify(i)),navigator.mediaDevices.getUserMedia(i).then(function(e){var n=!0,i=!1,s=void 0;try{for(var c,l=e.getTracks()[Symbol.iterator]();!(n=(c=l.next()).done);n=!0){var u=c.value;o.setTrack(a,"audio",u),r.push(u)}}catch(e){i=!0,s=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw s}}t(r)}).catch(function(e){t([])})}})}else t([])}).then(function(t){return new Promise(function(n,r){if(void 0!==e.video&&!1!==e.video){var a=i.Md5.hashStr(JSON.stringify(e.video));s.push(new Promise(function(r,i){o.getTrack(a,"video").then(function(r){if(void 0!==r&&"ended"!==r.readyState)t.push(r),n(t);else{var i=JSON.parse(JSON.stringify(e));i.audio=!1,c.LogManager.get().writeMessage(c.LogCategory.USERMEDIA,"[constraints]",c.LogLevel.TRACE,JSON.stringify(i)),navigator.mediaDevices.getUserMedia(i).then(function(e){var r=!0,i=!1,s=void 0;try{for(var c,l=e.getTracks()[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var u=c.value;o.setTrack(a,"video",u),t.push(u),n(t)}}catch(e){i=!0,s=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw s}}}).catch(function(e){n(t)})}})}))}else n(t)})}).then(function(e){var o=!0,i=!1,a=void 0;try{for(var s,c=e[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var l=s.value;void 0!==l&&r.addTrack(l)}}catch(e){i=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw a}}e.length>0?t(r):n()}).catch(function(e){n(e)})})}},{key:"getDTMFSender",value:function(e,t){var n=/Firefox\/([0-9\.]+)(?:\s|$)/,r=navigator.userAgent;if(n.test(r)){if(+n.exec(r)[1].split(".")[0]>=53){var o=e.getSenders().map(function(e){if(e.track&&"audio"===e.track.kind&&e.dtmf)return e.dtmf});if(o.length>0)return o[0]}}return new s.SignalingDTMFSender(t)}}]),e}();t.FF=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}return e.hashStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendStr(e).end(t)},e.hashAsciiStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendAsciiStr(e).end(t)},e._hex=function(t){var n,r,o,i,a=e.hexChars,s=e.hexOut;for(i=0;i<4;i+=1)for(r=8*i,n=t[i],o=0;o<8;o+=2)s[r+1+o]=a.charAt(15&n),n>>>=4,s[r+0+o]=a.charAt(15&n),n>>>=4;return s.join("")},e._md5cycle=function(e,t){var n=e[0],r=e[1],o=e[2],i=e[3];n+=(r&o|~r&i)+t[0]-680876936|0,n=(n<<7|n>>>25)+r|0,i+=(n&r|~n&o)+t[1]-389564586|0,i=(i<<12|i>>>20)+n|0,o+=(i&n|~i&r)+t[2]+606105819|0,o=(o<<17|o>>>15)+i|0,r+=(o&i|~o&n)+t[3]-1044525330|0,r=(r<<22|r>>>10)+o|0,n+=(r&o|~r&i)+t[4]-176418897|0,n=(n<<7|n>>>25)+r|0,i+=(n&r|~n&o)+t[5]+1200080426|0,i=(i<<12|i>>>20)+n|0,o+=(i&n|~i&r)+t[6]-1473231341|0,o=(o<<17|o>>>15)+i|0,r+=(o&i|~o&n)+t[7]-45705983|0,r=(r<<22|r>>>10)+o|0,n+=(r&o|~r&i)+t[8]+1770035416|0,n=(n<<7|n>>>25)+r|0,i+=(n&r|~n&o)+t[9]-1958414417|0,i=(i<<12|i>>>20)+n|0,o+=(i&n|~i&r)+t[10]-42063|0,o=(o<<17|o>>>15)+i|0,r+=(o&i|~o&n)+t[11]-1990404162|0,r=(r<<22|r>>>10)+o|0,n+=(r&o|~r&i)+t[12]+1804603682|0,n=(n<<7|n>>>25)+r|0,i+=(n&r|~n&o)+t[13]-40341101|0,i=(i<<12|i>>>20)+n|0,o+=(i&n|~i&r)+t[14]-1502002290|0,o=(o<<17|o>>>15)+i|0,r+=(o&i|~o&n)+t[15]+1236535329|0,r=(r<<22|r>>>10)+o|0,n+=(r&i|o&~i)+t[1]-165796510|0,n=(n<<5|n>>>27)+r|0,i+=(n&o|r&~o)+t[6]-1069501632|0,i=(i<<9|i>>>23)+n|0,o+=(i&r|n&~r)+t[11]+643717713|0,o=(o<<14|o>>>18)+i|0,r+=(o&n|i&~n)+t[0]-373897302|0,r=(r<<20|r>>>12)+o|0,n+=(r&i|o&~i)+t[5]-701558691|0,n=(n<<5|n>>>27)+r|0,i+=(n&o|r&~o)+t[10]+38016083|0,i=(i<<9|i>>>23)+n|0,o+=(i&r|n&~r)+t[15]-660478335|0,o=(o<<14|o>>>18)+i|0,r+=(o&n|i&~n)+t[4]-405537848|0,r=(r<<20|r>>>12)+o|0,n+=(r&i|o&~i)+t[9]+568446438|0,n=(n<<5|n>>>27)+r|0,i+=(n&o|r&~o)+t[14]-1019803690|0,i=(i<<9|i>>>23)+n|0,o+=(i&r|n&~r)+t[3]-187363961|0,o=(o<<14|o>>>18)+i|0,r+=(o&n|i&~n)+t[8]+1163531501|0,r=(r<<20|r>>>12)+o|0,n+=(r&i|o&~i)+t[13]-1444681467|0,n=(n<<5|n>>>27)+r|0,i+=(n&o|r&~o)+t[2]-51403784|0,i=(i<<9|i>>>23)+n|0,o+=(i&r|n&~r)+t[7]+1735328473|0,o=(o<<14|o>>>18)+i|0,r+=(o&n|i&~n)+t[12]-1926607734|0,r=(r<<20|r>>>12)+o|0,n+=(r^o^i)+t[5]-378558|0,n=(n<<4|n>>>28)+r|0,i+=(n^r^o)+t[8]-2022574463|0,i=(i<<11|i>>>21)+n|0,o+=(i^n^r)+t[11]+1839030562|0,o=(o<<16|o>>>16)+i|0,r+=(o^i^n)+t[14]-35309556|0,r=(r<<23|r>>>9)+o|0,n+=(r^o^i)+t[1]-1530992060|0,n=(n<<4|n>>>28)+r|0,i+=(n^r^o)+t[4]+1272893353|0,i=(i<<11|i>>>21)+n|0,o+=(i^n^r)+t[7]-155497632|0,o=(o<<16|o>>>16)+i|0,r+=(o^i^n)+t[10]-1094730640|0,r=(r<<23|r>>>9)+o|0,n+=(r^o^i)+t[13]+681279174|0,n=(n<<4|n>>>28)+r|0,i+=(n^r^o)+t[0]-358537222|0,i=(i<<11|i>>>21)+n|0,o+=(i^n^r)+t[3]-722521979|0,o=(o<<16|o>>>16)+i|0,r+=(o^i^n)+t[6]+76029189|0,r=(r<<23|r>>>9)+o|0,n+=(r^o^i)+t[9]-640364487|0,n=(n<<4|n>>>28)+r|0,i+=(n^r^o)+t[12]-421815835|0,i=(i<<11|i>>>21)+n|0,o+=(i^n^r)+t[15]+530742520|0,o=(o<<16|o>>>16)+i|0,r+=(o^i^n)+t[2]-995338651|0,r=(r<<23|r>>>9)+o|0,n+=(o^(r|~i))+t[0]-198630844|0,n=(n<<6|n>>>26)+r|0,i+=(r^(n|~o))+t[7]+1126891415|0,i=(i<<10|i>>>22)+n|0,o+=(n^(i|~r))+t[14]-1416354905|0,o=(o<<15|o>>>17)+i|0,r+=(i^(o|~n))+t[5]-57434055|0,r=(r<<21|r>>>11)+o|0,n+=(o^(r|~i))+t[12]+1700485571|0,n=(n<<6|n>>>26)+r|0,i+=(r^(n|~o))+t[3]-1894986606|0,i=(i<<10|i>>>22)+n|0,o+=(n^(i|~r))+t[10]-1051523|0,o=(o<<15|o>>>17)+i|0,r+=(i^(o|~n))+t[1]-2054922799|0,r=(r<<21|r>>>11)+o|0,n+=(o^(r|~i))+t[8]+1873313359|0,n=(n<<6|n>>>26)+r|0,i+=(r^(n|~o))+t[15]-30611744|0,i=(i<<10|i>>>22)+n|0,o+=(n^(i|~r))+t[6]-1560198380|0,o=(o<<15|o>>>17)+i|0,r+=(i^(o|~n))+t[13]+1309151649|0,r=(r<<21|r>>>11)+o|0,n+=(o^(r|~i))+t[4]-145523070|0,n=(n<<6|n>>>26)+r|0,i+=(r^(n|~o))+t[11]-1120210379|0,i=(i<<10|i>>>22)+n|0,o+=(n^(i|~r))+t[2]+718787259|0,o=(o<<15|o>>>17)+i|0,r+=(i^(o|~n))+t[9]-343485551|0,r=(r<<21|r>>>11)+o|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=o+e[2]|0,e[3]=i+e[3]|0},e.prototype.start=function(){return this._dataLength=0,this._bufferLength=0,this._state.set(e.stateIdentity),this},e.prototype.appendStr=function(t){var n,r,o=this._buffer8,i=this._buffer32,a=this._bufferLength;for(r=0;r<t.length;r+=1){if((n=t.charCodeAt(r))<128)o[a++]=n;else if(n<2048)o[a++]=192+(n>>>6),o[a++]=63&n|128;else if(n<55296||n>56319)o[a++]=224+(n>>>12),o[a++]=n>>>6&63|128,o[a++]=63&n|128;else{if((n=1024*(n-55296)+(t.charCodeAt(++r)-56320)+65536)>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");o[a++]=240+(n>>>18),o[a++]=n>>>12&63|128,o[a++]=n>>>6&63|128,o[a++]=63&n|128}a>=64&&(this._dataLength+=64,e._md5cycle(this._state,i),a-=64,i[0]=i[16])}return this._bufferLength=a,this},e.prototype.appendAsciiStr=function(t){for(var n,r=this._buffer8,o=this._buffer32,i=this._bufferLength,a=0;;){for(n=Math.min(t.length-a,64-i);n--;)r[i++]=t.charCodeAt(a++);if(i<64)break;this._dataLength+=64,e._md5cycle(this._state,o),i=0}return this._bufferLength=i,this},e.prototype.appendByteArray=function(t){for(var n,r=this._buffer8,o=this._buffer32,i=this._bufferLength,a=0;;){for(n=Math.min(t.length-a,64-i);n--;)r[i++]=t[a++];if(i<64)break;this._dataLength+=64,e._md5cycle(this._state,o),i=0}return this._bufferLength=i,this},e.prototype.getState=function(){var e=this,t=e._state;return{buffer:String.fromCharCode.apply(null,e._buffer8),buflen:e._bufferLength,length:e._dataLength,state:[t[0],t[1],t[2],t[3]]}},e.prototype.setState=function(e){var t,n=e.buffer,r=e.state,o=this._state;for(this._dataLength=e.length,this._bufferLength=e.buflen,o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],t=0;t<n.length;t+=1)this._buffer8[t]=n.charCodeAt(t)},e.prototype.end=function(t){void 0===t&&(t=!1);var n,r=this._bufferLength,o=this._buffer8,i=this._buffer32,a=1+(r>>2);if(this._dataLength+=r,o[r]=128,o[r+1]=o[r+2]=o[r+3]=0,i.set(e.buffer32Identity.subarray(a),a),r>55&&(e._md5cycle(this._state,i),i.set(e.buffer32Identity)),(n=8*this._dataLength)<=4294967295)i[14]=n;else{var s=n.toString(16).match(/(.*?)(.{0,8})$/);if(null===s)return;var c=parseInt(s[2],16),l=parseInt(s[1],16)||0;i[14]=c,i[15]=l}return e._md5cycle(this._state,i),t?this._state:e._hex(this._state)},e.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),e.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e.hexChars="0123456789abcdef",e.hexOut=[],e.onePassHasher=new e,e}();t.Md5=r,"5d41402abc4b2a76b9719d911017c592"!==r.hashStr("hello")&&console.error("Md5 self test failed.")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){r(this,e)}return o(e,[{key:"clone",value:function(){var t=new e;return t.videoInputId=this.videoInputId,t.audioInputId=this.audioInputId,t.audioEnabled=this.audioEnabled,t.videoEnabled=this.videoEnabled,t.videoSettings=this.videoSettings,t}},{key:"setVideoSettings",value:function(e){this.videoSettings=e,void 0!==e.deviceId&&(this.videoInputId=e.deviceId)}},{key:"_traceName",value:function(){return"MediaCaptureConfig"}}]),e}();t.MediaCaptureConfig=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),a=n(0),s=function(){function e(t){r(this,e),this.kind=t,this.inUse=!1,this.track=null,this.callId=null}return o(e,[{key:"attach",value:function(e,t){i.default.attachMedia(new MediaStream([e]),this.element),this.direction=t}},{key:"free",value:function(){i.default.detachMedia(this.element),this.inUse=!1,this.track=null,this.callId=null}}]),e}();t.ReusableStructure=s;var c=function(){function e(){r(this,e),this.elementList=new Array,this.log=a.LogManager.get().createLogger(a.LogCategory.RTC,"Renderer")}return o(e,null,[{key:"get",value:function(){return this.inst||(this.inst=new e),this.inst}}]),o(e,[{key:"getFreeElements",value:function(e){return this.elementList.filter(function(t){if(t.inUse&&("all"==e||e==t.kind))return!0})}},{key:"catchRender",value:function(e,t,n){var r=this.getFreeElements(e.kind),o=void 0;return r.length?o=r[0]:(o=new s(e.kind),this.elementList.push(o)),o.inUse=!0,o.track=e,o.callId=t,o.attach(e,n),o.element}},{key:"catchRenders",value:function(e,t,n){for(var r=e.getTracks(),o=[],i=0;i<r.length;i++)o.push(this.catchRender(r[i],t,n));return o}},{key:"freeRendersByCallId",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";this.elementList.map(function(n){n.callId!=e||"all"!=t&&t!=n.direction||n.free()})}},{key:"freeRenderByTrack",value:function(e){this.elementList.map(function(t){t.track.id==e.id&&t.free()})}},{key:"getRendererByCallId",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";this.elementList.filter(function(n){if(n.callId==e&&("all"==t||t==n.direction))return!0})}},{key:"_traceName",value:function(){return"ReusableStructure"}}]),e}();t.ReusableRenderer=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var u=n(14),d=n(1),g=n(6),f=n(0),p=n(2),v=function(e){function t(e,n,i,a){r(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i,a));return s.settings.mode=u.CallMode.SERVER,s}return i(t,e),a(t,[{key:"answer",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"answer",this).call(this,e,n);var r={tracks:this.peerConnection.getTrackKind()};d.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.acceptCall,this.settings.id,g.CallManager.cleanHeaders(n),r)}},{key:"_traceName",value:function(){return"CallExServer"}}]),t}(u.Call);l([f.LogManager.d_trace(f.LogCategory.CALLEXSERVER)],v.prototype,"answer",null),t.CallExServer=v},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var u=n(14),d=n(1),g=n(0),f=n(4),p=n(2),v=n(11),h=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),a(t,[{key:"answer",value:function(e,n,r){var o=this;s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"answer",this).call(this,e,n),void 0!==e&&(void 0===n&&(n={}),n[v.Constants.CALL_DATA_HEADER]=e);var i=f.UserMediaManager.get();void 0===r?i.attachTo(this._peerConnection):r.sendVideo?i.attachTo(this._peerConnection):i.attachToSound(this._peerConnection),this._peerConnection.getLocalAnswer().then(function(e){d.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.acceptCall,o.id(),n,e.sdp)})}},{key:"_traceName",value:function(){return"CallExP2P"}}]),t}(u.Call);l([g.LogManager.d_trace(g.LogCategory.CALLEXP2P)],h.prototype,"answer",null),t.CallExP2P=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var u=n(14),d=n(1),g=n(0),f=n(4),p=n(2),v=n(11),h=n(3),y=n(13),m=n(9),C=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),a(t,[{key:"answer",value:function(e,n,r){var o=this;s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"answer",this).call(this,e,n),void 0!==e&&(void 0!==n&&"object"===(void 0===n?"undefined":c(n))||(n={}),n[v.Constants.CALL_DATA_HEADER]=e);var i=h.Client.getInstance().config();if(i.experiments&&i.experiments.hardware)return new Promise(function(e,t){"object"===(void 0===r?"undefined":c(r))&&(o.settings.videoDirections=r),y.default.StreamManager.get().getCallStream(o).then(function(t){o._peerConnection.bindLocalMedia(t),o._peerConnection.getLocalAnswer().then(function(t){var r={tracks:o.peerConnection.getTrackKind()};d.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.acceptCall,o.id(),n,t.sdp,r),e()})}).catch(function(e){return t(e)})});var a=f.UserMediaManager.get();void 0===r?a.attachTo(this._peerConnection):r.sendVideo?(this._peerConnection.setVideoFlags(r),this.settings.videoDirections=r,a.attachTo(this._peerConnection)):(this._peerConnection.setVideoFlags(r),this.settings.videoDirections=r,a.attachToSound(this._peerConnection)),this._peerConnection.getLocalAnswer().then(function(e){var t={tracks:o.peerConnection.getTrackKind()};d.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.acceptCall,o.id(),n,e.sdp,t)})}},{key:"setActive",value:function(e){var t=this;return e===this.settings.active?new Promise(function(e,n){n({name:m.CallEvents.Updated,result:!1,call:t})}):(this.settings.active=e,this.peerConnection.hold(!e))}},{key:"_traceName",value:function(){return"CallExMedia"}}]),t}(u.Call);l([g.LogManager.d_trace(g.LogCategory.CALL)],C.prototype,"answer",null),l([g.LogManager.d_trace(g.LogCategory.CALL)],C.prototype,"setActive",null),t.CallExMedia=C},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=function(){function e(){r(this,e)}return o(e,[{key:"_traceName",value:function(){return"CodecSorterHelpers"}}],[{key:"H264Sorter",value:function(e,t){return t?new Promise(function(t){for(var n=0;n<e.sections.length;n++)if("video"==e.sections[n].kind.toLowerCase()){var r=e.sections[n].codec.filter(function(e){return-1!=e.toLowerCase().indexOf("h264")&&-1==e.toLowerCase().indexOf("uc")});r.length&&(e.sections[n].codec=r)}t(e)}):new Promise(function(t){for(var n=0;n<e.sections.length;n++)"video"==e.sections[n].kind.toLowerCase()&&e.sections[n].codec.sort(function(e,t){return-1!=e.toLowerCase().indexOf("h264")&&-1==e.toLowerCase().indexOf("uc")?-1:-1!=t.toLowerCase().indexOf("h264")&&-1==t.toLowerCase().indexOf("uc")?1:0});t(e)})}},{key:"VP8Sorter",value:function(e,t){return new Promise(function(t,n){for(var r=0;r<e.sections.length;r++)"video"==e.sections[r].kind.toLowerCase()&&e.sections[r].codec.sort(function(e,t){return-1!=e.toLowerCase().indexOf("vp8")?-1:-1!=t.toLowerCase().indexOf("vp8")?1:0});t(e)})}}]),e}();a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"H264Sorter",null),a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"VP8Sorter",null),t.CodecSorterHelpers=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),a=n(3),s=n(0),c=function(){function e(){r(this,e)}return o(e,[{key:"_traceName",value:function(){return"Webkit"}}],[{key:"attachStream",value:function(e,t){try{if(void 0!==t.srcObject?t.srcObject=e:t.src=URL.createObjectURL(e),t.load(),t instanceof HTMLVideoElement)t.play().catch(function(e){});else{t.play();var n=a.Client.getInstance()._defaultSinkId;null!=n&&t.setSinkId(n)}}catch(e){s.LogManager.get().writeMessage(s.LogCategory.USERMEDIA,"Webkit: ",s.LogLevel.WARNING,JSON.stringify(e))}}},{key:"detachStream",value:function(e){if(e instanceof HTMLVideoElement){var t=e.pause();void 0!==t&&t.catch(function(e){})}else e.pause();e.src=""}},{key:"getDTMFSender",value:function(e,t){if(!e.createDTMFSender)return new i.SignalingDTMFSender(t);var n=[];return e.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){n.push(e)})}),n.length?e.createDTMFSender(n[0]):void 0}},{key:"getUserMedia",value:function(e){return navigator.mediaDevices.getUserMedia(e)}},{key:"screenSharingSupported",value:function(){return new Promise(function(e,t){var n=function t(n){n.origin===window.location.origin&&"VoximplantWebsdkExtensionLoaded"===n.data&&(window.removeEventListener("message",t),clearTimeout(r),e(!0))};window.addEventListener("message",n),window.postMessage("VoximplantWebsdkCheckExtension","*");var r=setTimeout(function(){window.removeEventListener("message",n),e(!1)},800)})}},{key:"getScreenMedia",value:function(){return new Promise(function(e,t){window.postMessage("voximplantWebsdkGetSourceId","*");var n=function n(r){if(r.data&&r.origin===window.location.origin&&r.data.result){if("err"===r.data.result)return t(new Error(r.data.reason));if("ok"===r.data.result&&void 0!==r.data.sourceId){window.removeEventListener("message",n);var o={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080,chromeMediaSourceId:r.data.sourceId},optional:[{googTemporalLayeredScreencast:!0}]}};s.LogManager.get().writeMessage(s.LogCategory.USERMEDIA,"[constraints]",s.LogLevel.TRACE,JSON.stringify(o)),navigator.mediaDevices.getUserMedia(o).then(e,t)}}};window.addEventListener("message",n)})}},{key:"getRTCStats",value:function(e){return new Promise(function(t,n){var r=[];e.getStats(null).then(function(e){e.forEach(function(e){"outbound-rtp"!=e.type&&"inbound-rtp"!=e.type||r.push(e)}),t(r)}).catch(n)})}}]),e}();t.Webkit=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":s(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var l,u=n(19),d=n(5),g=n(4),f=n(20),p=n(8),v=n(0),h=n(1),y=n(6),m=n(2),C=n(41),S=n(9),L=n(16),_=n(11),E=n(21),M=n(3),T=n(24),R=n(13);!function(e){e[e.offer="offer"]="offer",e[e.answer="answer"]="answer",e[e.pranswer="pranswer"]="pranswer",e[e.rollback="rollback"]="rollback"}(l||(l={}));var b;!function(e){e[e.controlling="controlling"]="controlling",e[e.controlled="controlled"]="controlled"}(b||(b={}));var k=function(e){function t(e,n,i){r(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));a.iceTimer=null,a.needTransportRestart=!0,a.ICE_TIMEOUT=2e4,a.RENEGOTIATION_TIMEOUT=15e3,a._canReInvite=function(){return"connected"===a.impl.iceConnectionState||"completed"===a.impl.iceConnectionState};var s=p.PCFactory.get().iceConfig,c=s;if(void 0!==c&&null!==c||(c={gatherPolicy:"all",iceServers:[]}),c.bundlePolicy="max-compat",a.impl=new RTCPeerConnection(c),void 0!==a.impl.ontrack?a.impl.ontrack=function(e){return a.onAddTrack(e)}:void 0!==a.impl.onaddtrack?a.impl.onaddtrack=function(e){return a.onAddTrack(e)}:a.impl.onaddstream=function(e){return a.onAddStream(e)},a.impl.onicecandidate=function(e){a.onICECandidate(e.candidate)},a.impl.oniceconnectionstatechange=function(e){"completed"!==a.impl.iceConnectionState&&"connected"!==a.impl.iceConnectionState||(a.iceTimer&&clearTimeout(a.iceTimer),a.iceTimer=null,a.reInviteQ&&a.reInviteQ.runNext())},a.rtpSenders=[],a.renegotiationInProgress=!1,a.impl.onnegotiationneeded=function(e){return a.onRenegotiation()},a.impl.onsignalingstatechange=function(e){return a.onSignalingStateChange()},a.impl.oniceconnectionstatechange=function(e){return a.onConnectionChange()},a.iceRole=b.controlling,a._remoteStreams=[],a.banReinviteAnswer=!1,a._call=y.CallManager.get().calls[a.id],void 0!==a._call?a.onHold=!a._call.active():a.onHold=!1,a.rtcCollectingCycle=setInterval(function(){a.getPCStats()},y.CallManager.get().rtcStatsCollectionInterval),void 0!==a._call){var l=a._call.headers()[_.Constants.CALLSTATSIOID_HEADER];void 0===l&&(l=a._call.id()),L.CallstatsIo.get().addNewFabric(a.impl,a._call.number(),i?L.CallstatsIoFabricUsage.multiplex:L.CallstatsIoFabricUsage.audio,l)}return a.needTransportRestart=!1,"_default"!==e&&y.CallManager.get().calls[e]&&(a.reInviteQ=new T.ReInviteQ(y.CallManager.get().calls[e],a._canReInvite)),a}return i(t,e),a(t,[{key:"onSignalingStateChange",value:function(){this.log.info("Signal state changed to "+this.impl.signalingState+" for PC:"+this.id),this.impl.signalingState}},{key:"getPCStats",value:function(){var e=this;d.default.getRTCStats(this.impl).then(function(t){void 0!==e._call&&e._call.dispatchEvent({name:"RTCStatsReceived",stats:t})})}},{key:"onConnectionChange",value:function(){"completed"===this.impl.iceConnectionState&&void 0!==this._call&&this._call.dispatchEvent({name:"ICECompleted",call:this._call}),"completed"!==this.impl.iceConnectionState&&"connected"!==this.impl.iceConnectionState||(this.iceTimer&&clearTimeout(this.iceTimer),this.iceTimer=null,this.reInviteQ&&this.reInviteQ.runNext())}},{key:"onRenegotiation",value:function(){var e=this;if(void 0!==this.impl){if("disconnected"===this.impl.connectionState||"failed"===this.impl.connectionState)return void this.log.info("Renegotiation requested on closed PeerConnection");if(null===this.impl.localDescription)return void this.log.info("Renegotiation needed, but no local SD, skipping");if("connected"!==this.impl.iceConnectionState&&"completed"!==this.impl.iceConnectionState)return this.log.info("Renegotiation requested while ice state is "+this.impl.iceConnectionState+". Postponing"),void setTimeout(this.onRenegotiation,100);if(this.renegotiationInProgress)return void this.log.info("Renegotiation in progress. Queueing");if(this.log.info("Renegotiation started"),!1===this.renegotiationInProgress){this.renegotiationInProgress=!0;var t=this.getReceiveOptions();this.updateHoldState(),this.impl.createOffer(t).then(function(t){return e.codecRearrange(t)}).then(function(t){var n={type:t.type,sdp:t.sdp};return n=p.PCFactory.get().addBandwidthParams(n),n=E.SDPMuggle.removeTelephoneEvents(n),n=E.SDPMuggle.removeDoubleOpus(n),n=E.SDPMuggle.fixVideoRecieve(n,e.videoEnabled.receiveVideo)}).then(function(t){return e.srcLocalSDP=t.sdp,e.pendingOffer=t,t}).then(function(){var t={tracks:e._getTrackKind()};h.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.reInvite,e._call.id(),{},e.pendingOffer.sdp,t)}).catch(function(t){e.log.error("Error when renegatiation start "+t.message)})}else this.log.error("Another renegatiation in progress")}}},{key:"getReceiveOptions",value:function(){return{offerToReceiveAudio:this.onHold?0:1,offerToReceiveVideo:this.videoEnabled.receiveVideo&&!this.onHold?1:0}}},{key:"updateHoldState",value:function(){var e=this;this.impl.getLocalStreams().forEach(function(t){t.getTracks().forEach(function(t){t.enabled=!e.onHold})}),this.impl.getRemoteStreams().forEach(function(t){t.getTracks().forEach(function(t){t.enabled=!e.onHold})})}},{key:"onICECandidate",value:function(e){e&&null!==e?this.sendLocalCandidateToPeer("a="+e.candidate,e.sdpMLineIndex):this.log.info("End of candidates")}},{key:"onAddTrack",value:function(e){var t=e.track.kind,n=new MediaStream([e.track]),r=this.renderStream(n,t);"video"===t&&void 0===this.videoRendered?this.videoRendered=r:void 0===this.audioRendered&&(this.audioRendered=r),this.updateHoldState(),this._remoteStreams.push(n),this.renderers.push(r),this.mapRenderer(n,r)}},{key:"onAddStream",value:function(e){var t=g.UserMediaManager.getVideoTracks(e.stream).length?"video":"audio",n=this.renderStream(e.stream,t);"video"===t&&void 0===this.videoRendered?this.videoRendered=n:void 0===this.audioRendered&&(this.audioRendered=n),this.updateHoldState(),this._remoteStreams.push(e.stream),this.renderers.push(n),this.mapRenderer(e.stream,n)}},{key:"mapRenderer",value:function(e,t){var n=this;e.getTracks().forEach(function(r){r.onended=function(){n.checkStreamActive(e,t)}})}},{key:"checkStreamActive",value:function(e,t){e.getTracks().some(function(e){return"live"===e.readyState})||(this._call&&this._call.dispatchEvent({name:S.CallEvents.MediaElementRemoved,call:this._call,elementId:t.id,type:e.getVideoTracks().length?"video":"audio"}),f.Renderer.get().releaseElement(t))}},{key:"renderStream",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=document.body,o=e.getTracks(),i=M.Client.getInstance().remoteVideoContainerId;n&&(i=M.Client.getInstance().localVideoContainerId),"video"!==t&&"sharing"!==t||void 0===i||(r=document.getElementById(i));var a=f.Renderer.get().getElement(o[0].id,"video"===t||"sharing"===t,r);return e.oninactive&&e.oninactive(function(){d.default.detachMedia(a)}),void 0!==this.sinkId&&a.setSinkId(this.sinkId),d.default.attachMedia(e,a),void 0===this._call||n?n&&this._call.dispatchEvent({name:S.CallEvents.LocalVideoStreamAdded,stream:e,element:a,type:t}):this._call.dispatchEvent({name:S.CallEvents.MediaElementCreated,call:this._call,stream:e,element:a,type:t}),a}},{key:"checkMediaAttached",value:function(e){return this._remoteStreams.length>0&&this._remoteStreams.reduce(function(t,n){return"audio"===e?t&&n.getAudioTracks().length>0:"video"===e?t&&n.getVideoTracks().length>0:t},!0)}},{key:"wireRemoteStream",value:function(e){return new Promise(function(e,t){t(new Error("Not implemented"))})}},{key:"_processRemoteAnswer",value:function(e,t){var n=this;if(this.iceTimer=setTimeout(function(){n._call.notifyICETimeout()},this.ICE_TIMEOUT),this.pendingEvent=[e,t],null===this.impl.remoteDescription||""==this.impl.remoteDescription.sdp){var r={sdp:t,type:l.answer};return this.srcRemoteSDP=t,r=E.SDPMuggle.removeTIAS(r),this.impl.setRemoteDescription(r)}}},{key:"_getLocalOffer",value:function(){var e=this;return this.iceRole=b.controlling,new Promise(function(t,n){var r=e.getReceiveOptions();e.impl.createOffer(r).then(function(t){var n={type:t.type,sdp:t.sdp};return n=p.PCFactory.get().addBandwidthParams(n),e.codecRearrange(n)}).then(function(t){return e.srcLocalSDP=t.sdp,e.impl.setLocalDescription(t)}).then(function(){t(e.impl.localDescription)}).catch(function(e){n(e)})})}},{key:"_getLocalAnswer",value:function(){var e=this;return this.iceRole=b.controlled,new Promise(function(t,n){var r={mandatory:e.getReceiveOptions()};e.impl.createAnswer(r).then(function(t){var n={type:t.type,sdp:t.sdp};return n=p.PCFactory.get().addBandwidthParams(n),n=E.SDPMuggle.fixVideoRecieve(n,e.videoEnabled.receiveVideo),e.codecRearrange(n)}).then(function(t){return e.srcLocalSDP=t.sdp,e.impl.setLocalDescription(t)}).then(function(){t({type:l.answer,sdp:e.impl.localDescription.sdp})}).catch(function(e){n(e)})})}},{key:"_setRemoteDescription",value:function(e){var t=new RTCSessionDescription({sdp:e,type:l.offer});return t=E.SDPMuggle.removeTIAS(t),this.srcRemoteSDP=e,this.impl.setRemoteDescription(t)}},{key:"_processRemoteOffer",value:function(e){var t=this;return this.iceRole=b.controlled,new Promise(function(n,r){var o=new RTCSessionDescription({sdp:e,type:l.offer});t.srcRemoteSDP=e,o=E.SDPMuggle.removeTIAS(o),t.impl.setRemoteDescription(o).then(function(){var e={mandatory:t.getReceiveOptions()};return t.impl.createAnswer(e)}).then(function(e){return t.codecRearrange(e)}).then(function(e){return t.srcLocalSDP=e.sdp,t.impl.setLocalDescription(e)}).then(function(){n(t.impl.localDescription.sdp)}).catch(function(e){r(e)})})}},{key:"_close",value:function(){var e=this;clearInterval(this.rtcCollectingCycle),this.impl.onnegotiationneeded=null;var t=M.Client.getInstance().config();this.impl.removeTrack?this.rtpSenders.forEach(function(t){e.impl.removeTrack(t)}):this.impl.getLocalStreams().forEach(function(n){t.experiments&&t.experiments.hardware||n.getTracks().forEach(function(e){e.stop(),n.removeTrack(e)}),e.impl.removeStream(n)}),t.experiments&&t.experiments.hardware&&void 0!==this._call&&R.default.StreamManager.get().remCallStream(this._call),this.impl.close(),void 0!==this._call&&L.CallstatsIo.get().sendFabricEvent(this.impl,L.CallstatsIoFabricEvent.fabricTerminated,this._call.id()),this._localStream=null,this._remoteStreams=null}},{key:"_addRemoteCandidate",value:function(e,t){var n=this;return new Promise(function(r,o){try{n.impl.addIceCandidate(new RTCIceCandidate({candidate:e.substring(2),sdpMLineIndex:t})).then(function(){r()}).catch(function(){r()})}catch(e){r()}})}},{key:"_bindLocalMedia",value:function(){var e=this;if(void 0!==this._localStream){if("firefox"===d.default.getWSVendor()?this._localStream.getTracks().forEach(function(t){e.rtpSenders.push(e.impl.addTrack(t,e._localStream))}):this.impl.addStream(this._localStream),this._call){var t=d.default.getDTMFSender(this.impl,this._call.id());t&&(this.dtmfSender=t)}this.updateHoldState()}}},{key:"_addMediaStream",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===this.shareScreenMedia&&(this.shareScreenMedia=[]),void 0===this.shareScreenMediaTracks&&(this.shareScreenMediaTracks=[]),this.shareScreenMedia.push(e),e.getTracks().forEach(function(e){t.shareScreenMediaTracks.push(e.id)}),"firefox"===d.default.getWSVendor()?e.getTracks().forEach(function(e){var n=new MediaStream([e]);t.rtpSenders.push(t.impl.addTrack(e,n))}):this.impl.addStream(e),n){var r=this.renderStream(e,"sharing",!0);this.renderers.push(r)}}},{key:"_unbindLocalMegia",value:function(){var e=this;this.needTransportRestart=!0,"firefox"===d.default.getWSVendor()?this.rtpSenders.forEach(function(t){e.shareScreenMediaTracks?-1===e.shareScreenMediaTracks.indexOf(t.track.id)&&e.impl.removeTrack(t):e.impl.removeTrack(t)}):this._localStream&&this.impl.removeStream(this._localStream),this._localStream&&this._localStream.getTracks().forEach(function(t){t.stop(),e._localStream.removeTrack(t)}),this._localStream=null}},{key:"_handleReinvite",value:function(e,t){var n=this;return new Promise(function(r,o){if(n.banReinviteAnswer&&o(new Error),!1===n.renegotiationInProgress){n.renegotiationInProgress=!0;var i={sdp:t,type:l.offer};n.srcRemoteSDP=t,i=E.SDPMuggle.removeTIAS(i),n.impl.setRemoteDescription(i).then(function(){var t={mandatory:n.getReceiveOptions()};n.impl.createAnswer(t).then(function(t){var i={type:t.type,sdp:t.sdp};i=E.SDPMuggle.removeDoubleOpus(i),i=E.SDPMuggle.fixVideoRecieve(i,n.videoEnabled.receiveVideo),n.srcLocalSDP=i.sdp;try{n.impl.setLocalDescription(i).then(function(){var t={tracks:n._getTrackKind()};h.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.acceptReInvite,n._call.id(),e,n.impl.localDescription.sdp,t),n.renegotiationInProgress=!1,n._call.dispatchEvent({name:S.CallEvents.Updated,result:!0,call:n._call}),n.updateHoldState(),r()})}catch(e){n.renegotiationInProgress=!1,o(e)}})})}else if(!0===n.renegotiationInProgress){var a={sdp:t,type:l.answer};n.renegotiationInProgress=!1,n.srcRemoteSDP=t,a=E.SDPMuggle.removeTIAS(a),n.impl.setLocalDescription(n.pendingOffer).then(function(){try{n.impl.setRemoteDescription(a).then(function(){n._call.dispatchEvent({name:S.CallEvents.Updated,result:!0,call:n._call}),n.updateHoldState(),r()})}catch(e){n._call.dispatchEvent({name:S.CallEvents.Updated,result:!1,call:n._call}),n.renegotiationInProgress=!1,n.log.error(JSON.stringify(e)),o(e)}clearTimeout(n.renegotiationTimer)})}else o(new Error("Universe was broken!"))})}},{key:"codecRearrange",value:function(e){var t=this;return new Promise(function(n,r){var o=y.CallManager.get().calls[t.id];if(void 0!==o){var i=new C.CodecSorter(e.sdp),a=i.getUserCodecList();void 0!==o.rearangeCodecs?o.rearangeCodecs(a,o.settings.incoming).then(function(t){i.setUserCodecList(t),n({type:e.type,sdp:i.getSDP()})},function(e){t.log.error(JSON.stringify(e)),r(e)}):(t.log.info("No sdp transformer registered"),i.setUserCodecList(a),n({type:e.type,sdp:i.getSDP()}))}else n(e)})}},{key:"_sendDTMF",value:function(e,t,n){void 0!==this.dtmfSender&&this.dtmfSender.insertDTMF(e,t,n)}},{key:"_hold",value:function(e){L.CallstatsIo.get().sendFabricEvent(this.impl,e?L.CallstatsIoFabricEvent.fabricHold:L.CallstatsIoFabricEvent.fabricResume,this._call.id()),this.onHold=e,this.onRenegotiation()}},{key:"_getDirections",value:function(){var e={};return e.local=E.SDPMuggle.detectDirections(this.impl.localDescription.sdp),e.remote=E.SDPMuggle.detectDirections(this.impl.remoteDescription.sdp),e}},{key:"_getStreamActivity",value:function(){var e={};return e.local=this.getMediaActivity(this.impl.getLocalStreams()),e.remote=this.getMediaActivity(this.impl.getRemoteStreams()),e}},{key:"getMediaActivity",value:function(e){return e.map(function(e){return e.getTracks().map(function(e){return{id:e.id,kind:e.kind,mutted:e.muted,active:e.enabled,label:e.label}})})}},{key:"_hdnFRSPrep",value:function(){this.banReinviteAnswer=!0}},{key:"_hdnFRS",value:function(){this.renegotiationInProgress=!1,this.onRenegotiation()}},{key:"_getTrackKind",value:function(){var e=this,t={};return s(this.impl.getSenders)?this.impl.getSenders().forEach(function(n){n.track&&("video"!==n.track.kind?t[n.track.id]=n.track.kind:e.shareScreenMedia&&e.shareScreenMedia.some(function(e){return e.getTracks().some(function(e){return e.id===n.track.id})})?t[n.track.id]="sharing":t[n.track.id]="video")}):this.impl.getLocalStreams().forEach(function(n){n.getTracks().forEach(function(n){"video"!==n.kind?t[n.id]=n.kind:e.shareScreenMedia&&e.shareScreenMedia.some(function(e){return e.getTracks().some(function(e){return e.id===n.id})})?t[n.id]="sharing":t[n.id]="video"})}),t}},{key:"_stopSharing",value:function(){var e=this;void 0!==this.shareScreenMedia&&("firefox"===d.default.getWSVendor()?this.impl.getSenders().forEach(function(t){-1!==e.shareScreenMediaTracks.indexOf(t.track.id)&&e.impl.removeTrack(t)}):this.shareScreenMedia.forEach(function(t){e.impl.removeStream(t)}),this.shareScreenMedia.forEach(function(t){t.getTracks().forEach(function(n){n.stop(),t.removeTrack(n),e.renderers.forEach(function(t){t.id===n.id&&(e._call.dispatchEvent({name:S.CallEvents.MediaElementRemoved,call:e._call,elementId:t.id,type:"video"}),f.Renderer.get().releaseElement(t))})})}),this.shareScreenMediaTracks=[],this.shareScreenMedia=[])}},{key:"_traceName",value:function(){return"WebRTCPC"}},{key:"hasLocalAudio",value:function(){return this.impl.getLocalStreams().some(function(e){return!!e.getAudioTracks().length})}},{key:"hasLocalVideo",value:function(){var e=this;return this.impl.getLocalStreams().some(function(t){return t.getVideoTracks().some(function(t){return!e.shareScreenMedia||!e.shareScreenMedia.some(function(e){return e.getTracks().some(function(e){return e.id===t.id})})})})}},{key:"enableVideo",value:function(e){var t=this;this.impl.getLocalStreams().forEach(function(n){n.getVideoTracks().forEach(function(n){t.shareScreenMedia&&t.shareScreenMedia.some(function(e){return e.getTracks().some(function(e){return e.id===n.id})})||(n.enabled=e)})})}}]),t}(u.PeerConnection);c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"onSignalingStateChange",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"getPCStats",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"onConnectionChange",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"onRenegotiation",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"getReceiveOptions",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"updateHoldState",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"onICECandidate",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"onAddTrack",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"onAddStream",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"mapRenderer",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"checkStreamActive",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"renderStream",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"checkMediaAttached",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"wireRemoteStream",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_processRemoteAnswer",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_getLocalOffer",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_getLocalAnswer",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_setRemoteDescription",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_processRemoteOffer",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_close",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_addRemoteCandidate",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_bindLocalMedia",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_unbindLocalMegia",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_handleReinvite",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"codecRearrange",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_sendDTMF",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_hold",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_getStreamActivity",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"getMediaActivity",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_hdnFRSPrep",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_hdnFRS",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_getTrackKind",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"_stopSharing",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"hasLocalAudio",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"hasLocalVideo",null),c([v.LogManager.d_trace(v.LogCategory.RTC)],k.prototype,"enableVideo",null),t.WebRTCPC=k},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var o,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":i(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=function(){function e(t){r(this,e),this.originalSDP=t}return o(e,[{key:"getCodecList",value:function(){this.originalCodecList={prefix:"",sections:[],sufix:""};var t=RegExp.prototype.test.bind(/^([a-z])=(.*)/),n=e.splitSections(this.originalSDP);this.originalCodecList.prefix=n[0];for(var r=1;r<n.length;r++){var o={kind:"audio",firstLine:"",prefix:"",sufix:"",codec:[]},i=n[r].split("\na=rtpmap");i=i.map(function(e,t){return(t>0?"a=rtpmap"+e:e).trim()+"\r\n"}),o.prefix=i.shift();var a=i.pop();a=a.split(/(\r\n|\r|\n)/).filter(t);var s=!0;for(i.push("");s;)if(s=!1,0!==a.length){var c=a.shift();0===c.indexOf("a=rtpmap")||0===c.indexOf("a=rtcp-fb")||0===c.indexOf("a=fmtp")||0===c.indexOf("a=x-caps")||0===c.indexOf("a=maxptime")?(i[i.length-1]+=c+"\r\n",s=!0):a.unshift(c)}for(var l=0;l<i.length;l++)o.codec.push(i[l].split(/(\r\n|\r|\n)/).filter(t));var u=o.prefix.split(/(\r\n|\r|\n)/).filter(t);o.firstLine=u.shift();var d=o.firstLine.split(" ");d.splice(-1*o.codec.length,o.codec.length),o.kind=d[0].substring(2),o.prefix=u.join("\r\n")+"\r\n",o.firstLine=d.join(" "),a.length>0&&(o.sufix=a.join("\r\n")+"\r\n"),this.originalCodecList.sections.push(o)}return this.originalCodecList}},{key:"getUserCodecList",value:function(){void 0===this.originalCodecList&&this.getCodecList();var t={sections:[]};return t.sections=this.originalCodecList.sections.filter(function(e){return"video"===e.kind||"audio"===e.kind}).map(function(t,n,r){var o={kind:t.kind,codec:t.codec.map(function(t){return e.codecToUserCodec(t)})},i=[],a=!0,s=!1,c=void 0;try{for(var l,u=o.codec[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var d=l.value;-1===i.indexOf(d)&&i.push(d)}}catch(e){s=!0,c=e}finally{try{!a&&u.return&&u.return()}finally{if(s)throw c}}return o.codec=i,o}),t}},{key:"setUserCodecList",value:function(t){void 0===this.originalCodecList&&this.getCodecList();for(var n=0;n<t.sections.length;n++)t.sections[n].kind===this.originalCodecList.sections[n].kind&&(this.originalCodecList.sections[n].codec=e.resortSection(t.sections[n].codec,this.originalCodecList.sections[n].codec))}},{key:"getSDP",value:function(){for(var e=this.originalCodecList.prefix,t=0;t<this.originalCodecList.sections.length;t++){for(var n="",r=[],o=0;o<this.originalCodecList.sections[t].codec.length;o++)r.push(this.originalCodecList.sections[t].codec[o][0].split(" ")[0].substring(9)),n+=this.originalCodecList.sections[t].codec[o].join("\r\n")+"\r\n";e+=this.originalCodecList.sections[t].firstLine+" "+r.join(" ")+"\r\n",e+=this.originalCodecList.sections[t].prefix,e+=n,e+=this.originalCodecList.sections[t].sufix}return e}},{key:"_traceName",value:function(){return"CodecSorter"}}],[{key:"splitSections",value:function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})}},{key:"codecToUserCodec",value:function(e){var t=e[0].split(" ");return t.shift(),t.join(" ")}},{key:"resortSection",value:function(t,n){for(var r=[],o=0;o<t.length;o++)for(var i=0;i<n.length;i++)t[o]===e.codecToUserCodec(n[i])&&r.push(n[i]);return r}},{key:"downOpusBandwidth",value:function(e){return new Promise(function(t,n){for(var r=RegExp.prototype.test.bind(/^([a-z])=(.*)/),o=e.sdp.split(/(\r\n|\r|\n)/).filter(r),i=!1,a=0;a<o.length;a++)-1!==o[a].indexOf("a=fmtp:114")&&(o[a]="a=fmtp:114 minptime=10; useinbandfec=1; sprop-maxcapturerate=8000",i=!0),-1!==o[a].indexOf("a=fmtp:111")&&(o[a]="a=fmtp:111 minptime=10; useinbandfec=1; sprop-maxcapturerate=8000",i=!0);i||n(e),e.sdp=o.join("\r\n")+"\r\n",t(e)})}}]),e}();a([s.LogManager.d_trace(s.LogCategory.RTC)],c.prototype,"getCodecList",null),a([s.LogManager.d_trace(s.LogCategory.RTC)],c.prototype,"getUserCodecList",null),a([s.LogManager.d_trace(s.LogCategory.RTC)],c.prototype,"setUserCodecList",null),a([s.LogManager.d_trace(s.LogCategory.RTC)],c.prototype,"getSDP",null),a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"splitSections",null),a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"codecToUserCodec",null),a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"resortSection",null),a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"downOpusBandwidth",null),t.CodecSorter=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){r(this,e)}return o(e,[{key:"_traceName",value:function(){return"Edge"}}],[{key:"attachStream",value:function(e,t){t.srcObject=e,t.play()}},{key:"detachStream",value:function(e){e.pause(),e.src=""}},{key:"getScreenMedia",value:function(){return new Promise(function(e,t){t(new Error("Screen sharing not allowed for you platform"))})}},{key:"getRTCStats",value:function(e){return new Promise(function(e,t){t(new Error("RTCStats sharing not allowed for you platform"))})}}]),e}();t.Edge=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(17),a=function(){function e(){r(this,e)}return o(e,[{key:"_traceName",value:function(){return"Safari"}}],[{key:"attachStream",value:function(e,t){t.srcObject=e}},{key:"detachStream",value:function(e){if(e instanceof HTMLVideoElement){var t=e.pause();void 0!==t&&t.catch(function(e){})}else e.pause();e.src=""}},{key:"getDTMFSender",value:function(e,t){return e.createDTMFSender?e.createDTMFSender(e.getLocalStreams()[0].getAudioTracks()[0]):new i.SignalingDTMFSender(t)}},{key:"getScreenMedia",value:function(){return new Promise(function(e,t){window.postMessage("get-sourceId","*"),window.addEventListener("message",function(n){if(n.origin==window.location.origin&&("PermissionDeniedError"==n.data&&t(new Error("PermissionDeniedError")),"string"!=typeof n.data&&void 0!==n.data.sourceId)){var r={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080,chromeMediaSourceId:n.data.sourceId},optional:[{googTemporalLayeredScreencast:!0}]}};navigator.mediaDevices.getUserMedia(r).then(function(t){e(t)}).catch(function(e){t(e)})}})})}},{key:"getRTCStats",value:function(e){return new Promise(function(t,n){var r=[];e.getStats(null).then(function(e){e.forEach(function(e){if("ssrc"==e.type){var t={};t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)}}),t(r)}).catch(n)})}}]),e}();t.Safari=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(18),a=n(6),s=n(1),c=n(2),l=n(4),u=n(12),d=n(10),g=n(9),f=function(){function e(t){var n=this;r(this,e),this.client=t,this.currentCall=null,this.onConnectionFailed=null,this.onConnectionEstablished=null,this.onCheckComplete=null,this.onCallFailed=null,this.onCallConnected=null,this.onCallEnded=null,this.onCallRinging=null,this.onCallMediaStarted=null,this.onVoicemail=null,this.onNetStatsReceived=null,a.CallManager.get().protocolVersion,t.on(i.Events.ConnectionFailed,function(e){return n.runLegacyCallback(n.onConnectionFailed,e)}),t.on(i.Events.ConnectionEstablished,function(e){return n.runLegacyCallback(n.onConnectionEstablished,e)}),s.VoxSignaling.get().setRPCHandler(u.RemoteEvent.handlePreFlightCheckResult,function(e,t,r){return n.onCheckComplete(e,t,r)}),s.VoxSignaling.get().setRPCHandler(u.RemoteEvent.handleVoicemail,function(e){return n.runLegacyCallback(n.onVoicemail,e)})}return o(e,[{key:"connectTo",value:function(e,t,n,r){var o=s.VoxSignaling.get();d.Authenticator.get().ziAuthorized(!0),o.lagacyConnectTo(e,t,n,r)}},{key:"connect",value:function(){}},{key:"requestMedia",value:function(e,t,n,r){var o=l.UserMediaManager.get();o.enableAudio(!0),o.queryMedia().then(function(e){l.UserMediaManager.get().updateLocalVideo(e),"function"==typeof t&&t(e)}).catch(function(e){"function"==typeof n&&n(e)})}},{key:"hangupCall",value:function(e,t){a.CallManager.get().calls[e].hangup(t),s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.disconnectCall,e,{})}},{key:"callTo",value:function(e,t,n,r){return this.currentCall=this.client.call({number:e,video:t,extraHeaders:n,extraParams:r}),this.bindCurrentCall(),this.currentCall.id()}},{key:"voicemailPromptFinished",value:function(e){s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.zPromptFinished,e)}},{key:"makeid",value:function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}},{key:"muteMicrophone",value:function(e){var t=a.CallManager.get();for(var n in t.calls)t.calls.hasOwnProperty(n)&&(e?t.calls[n].muteMicrophone():t.calls[n].unmuteMicrophone())}},{key:"sendDigit",value:function(e,t){s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.sendDTMF,e,t)}},{key:"startPreFlightCheck",value:function(e,t){s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.zStartPreFlightCheck,!!e,!!t)}},{key:"runLegacyCallback",value:function(e,t){void 0!==e&&null!==e&&e(t)}},{key:"bindCurrentCall",value:function(){var e=this;window.currentCall=this.currentCall,this.currentCall.on(g.CallEvents.Failed,function(t){e.runLegacyCallback(e.onCallFailed,t),e.unbindCurrentCall()}),this.currentCall.on(g.CallEvents.Connected,function(t){e.runLegacyCallback(e.onCallConnected,t),e.runLegacyCallback(e.onCallMediaStarted,t);a.CallManager.get();setTimeout(function(){var e=document.getElementById(window.currentCall.peerConnection.impl.getRemoteStreams()[0].getTracks()[0].id);e.srcObject=window.currentCall.peerConnection.impl.getRemoteStreams()[0],e.load(),e.play()},1e3)}),this.currentCall.on(g.CallEvents.Disconnected,function(t){e.runLegacyCallback(e.onCallEnded,t),e.unbindCurrentCall()}),this.client.on(i.Events.NetStatsReceived,function(t){return e.onNetStatsReceived(t)})}},{key:"unbindCurrentCall",value:function(){this.currentCall.off(g.CallEvents.Failed),this.currentCall.off(g.CallEvents.Connected),this.currentCall.off(g.CallEvents.Disconnected),this.currentCall.off(g.CallEvents.ProgressToneStart),this.currentCall.off(g.CallEvents.Connected),this.client.off(i.Events.NetStatsReceived)}},{key:"_traceName",value:function(){return"ZingayaAPI"}}]),e}();t.ZingayaAPI=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=n(2),s=function(){function e(){r(this,e)}return o(e,[{key:"_traceName",value:function(){return"PushService"}}],[{key:"register",value:function(e){return new Promise(function(t,n){i.VoxSignaling.get().callRemoteFunction(a.RemoteFunction.registerPushToken,e)?t():n()})}},{key:"unregister",value:function(e){return new Promise(function(t,n){i.VoxSignaling.get().callRemoteFunction(a.RemoteFunction.unregisterPushToken,e)?t():n()})}},{key:"incomingPush",value:function(e){return new Promise(function(t,n){i.VoxSignaling.get().callRemoteFunction(a.RemoteFunction.pushFeedback,e)?t():n()})}}]),e}();t.PushService=s},function(e,t,n){"use strict";(function(t){var r=n(48);e.exports=r({window:t.window})}).call(t,n(47))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r=n(7);e.exports=function(e,t){var o=e&&e.window,i={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in t)hasOwnProperty.call(t,a)&&(i[a]=t[a]);var s=r.log,c=r.detectBrowser(o),l=n(49)||null,u=n(51)||null,d=n(54)||null,g=n(56)||null,f=n(57)||null,p={browserDetails:c,commonShim:f,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(c.browser){case"chrome":if(!l||!l.shimPeerConnection||!i.shimChrome)return s("Chrome shim is not included in this adapter release."),p;s("adapter.js shimming chrome."),p.browserShim=l,f.shimCreateObjectURL(o),l.shimGetUserMedia(o),l.shimMediaStream(o),l.shimSourceObject(o),l.shimPeerConnection(o),l.shimOnTrack(o),l.shimAddTrackRemoveTrack(o),l.shimGetSendersWithDtmf(o),f.shimRTCIceCandidate(o),f.shimMaxMessageSize(o),f.shimSendThrowTypeError(o);break;case"firefox":if(!d||!d.shimPeerConnection||!i.shimFirefox)return s("Firefox shim is not included in this adapter release."),p;s("adapter.js shimming firefox."),p.browserShim=d,f.shimCreateObjectURL(o),d.shimGetUserMedia(o),d.shimSourceObject(o),d.shimPeerConnection(o),d.shimOnTrack(o),d.shimRemoveStream(o),f.shimRTCIceCandidate(o),f.shimMaxMessageSize(o),f.shimSendThrowTypeError(o);break;case"edge":if(!u||!u.shimPeerConnection||!i.shimEdge)return s("MS edge shim is not included in this adapter release."),p;s("adapter.js shimming edge."),p.browserShim=u,f.shimCreateObjectURL(o),u.shimGetUserMedia(o),u.shimPeerConnection(o),u.shimReplaceTrack(o),f.shimMaxMessageSize(o),f.shimSendThrowTypeError(o);break;case"safari":if(!g||!i.shimSafari)return s("Safari shim is not included in this adapter release."),p;s("adapter.js shimming safari."),p.browserShim=g,f.shimCreateObjectURL(o),g.shimRTCIceServerUrls(o),g.shimCallbacksAPI(o),g.shimLocalStreamsAPI(o),g.shimRemoteStreamsAPI(o),g.shimTrackEventTransceiver(o),g.shimGetUserMedia(o),g.shimCreateOfferLegacy(o),f.shimRTCIceCandidate(o),f.shimMaxMessageSize(o),f.shimSendThrowTypeError(o);break;default:s("Unsupported browser!")}return p}},function(e,t,n){"use strict";var r=n(7),o=r.log;e.exports={shimGetUserMedia:n(50),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)"RTCRtpTransceiver"in e||r.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||(e.transceiver={receiver:e.receiver}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var o;o=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var i=new Event("track");i.track=r.track,i.receiver=o,i.transceiver={receiver:o},i.streams=[t.stream],n.dispatchEvent(i)}),t.stream.getTracks().forEach(function(r){var o;o=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var i=new Event("track");i.track=r,i.receiver=o,i.transceiver={receiver:o},i.streams=[t.stream],n.dispatchEvent(i)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var o=this,i=n.apply(o,arguments);return i||(i=t(o,e),o._senders.push(i)),i};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;r.apply(t,arguments);var n=t._senders.indexOf(e);-1!==n&&t._senders.splice(n,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],o.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],i.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;if(this._srcObject=e,this.src&&t.revokeObjectURL(this.src),!e)return void(this.src="");this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var r=t.getSenders();n.apply(this,arguments);var o=t.getSenders().filter(function(e){return-1===r.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(o)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]}),o.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){function t(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],o=e._streams[r.id];n=n.replace(new RegExp(o.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function n(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],o=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),o.id)}),new RTCSessionDescription({type:t.type,sdp:n})}var o=r.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&o.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=i.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());n._streams[t.id]=r,n._reverseStreams[r.id]=t,t=r}a.apply(n,[t])};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},s.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var o=[].slice.call(arguments,1);if(1!==o.length||!o[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var i=r._streams[n.id];if(i)i.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);r._streams[n.id]=a,r._reverseStreams[a.id]=n,r.addStream(a)}return r.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(n){var r=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){var e=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var o=t(e,r);n[0].apply(null,[o])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(n){return t(e,n)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=n(e,arguments[0]),c.apply(e,arguments)):c.apply(e,arguments)};var l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,n=l.get.apply(this);return""===n.type?n:t(e,n)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==t)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var n;Object.keys(t._streams).forEach(function(r){t._streams[r].getTracks().find(function(t){return e.track===t})&&(n=t._streams[r])}),n&&(1===n.getTracks().length?t.removeStream(t._reverseStreams[n.id]):n.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection)e.RTCPeerConnection=function(t,n){return o("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});else{var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var o=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,o.push(a)):o.push(e.iceServers[i])}e.iceServers=o}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return i.apply(this,arguments);if(0===i.length&&(0===arguments.length||"function"!=typeof arguments[0]))return i.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){o[1](s(a(e)))};return i.apply(this,[c,arguments[0]])}return new Promise(function(e,t){i.apply(r,[function(t){e(s(a(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,o){n.apply(t,[e[0],r,o])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,o){n.apply(e,[r,o,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},function(e,t,n){"use strict";var r=n(7),o=r.log;e.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var i={};"number"==typeof r.ideal?(i[o("min",n)]=r.ideal,t.optional.push(i),i={},i[o("max",n)]=r.ideal,t.optional.push(i)):(i[o("",n)]=r.ideal,t.optional.push(i))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||c)){delete e.video.facingMode;var l;if("environment"===s.exact||"environment"===s.ideal?l=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(l=["front"]),l)return n.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var n=t.find(function(e){return l.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!n&&t.length&&-1!==l.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=i(e.video),o("chrome: "+JSON.stringify(e)),r(e)})}e.video=i(e.video)}return o("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,t,r){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){r&&r(s(e))})})};n.getUserMedia=c;var l=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:l,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else n.mediaDevices.getUserMedia=function(e){return l(e)};void 0===n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){o("Dummy mediaDevices.addEventListener called.")}),void 0===n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){o("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,n){"use strict";var r=n(7),o=n(52);e.exports={shimGetUserMedia:n(53),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender),e.RTCPeerConnection=o(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},function(e,t,n){"use strict";function r(e,t,n,r,o){var i=l.writeRtpDescription(e.kind,t);if(i+=l.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=l.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),i+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(r?r.id:"-")+" "+a+"\r\n";i+="a="+s,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+l.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+l.localCName+"\r\n"),i}function o(e,t){var n=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o="string"==typeof r;return o&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=o?r[0]:r,!!r.length}})}function i(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},o=function(e,t,n,o){var i=r(e.parameters.apt,n),a=r(t.parameters.apt,o);return i&&a&&i.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(r){for(var i=0;i<t.codecs.length;i++){var a=t.codecs[i];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!o(r,a,e.codecs,t.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var o=t.headerExtensions[r];if(e.uri===o.uri){n.headerExtensions.push(o);break}}}),n}function a(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}var l=n(28);e.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function d(t,n,r,o){var i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=o,e.setTimeout(function(){t._dispatchEvent("track",i)})}var g=function(n){var r=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=o(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=l.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};g.prototype.onicecandidate=null,g.prototype.onaddstream=null,g.prototype.ontrack=null,g.prototype.onremovestream=null,g.prototype.onsignalingstatechange=null,g.prototype.oniceconnectionstatechange=null,g.prototype.onconnectionstatechange=null,g.prototype.onicegatheringstatechange=null,g.prototype.onnegotiationneeded=null,g.prototype.ondatachannel=null,g.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},g.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},g.prototype.getConfiguration=function(){return this._config},g.prototype.getLocalStreams=function(){return this.localStreams},g.prototype.getRemoteStreams=function(){return this.remoteStreams},g.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var o=this._createIceAndDtlsTransports();r.iceTransport=o.iceTransport,r.dtlsTransport=o.dtlsTransport}return t||this.transceivers.push(r),r},g.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var r,o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(r=this.transceivers[o]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},g.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},g.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},g.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},g.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},g.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},g.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var o=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(o,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;o.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},o.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),o},g.prototype._gather=function(t,n){var r=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var i=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(r.usingBundle&&n>0)){var i=new Event("icecandidate");i.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,s=!a||0===Object.keys(a).length;if(s)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),a.component=1,a.ufrag=o.getLocalParameters().usernameFragment;var c=l.writeCandidate(a);i.candidate=Object.assign(i.candidate,l.parseCandidate(c)),i.candidate.candidate=c,i.candidate.toJSON=function(){return{candidate:i.candidate.candidate,sdpMid:i.candidate.sdpMid,sdpMLineIndex:i.candidate.sdpMLineIndex,usernameFragment:i.candidate.usernameFragment}}}var u=l.getMediaSections(r.localDescription.sdp);u[i.candidate.sdpMLineIndex]+=s?"a=end-of-candidates\r\n":"a="+i.candidate.candidate+"\r\n",r.localDescription.sdp=l.getDescription(r.localDescription.sdp)+u.join("");var d=r.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),s||r._dispatchEvent("icecandidate",i),d&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout(function(){i.forEach(function(e){o.onlocalcandidate(e)})},0)}},g.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},g.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},g.prototype._transceive=function(e,n,r){var o=i(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:l.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),r&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},g.prototype.setLocalDescription=function(e){var t=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,t.signalingState)||t._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState));var n,r;if("offer"===e.type)n=l.splitSections(e.sdp),r=n.shift(),n.forEach(function(e,n){var r=l.parseRtpParameters(e);t.transceivers[n].localCapabilities=r}),t.transceivers.forEach(function(e,n){t._gather(e.mid,n)});else if("answer"===e.type){n=l.splitSections(t.remoteDescription.sdp),r=n.shift();var o=l.matchPrefix(r,"a=ice-lite").length>0;n.forEach(function(e,n){var a=t.transceivers[n],s=a.iceGatherer,c=a.iceTransport,u=a.dtlsTransport,d=a.localCapabilities,g=a.remoteCapabilities;if(!(l.isRejected(e)&&0===l.matchPrefix(e,"a=bundle-only").length||a.rejected)){var f=l.getIceParameters(e,r),p=l.getDtlsParameters(e,r);o&&(p.role="server"),t.usingBundle&&0!==n||(t._gather(a.mid,n),"new"===c.state&&c.start(s,f,o?"controlling":"controlled"),"new"===u.state&&u.start(p));var v=i(d,g);t._transceive(a,v.codecs.length>0,!1)}})}return t.localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?t._updateSignalingState("have-local-offer"):t._updateSignalingState("stable"),Promise.resolve()},g.prototype.setRemoteDescription=function(r){var o=this;if(-1===["offer","answer"].indexOf(r.type))return Promise.reject(c("TypeError",'Unsupported type "'+r.type+'"'));if(!a("setRemoteDescription",r.type,o.signalingState)||o._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+r.type+" in state "+o.signalingState));var i={};o.remoteStreams.forEach(function(e){i[e.id]=e});var g=[],f=l.splitSections(r.sdp),p=f.shift(),v=l.matchPrefix(p,"a=ice-lite").length>0,h=l.matchPrefix(p,"a=group:BUNDLE ").length>0;o.usingBundle=h;var y=l.matchPrefix(p,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!y&&y.substr(14).split(" ").indexOf("trickle")>=0,f.forEach(function(a,c){var d=l.splitLines(a),f=l.getKind(a),y=l.isRejected(a)&&0===l.matchPrefix(a,"a=bundle-only").length,m=d[0].substr(2).split(" ")[2],C=l.getDirection(a,p),S=l.parseMsid(a),L=l.getMid(a)||l.generateIdentifier();if("application"===f&&"DTLS/SCTP"===m||y)return void(o.transceivers[c]={mid:L,kind:f,rejected:!0});!y&&o.transceivers[c]&&o.transceivers[c].rejected&&(o.transceivers[c]=o._createTransceiver(f,!0));var _,E,M,T,R,b,k,P,I,w,A,O=l.parseRtpParameters(a);y||(w=l.getIceParameters(a,p),A=l.getDtlsParameters(a,p),A.role="client"),k=l.parseRtpEncodingParameters(a);var D=l.parseRtcpParameters(a),N=l.matchPrefix(a,"a=end-of-candidates",p).length>0,x=l.matchPrefix(a,"a=candidate:").map(function(e){return l.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===r.type||"answer"===r.type)&&!y&&h&&c>0&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==r.type||y)"answer"!==r.type||y||(_=o.transceivers[c],E=_.iceGatherer,M=_.iceTransport,T=_.dtlsTransport,R=_.rtpReceiver,b=_.sendEncodingParameters,P=_.localCapabilities,o.transceivers[c].recvEncodingParameters=k,o.transceivers[c].remoteCapabilities=O,o.transceivers[c].rtcpParameters=D,x.length&&"new"===M.state&&(!v&&!N||h&&0!==c?x.forEach(function(e){s(_.iceTransport,e)}):M.setRemoteCandidates(x)),h&&0!==c||("new"===M.state&&M.start(E,w,"controlling"),"new"===T.state&&T.start(A)),o._transceive(_,"sendrecv"===C||"recvonly"===C,"sendrecv"===C||"sendonly"===C),!R||"sendrecv"!==C&&"sendonly"!==C?delete _.rtpReceiver:(I=R.track,S?(i[S.stream]||(i[S.stream]=new e.MediaStream),n(I,i[S.stream]),g.push([I,R,i[S.stream]])):(i.default||(i.default=new e.MediaStream),n(I,i.default),g.push([I,R,i.default]))));else{_=o.transceivers[c]||o._createTransceiver(f),_.mid=L,_.iceGatherer||(_.iceGatherer=o._createIceGatherer(c,h)),x.length&&"new"===_.iceTransport.state&&(!N||h&&0!==c?x.forEach(function(e){s(_.iceTransport,e)}):_.iceTransport.setRemoteCandidates(x)),P=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(P.codecs=P.codecs.filter(function(e){return"rtx"!==e.name})),b=_.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var F=!1;if("sendrecv"===C||"sendonly"===C){if(F=!_.rtpReceiver,R=_.rtpReceiver||new e.RTCRtpReceiver(_.dtlsTransport,f),F){var U;I=R.track,S&&"-"===S.stream||(S?(i[S.stream]||(i[S.stream]=new e.MediaStream,Object.defineProperty(i[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(I,"id",{get:function(){return S.track}}),U=i[S.stream]):(i.default||(i.default=new e.MediaStream),U=i.default)),U&&(n(I,U),_.associatedRemoteMediaStreams.push(U)),g.push([I,R,U])}}else _.rtpReceiver&&_.rtpReceiver.track&&(_.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===_.rtpReceiver.track.id});t&&u(t,e)}),_.associatedRemoteMediaStreams=[]);_.localCapabilities=P,_.remoteCapabilities=O,_.rtpReceiver=R,_.rtcpParameters=D,_.sendEncodingParameters=b,_.recvEncodingParameters=k,o._transceive(o.transceivers[c],!1,F)}}),void 0===o._dtlsRole&&(o._dtlsRole="offer"===r.type?"active":"passive"),o.remoteDescription={type:r.type,sdp:r.sdp},"offer"===r.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(i).forEach(function(t){var n=i[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout(function(){o._dispatchEvent("addstream",r)})}g.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&d(o,t,r,[n])})}}),g.forEach(function(e){e[2]||d(o,e[0],e[1],[])}),e.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},g.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},g.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},g.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},g.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},g.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},g.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter(function(e){return"audio"===e.kind}).length,i=n.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(o=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(i=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--i<0&&(e.wantReceive=!1)});o>0||i>0;)o>0&&(n._createTransceiver("audio"),o--),i>0&&(n._createTransceiver("video"),i--);var s=l.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(r,o){var i=r.track,a=r.kind,s=r.mid||l.generateIdentifier();r.mid=s,r.iceGatherer||(r.iceGatherer=n._createIceGatherer(o,n.usingBundle));var c=e.RTCRtpSender.getCapabilities(a);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),c.headerExtensions.forEach(function(e){(r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var u=r.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];i&&t>=15019&&"video"===a&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),r.wantReceive&&(r.rtpReceiver=new e.RTCRtpReceiver(r.dtlsTransport,a)),r.localCapabilities=c,r.sendEncodingParameters=u}),"max-compat"!==n._config.bundlePolicy&&(s+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){s+=r(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),s+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,s+="a="+l.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(s+="a=end-of-candidates\r\n"))});var u=new e.RTCSessionDescription({type:"offer",sdp:s});return Promise.resolve(u)},g.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var o=l.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(o+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var a=l.getMediaSections(n.remoteDescription.sdp).length;n.transceivers.forEach(function(e,s){if(!(s+1>a)){if(e.rejected)return"application"===e.kind?o+="m=application 0 DTLS/SCTP 5000\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");if(e.stream){var c;"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var l=i(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=r(e,l,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}});var s=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(s)},g.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(r,o){if(!n.remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var i=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<n.transceivers.length;a++)if(n.transceivers[a].mid===e.sdpMid){i=a;break}var u=n.transceivers[i];if(!u)return o(c("OperationError","Can not add ICE candidate"));if(u.rejected)return r();var d=Object.keys(e.candidate).length>0?l.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return r();if(d.component&&1!==d.component)return r();if((0===i||i>0&&u.iceTransport!==n.transceivers[0].iceTransport)&&!s(u.iceTransport,d))return o(c("OperationError","Can not add ICE candidate"));var g=e.candidate.trim();0===g.indexOf("a=")&&(g=g.substr(2)),t=l.getMediaSections(n.remoteDescription.sdp),t[i]+="a="+(d.type?g:"end-of-candidates")+"\r\n",n.remoteDescription.sdp=l.getDescription(n.remoteDescription.sdp)+t.join("")}else for(var f=0;f<n.transceivers.length&&(n.transceivers[f].rejected||(n.transceivers[f].iceTransport.addRemoteCandidate({}),t=l.getMediaSections(n.remoteDescription.sdp),t[f]+="a=end-of-candidates\r\n",n.remoteDescription.sdp=l.getDescription(n.remoteDescription.sdp)+t.join(""),!n.usingBundle));f++);r()})},g.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(n){var r=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(n){e[n].type=t(e[n]),r.set(n,e[n])})}),n(r)})})};var f=["createOffer","createAnswer"];return f.forEach(function(e){var t=g.prototype[e];g.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),f=["setLocalDescription","setRemoteDescription","addIceCandidate"],f.forEach(function(e){var t=g.prototype[e];g.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=g.prototype[e];g.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),g}},function(e,t,n){"use strict";e.exports=function(e){var t=e&&e.navigator,n=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(n(e))})}}},function(e,t,n){"use strict";var r=n(7);e.exports={shimGetUserMedia:n(55),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=r.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,r){if(t.version<38&&n&&n.iceServers){for(var o=[],i=0;i<n.iceServers.length;i++){var a=n.iceServers[i];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),o.push(c)}else o.push(n.iceServers[i])}n.iceServers=o}return new e.mozRTCPeerConnection(n,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var o=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return a.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=o(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(n,r)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&-1!==e.getTracks().indexOf(n.track)&&t.removeTrack(n)})})}}},function(e,t,n){"use strict";var r=n(7),o=r.log;e.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,i=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,r,i){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var o={};"number"==typeof r.ideal?o[n]={min:r.ideal,max:r.ideal}:o[n]=r.ideal,e.advanced.push(o),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(o("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),o("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,r,function(e){i(a(e))})},c=function(e){return new Promise(function(t,n){s(e,t,n)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var l=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return l().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var d=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},g=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),d(e.audio,"autoGainControl","mozAutoGainControl"),d(e.audio,"noiseSuppression","mozNoiseSuppression")),g(e)},i&&i.prototype.getSettings){var f=i.prototype.getSettings;i.prototype.getSettings=function(){var e=f.apply(this,arguments);return d(e,"mozAutoGainControl","autoGainControl"),d(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var p=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),d(e,"autoGainControl","mozAutoGainControl"),d(e,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[e])}}}n.getUserMedia=function(e,o,i){if(t.version<44)return s(e,o,i);r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(o,i)}}},function(e,t,n){"use strict";var r=n(7);e.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){return n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!(t._remoteStreams.indexOf(e)>=0)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}})})}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,i=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o};var s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var o=[],i=0;i<e.iceServers.length;i++){var a=e.iceServers[i];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,o.push(a)):o.push(e.iceServers[i])}e.iceServers=o}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){var r=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||n.addTransceiver("audio");var o=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&o?"sendrecv"===o.direction?o.setDirection("sendonly"):"recvonly"===o.direction&&o.setDirection("inactive"):!0!==e.offerToReceiveVideo||o||n.addTransceiver("video")}return t.apply(n,arguments)}}}},function(e,t,n){"use strict";var r=n(28),o=n(7);e.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),o=r.parseCandidate(e.candidate),i=Object.assign(n,o);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,o.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var n=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),i=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return i.set(t,e),o.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){r(e),i.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=i.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=i.get(arguments[1])||null),c.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=o.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=function(e){var t=r.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=r.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})},i=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!==n?-1:n},a=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:57===t.version?65535:65536),n},s=function(e,n){var o=65536;"firefox"===t.browser&&57===t.version&&(o=65535);var i=r.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?o=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(o=2147483637),o},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;if(e._sctp=null,n(arguments[0])){var t,r=i(arguments[0]),o=a(r),l=s(arguments[0],r);t=0===o&&0===l?Number.POSITIVE_INFINITY:0===o||0===l?Math.max(o,l):Math.min(o,l);var u={};Object.defineProperty(u,"maxMessageSize",{get:function(){return t}}),e._sctp=u}return c.apply(e,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=this,n=t.apply(e,arguments),r=n.send;return n.send=function(){var t=this,n=arguments[0];if((n.length||n.size||n.byteLength)>e.sctp.maxMessageSize)throw new DOMException("Message too large (can send a maximum of "+e.sctp.maxMessageSize+" bytes)","TypeError");return r.apply(t,arguments)},n}}}}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)};Object.defineProperty(t,"__esModule",{value:!0});var c=n(15),l=function(e){function t(e){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return i(t,e),a(t,[{key:"on",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,e,n)}},{key:"off",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,e,n)}},{key:"_traceName",value:function(){return"EndPoint"}}]),t}(c.EventDispatcher);t.EndPoint=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.Offline="OFFLINE"]="Offline",e[e.Online="ONLINE"]="Online",e[e.Ready="READY"]="Ready",e[e.InService="IN_SERVICE"]="InService",e[e.AfterService="AFTER_SERVICE"]="AfterService",e[e.Timeout="TIMEOUT"]="Timeout",e[e.DND="DND"]="DND"}(t.OperatorACDStatuses||(t.OperatorACDStatuses={}))}]);